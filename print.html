<!DOCTYPE HTML>
<html lang="en" class="rust" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>cargo-nextest</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:title" content="cargo-nextest" />
        <meta property="og:image" content="https://nexte.st/static/cover.png" />
        <meta property="og:description" content="A next-generation test runner for Rust." />
        <link rel="stylesheet" href="/fonts/inter.css" />
        <style>
            :root,
            html {
                font-family: "Inter", "Helvetica Neue", "Arial", sans-serif;
                font-feature-settings: "ss01", "ss03";
                font-variant-ligatures: common-ligatures;
                letter-spacing: -0.008em;
            }
        
            @supports (font-variation-settings: normal) {
                :root {
                    font-family: 'Inter var', "Helvetica Neue", "Arial", sans-serif;
                }
            }
        </style>
        <link rel="stylesheet" href="/css/extra.css" />
        <link rel="preload" href="/fonts/Inter-roman.var.woff2?v=26a312df" as="font" type="font/woff2" crossorigin />
        <link rel="preload" href="/fonts/Inter-italic.var.woff2?v=26a312df" as="font" type="font/woff2" crossorigin />

        <meta name="description" content="A next-generation test runner for Rust.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('rust')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Home</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="book/installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/pre-built-binaries.html"><strong aria-hidden="true">1.1.</strong> Pre-built binaries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/release-urls.html"><strong aria-hidden="true">1.1.1.</strong> Release URLs</a></li></ol></li><li class="chapter-item expanded "><a href="book/installing-from-source.html"><strong aria-hidden="true">1.2.</strong> Installing from source</a></li><li class="chapter-item expanded "><a href="book/updating.html"><strong aria-hidden="true">1.3.</strong> Updating nextest</a></li><li class="chapter-item expanded "><a href="book/antivirus-gatekeeper.html"><strong aria-hidden="true">1.4.</strong> Windows antivirus and macOS Gatekeeper</a></li></ol></li><li class="chapter-item expanded "><a href="book/usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/running.html"><strong aria-hidden="true">2.1.</strong> Running tests</a></li><li class="chapter-item expanded "><a href="book/listing.html"><strong aria-hidden="true">2.2.</strong> Listing tests</a></li><li class="chapter-item expanded "><a href="book/retries.html"><strong aria-hidden="true">2.3.</strong> Retries and flaky tests</a></li><li class="chapter-item expanded "><a href="book/slow-tests.html"><strong aria-hidden="true">2.4.</strong> Slow tests and timeouts</a></li><li class="chapter-item expanded "><a href="book/leaky-tests.html"><strong aria-hidden="true">2.5.</strong> Leaky tests</a></li><li class="chapter-item expanded "><a href="book/filter-expressions.html"><strong aria-hidden="true">2.6.</strong> Filter expressions</a></li><li class="chapter-item expanded "><a href="book/reusing-builds.html"><strong aria-hidden="true">2.7.</strong> Archiving and reusing builds</a></li><li class="chapter-item expanded "><a href="book/partitioning.html"><strong aria-hidden="true">2.8.</strong> Partitioning test runs in CI</a></li><li class="chapter-item expanded "><a href="book/target-runners.html"><strong aria-hidden="true">2.9.</strong> Target runners</a></li><li class="chapter-item expanded "><a href="book/other-options.html"><strong aria-hidden="true">2.10.</strong> Other options</a></li></ol></li><li class="chapter-item expanded "><a href="book/machine-readable.html"><strong aria-hidden="true">3.</strong> Machine-readable output</a></li><li class="chapter-item expanded "><a href="book/configuration.html"><strong aria-hidden="true">4.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/env-vars.html"><strong aria-hidden="true">4.1.</strong> Environment variables</a></li><li class="chapter-item expanded "><a href="book/minimum-versions.html"><strong aria-hidden="true">4.2.</strong> Minimum nextest versions</a></li><li class="chapter-item expanded "><a href="book/per-test-overrides.html"><strong aria-hidden="true">4.3.</strong> Per-test overrides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/specifying-platforms.html"><strong aria-hidden="true">4.3.1.</strong> Specifying platforms</a></li></ol></li><li class="chapter-item expanded "><a href="book/threads-required.html"><strong aria-hidden="true">4.4.</strong> Heavy tests and threads-required</a></li><li class="chapter-item expanded "><a href="book/test-groups.html"><strong aria-hidden="true">4.5.</strong> Test groups and mutual exclusion</a></li></ol></li><li class="chapter-item expanded "><a href="book/junit.html"><strong aria-hidden="true">5.</strong> JUnit support</a></li><li class="chapter-item expanded "><a href="book/integrations.html"><strong aria-hidden="true">6.</strong> Integrations with other tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/test-coverage.html"><strong aria-hidden="true">6.1.</strong> Test coverage</a></li><li class="chapter-item expanded "><a href="book/miri.html"><strong aria-hidden="true">6.2.</strong> The Miri interpreter</a></li><li class="chapter-item expanded "><a href="book/benchmark-integration.html"><strong aria-hidden="true">6.3.</strong> Criterion benchmarks</a></li><li class="chapter-item expanded "><a href="book/cargo-mutants.html"><strong aria-hidden="true">6.4.</strong> Mutation testing with cargo-mutants</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="book/stability.html"><strong aria-hidden="true">7.</strong> Stability policy</a></li><li class="chapter-item expanded "><a href="book/experimental-features.html"><strong aria-hidden="true">8.</strong> Experimental features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/setup-scripts.html"><strong aria-hidden="true">8.1.</strong> Setup scripts</a></li><li class="chapter-item expanded "><a href="book/run-machine-readable.html"><strong aria-hidden="true">8.2.</strong> Machine-readable output for test runs</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="book/how-it-works.html"><strong aria-hidden="true">9.</strong> How nextest works</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/benchmarks.html"><strong aria-hidden="true">9.1.</strong> Benchmarks</a></li><li class="chapter-item expanded "><a href="book/custom-test-harnesses.html"><strong aria-hidden="true">9.2.</strong> Custom test harnesses</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="CHANGELOG.html">Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">cargo-nextest</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nextest-rs/nextest" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cargo-nextest"><a class="header" href="#cargo-nextest">cargo-nextest</a></h1>
<p>Welcome to the home page for <strong>cargo-nextest</strong>, a next-generation test runner for Rust projects.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<img src="static/cover.png" id="nextest-cover">
<ul>
<li><strong>Clean, beautiful user interface.</strong> Nextest presents its results concisely so you can see which tests passed and failed at a glance.</li>
<li><strong><a href="book/benchmarks.html">Up to 3× as fast</a> as cargo test.</strong> Nextest uses a <a href="book/how-it-works.html">state-of-the-art execution model</a> for faster, more reliable test runs.</li>
<li><strong>Identify <a href="book/slow-tests.html">slow</a> and <a href="book/leaky-tests.html">leaky</a> tests.</strong> Use nextest to detect misbehaving tests, identify bottlenecks during test execution, and optionally terminate tests if they take too long.</li>
<li><strong>Filter tests using an embedded language.</strong> Use powerful <a href="book/filter-expressions.html">filter expressions</a> to specify granular subsets of tests on the command-line, and to enable <a href="book/per-test-overrides.html">per-test overrides</a>.</li>
<li><strong>Configure <a href="book/per-test-overrides.html">per-test overrides</a></strong>. <a href="book/retries.html#per-test-overrides">Automatically retry</a> subsets of tests, mark them as <a href="book/threads-required.html">heavy</a>, or <a href="book/test-groups.html">run them serially</a>.</li>
<li><strong>Designed for CI.</strong> Nextest addresses real-world pain points in continuous integration scenarios:
<ul>
<li>Use <strong><a href="book/pre-built-binaries.html">pre-built binaries</a></strong> for quick installation.</li>
<li>Set up CI-specific <strong><a href="book/configuration.html">configuration profiles</a></strong>.</li>
<li><strong><a href="book/reusing-builds.html">Reuse builds</a></strong> and <strong><a href="book/partitioning.html">partition test runs</a></strong> across multiple CI jobs. (Check out <a href="https://github.com/nextest-rs/reuse-build-partition-example/blob/main/.github/workflows/ci.yml">this example</a> on GitHub Actions).</li>
<li><a href="book/retries.html"><strong>Automatically retry</strong></a> failing tests, and mark them as flaky if they pass later.</li>
<li>Print failing output <strong><a href="book/other-options.html#reporter-options">at the end of test runs</a></strong>.</li>
<li>Output information about test runs as <strong><a href="book/junit.html">JUnit XML</a></strong>.</li>
</ul>
</li>
<li><strong>Cross-platform.</strong> Nextest works on Linux and other Unixes, Mac and Windows, so you get the benefits of faster test runs no matter what platform you use.</li>
<li>... and more <a href="https://github.com/nextest-rs/nextest/projects/1">coming soon</a>!</li>
</ul>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick start</a></h2>
<p>Install cargo-nextest for your platform using the <a href="book/pre-built-binaries.html">pre-built binaries</a>.</p>
<p>Run all tests in a workspace:</p>
<pre><code>cargo nextest run
</code></pre>
<p>For more detailed installation instructions, see <a href="book/installation.html">Installation</a>.</p>
<blockquote>
<p><strong>Note:</strong> Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust. For now, run doctests in a separate step with <code>cargo test --doc</code>.</p>
</blockquote>
<h2 id="crates-in-this-project"><a class="header" href="#crates-in-this-project">Crates in this project</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Crate</th><th style="text-align: center">crates.io</th><th style="text-align: center">rustdoc (latest version)</th><th style="text-align: center">rustdoc (main)</th></tr></thead><tbody>
<tr><td><strong>cargo-nextest,</strong> the main test binary</td><td style="text-align: center"><a href="https://crates.io/crates/cargo-nextest"><img src="https://img.shields.io/crates/v/cargo-nextest" alt="cargo-nextest on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/cargo-nextest"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/cargo_nextest"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>nextest-runner,</strong> core nextest logic</td><td style="text-align: center"><a href="https://crates.io/crates/nextest-runner"><img src="https://img.shields.io/crates/v/nextest-runner" alt="nextest-runner on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/nextest-runner"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/nextest_runner"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>nextest-metadata,</strong> parsers for machine-readable output</td><td style="text-align: center"><a href="https://crates.io/crates/nextest-metadata"><img src="https://img.shields.io/crates/v/nextest-metadata" alt="nextest-metadata on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/nextest-metadata"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/nextest_metadata"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>nextest-filtering,</strong> parser and evaluator for <a href="book/filter-expressions.html">filter expressions</a></td><td style="text-align: center"><a href="https://crates.io/crates/nextest-filtering"><img src="https://img.shields.io/crates/v/nextest-filtering" alt="nextest-filtering on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/nextest-filtering"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/nextest_filtering"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>quick-junit,</strong> JUnit XML serializer</td><td style="text-align: center"><a href="https://crates.io/crates/quick-junit"><img src="https://img.shields.io/crates/v/quick-junit" alt="quick-junit on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/quick-junit"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://quick-junit.nexte.st"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>datatest-stable,</strong> <a href="book/custom-test-harnesses.html">custom test harness</a> for data-driven tests</td><td style="text-align: center"><a href="https://crates.io/crates/datatest-stable"><img src="https://img.shields.io/crates/v/datatest-stable" alt="datatest-stable on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/datatest-stable"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://datatest-stable.nexte.st"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>future-queue,</strong> run queued futures with global and group limits</td><td style="text-align: center"><a href="https://crates.io/crates/future-queue"><img src="https://img.shields.io/crates/v/future-queue" alt="future-queue on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/future-queue"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nextest-rs.github.io/future-queue/rustdoc/future_queue/"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
</tbody></table>
</div>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>The source code for nextest and this site are hosted on GitHub, at
<a href="https://github.com/nextest-rs/nextest">https://github.com/nextest-rs/nextest</a>.</p>
<p>Contributions are welcome! Please see the <a href="https://github.com/nextest-rs/nextest/blob/main/CONTRIBUTING.md">CONTRIBUTING
file</a> for how to help out.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>The source code for nextest is licensed under the
<a href="https://github.com/nextest-rs/nextest/blob/main/LICENSE-MIT">MIT</a> and <a href="https://github.com/nextest-rs/nextest/blob/main/LICENSE-APACHE">Apache
2.0</a> licenses.</p>
<p>This document is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. This means that you are welcome to share, adapt or
modify this material as long as you give appropriate credit.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-and-usage"><a class="header" href="#installation-and-usage">Installation and usage</a></h1>
<p>cargo-nextest works on Linux and other Unix-like OSes, macOS, and Windows.</p>
<h2 id="installing-pre-built-binaries-recommended"><a class="header" href="#installing-pre-built-binaries-recommended">Installing pre-built binaries (recommended)</a></h2>
<p>cargo-nextest is available as pre-built binaries. See <a href="book/pre-built-binaries.html">Pre-built binaries</a> for more information.</p>
<h2 id="installing-from-source"><a class="header" href="#installing-from-source">Installing from source</a></h2>
<p>If pre-built binaries are not available for your platform, or you'd like to otherwise install cargo-nextest from source, see <a href="book/installing-from-source.html">Installing from source</a> for more information.</p>
<h2 id="windows-antivirus-and-macos-gatekeeper"><a class="header" href="#windows-antivirus-and-macos-gatekeeper">Windows antivirus and macOS Gatekeeper</a></h2>
<p>For notes about platform-specific performance issues caused by anti-malware software on Windows and macOS, see <a href="book/antivirus-gatekeeper.html">Windows antivirus and macOS Gatekeeper</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-pre-built-binaries"><a class="header" href="#installing-pre-built-binaries">Installing pre-built binaries</a></h1>
<p>The quickest way to get going with nextest is to download a pre-built binary for your platform. The latest nextest release is available at:</p>
<ul>
<li><a href="https://get.nexte.st/latest/linux"><strong>get.nexte.st/latest/linux</strong></a> for Linux x86_64, including Windows Subsystem for Linux (WSL)<sup class="footnote-reference"><a href="#glibc">1</a></sup></li>
<li><a href="https://get.nexte.st/latest/linux-arm"><strong>get.nexte.st/latest/linux-arm</strong></a> for Linux aarch64<sup class="footnote-reference"><a href="#glibc">1</a></sup></li>
<li><a href="https://get.nexte.st/latest/mac"><strong>get.nexte.st/latest/mac</strong></a> for macOS, both x86_64 and Apple Silicon</li>
<li><a href="https://get.nexte.st/latest/windows"><strong>get.nexte.st/latest/windows</strong></a> for Windows x86_64</li>
</ul>
<details>
<summary><i>Other platforms</i></summary>
<p>Nextest's CI isn't run on these platforms -- these binaries most likely work but aren't guaranteed to do so.</p>
<ul>
<li><a href="https://get.nexte.st/latest/linux-musl"><strong>get.nexte.st/latest/linux-musl</strong></a> for Linux x86_64, with musl libc<sup class="footnote-reference"><a href="#musl">2</a></sup></li>
<li><a href="https://get.nexte.st/latest/windows-x86"><strong>get.nexte.st/latest/windows-x86</strong></a> for Windows i686</li>
<li><a href="https://get.nexte.st/latest/freebsd"><strong>get.nexte.st/latest/freebsd</strong></a> for FreeBSD x86_64</li>
<li><a href="https://get.nexte.st/latest/illumos"><strong>get.nexte.st/latest/illumos</strong></a> for illumos x86_64</li>
</ul>
</details>
<p>These archives contain a single binary called <code>cargo-nextest</code> (<code>cargo-nextest.exe</code> on Windows). Add this binary to a location on your PATH.</p>
<div class="footnote-definition" id="glibc"><sup class="footnote-definition-label">1</sup>
<p>The standard Linux binaries target glibc, and have a minimum requirement of glibc 2.27 (Ubuntu 18.04).</p>
</div>
<div class="footnote-definition" id="musl"><sup class="footnote-definition-label">2</sup>
<p>Rust targeting Linux with musl currently has <a href="https://github.com/rust-lang/rust/issues/99740">a bug</a> that Rust targeting Linux with glibc doesn't have. This bug means that nextest's linux-musl binary has slower test runs and is susceptible to signal-related races. Only use the linux-musl binary if the standard Linux binary doesn't work in your environment.</p>
</div>
<h2 id="downloading-and-installing-from-your-terminal"><a class="header" href="#downloading-and-installing-from-your-terminal">Downloading and installing from your terminal</a></h2>
<p>The instructions below are suitable for both end users and CI. These links will stay stable.</p>
<blockquote>
<p><strong>Note:</strong> The instructions below assume that your Rust installation is managed via rustup. You can extract the archive to a different directory in your PATH if required.</p>
<p>If you'd like to stay on the 0.9 series to avoid breaking changes (see the <a href="book/stability.html">stability policy</a> for more), replace <code>latest</code> in the URL with <code>0.9</code>.</p>
</blockquote>
<h4 id="linux-x86_64"><a class="header" href="#linux-x86_64">Linux x86_64</a></h4>
<pre><code>curl -LsSf https://get.nexte.st/latest/linux | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<h4 id="linux-aarch64"><a class="header" href="#linux-aarch64">Linux aarch64</a></h4>
<pre><code>curl -LsSf https://get.nexte.st/latest/linux-arm | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<h4 id="macos-x86_64-and-apple-silicon"><a class="header" href="#macos-x86_64-and-apple-silicon">macOS (x86_64 and Apple Silicon)</a></h4>
<pre><code>curl -LsSf https://get.nexte.st/latest/mac | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<p>This will download a universal binary that works on both Intel and Apple Silicon Macs.</p>
<h4 id="windows-x86_64-using-powershell"><a class="header" href="#windows-x86_64-using-powershell">Windows x86_64 using PowerShell</a></h4>
<p>Run this in PowerShell:</p>
<pre><code class="language-powershell">$tmp = New-TemporaryFile | Rename-Item -NewName { $_ -replace 'tmp$', 'zip' } -PassThru
Invoke-WebRequest -OutFile $tmp https://get.nexte.st/latest/windows
$outputDir = if ($Env:CARGO_HOME) { Join-Path $Env:CARGO_HOME "bin" } else { "~/.cargo/bin" }
$tmp | Expand-Archive -DestinationPath $outputDir -Force
$tmp | Remove-Item
</code></pre>
<h4 id="windows-x86_64-using-unix-tools"><a class="header" href="#windows-x86_64-using-unix-tools">Windows x86_64 using Unix tools</a></h4>
<p>If you have access to a Unix shell, <code>curl</code> and <code>tar</code> <em>natively</em> on Windows (for example if you're using <code>shell: bash</code> on GitHub Actions):</p>
<pre><code>curl -LsSf https://get.nexte.st/latest/windows-tar | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<blockquote>
<p><strong>Note:</strong> Windows Subsystem for Linux (WSL) users should follow the <a href="book/pre-built-binaries.html#linux-x86_64">Linux x86_64 instructions</a>.</p>
<p>If you're a Windows expert who can come up with a better way to do this, please <a href="https://github.com/nextest-rs/nextest/issues/31">add a suggestion to this issue</a>!</p>
</blockquote>
<details>
<summary><i>Other platforms</i></summary>
<h4 id="freebsd-x86_64"><a class="header" href="#freebsd-x86_64">FreeBSD x86_64</a></h4>
<pre><code>curl -LsSf https://get.nexte.st/latest/freebsd | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<h4 id="illumos-x86_64"><a class="header" href="#illumos-x86_64">illumos x86_64</a></h4>
<pre><code>curl -LsSf https://get.nexte.st/latest/illumos | gunzip | tar xf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<p>As of 2022-12, the current version of illumos tar has <a href="https://www.illumos.org/issues/15228">a bug</a> where <code>tar zxf</code> doesn't work over standard input.</p>
</details>
<h3 id="using-cargo-binstall"><a class="header" href="#using-cargo-binstall">Using cargo-binstall</a></h3>
<p>If you have <a href="https://github.com/ryankurte/cargo-binstall">cargo-binstall</a> available, you can install nextest with:</p>
<pre><code>cargo binstall cargo-nextest --secure
</code></pre>
<h2 id="community-maintained-binaries"><a class="header" href="#community-maintained-binaries">Community-maintained binaries</a></h2>
<p>These binaries are maintained by the community—<em>thank you!</em></p>
<h3 id="homebrew"><a class="header" href="#homebrew">Homebrew</a></h3>
<p>To install nextest with Homebrew, on macOS or Linux:</p>
<pre><code>brew install cargo-nextest
</code></pre>
<h3 id="arch-linux"><a class="header" href="#arch-linux">Arch Linux</a></h3>
<p>On <a href="https://archlinux.org">Arch Linux</a>, install nextest with <a href="https://wiki.archlinux.org/title/Pacman">pacman</a> by running:</p>
<pre><code>pacman -S cargo-nextest
</code></pre>
<h2 id="using-pre-built-binaries-in-ci"><a class="header" href="#using-pre-built-binaries-in-ci">Using pre-built binaries in CI</a></h2>
<p>Pre-built binaries can be used in continuous integration to speed up test runs.</p>
<h3 id="using-nextest-in-github-actions"><a class="header" href="#using-nextest-in-github-actions">Using nextest in GitHub Actions</a></h3>
<p>The easiest way to install nextest in GitHub Actions is to use the <a href="https://github.com/marketplace/actions/install-development-tools">Install Development Tools</a> action maintained by <a href="https://github.com/taiki-e">Taiki Endo</a>.</p>
<p>To install the latest version of nextest, add this to your job after installing Rust and Cargo:</p>
<pre><code class="language-yml">- uses: taiki-e/install-action@nextest
</code></pre>
<p><a href="https://github.com/nextest-rs/nextest/blob/5b59a5c5d1a051ce651e5d632c93a849f97a9d4b/.github/workflows/ci.yml#L101-L102">See this in practice with nextest's own CI.</a></p>
<p>The action will download pre-built binaries from the URL above and add them to <code>.cargo/bin</code>.</p>
<p>To install a version series or specific version, use this instead:</p>
<pre><code class="language-yml">- uses: taiki-e/install-action@v2
  with:
    tool: nextest
    ## version (defaults to "latest") can be a series like 0.9:
    # tool: nextest@0.9
    ## version can also be a specific version like 0.9.11:
    # tool: nextest@0.9.11
</code></pre>
<blockquote>
<p><strong>Tip:</strong> GitHub Actions supports ANSI color codes. To get color support for nextest (and Cargo), add this to your workflow:</p>
<pre><code class="language-yml">env:
  CARGO_TERM_COLOR: always
</code></pre>
<p>For a full list of environment variables supported by nextest, see <a href="book/env-vars.html">Environment variables</a>.</p>
</blockquote>
<h3 id="other-ci-systems"><a class="header" href="#other-ci-systems">Other CI systems</a></h3>
<p>Install pre-built binaries on other CI systems by downloading and extracting the respective archives, using the commands above as a guide. See <a href="book/release-urls.html">Release URLs</a> for more about how to specify nextest versions and platforms.</p>
<blockquote>
<p>If you've made it easy to install nextest on another CI system, feel free to <a href="https://github.com/nextest-rs/nextest/pulls">submit a pull request</a> with documentation.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-urls"><a class="header" href="#release-urls">Release URLs</a></h1>
<p>Binary releases of cargo-nextest will always be available at <strong><code>https://get.nexte.st/{version}/{platform}</code></strong>.</p>
<h2 id="version-identifier"><a class="header" href="#version-identifier"><code>{version}</code> identifier</a></h2>
<p>The <code>{version}</code> identifier is:</p>
<ul>
<li><code>latest</code> for the latest release (not including pre-releases)</li>
<li>a version range, for example <code>0.9</code>, for the latest release in the 0.9 series (not including pre-releases)</li>
<li>the exact version number, for example <code>0.9.4</code>, for that specific version</li>
</ul>
<h2 id="platform-identifier"><a class="header" href="#platform-identifier"><code>{platform}</code> identifier</a></h2>
<p>The <code>{platform}</code> identifier is:</p>
<ul>
<li><code>x86_64-unknown-linux-gnu.tar.gz</code> for x86_64 Linux (tar.gz)</li>
<li><code>x86_64-unknown-linux-musl.tar.gz</code> for x86_64 Linux with <a href="https://musl.libc.org/">musl</a> (tar.gz, available for version 0.9.29+)</li>
<li><code>aarch64-unknown-linux-gnu.tar.gz</code> for aarch64 Linux (tar.gz, available for version 0.9.29+)</li>
<li><code>universal-apple-darwin.tar.gz</code> for x86_64 and arm64 macOS (tar.gz)</li>
<li><code>x86_64-pc-windows-msvc.zip</code> for x86_64 Windows (zip)</li>
<li><code>x86_64-pc-windows-msvc.tar.gz</code> for x86_64 Windows (tar.gz)</li>
<li><code>i686-pc-windows-msvc.zip</code> for i686 Windows (zip)</li>
<li><code>i686-pc-windows-msvc.tar.gz</code> for i686 Windows (tar.gz)</li>
<li><code>x86_64-unknown-freebsd.tar.gz</code> for x86_64 FreeBSD (tar.gz)</li>
<li><code>x86_64-unknown-illumos.tar.gz</code> for x86_64 illumos (tar.gz)</li>
</ul>
<p>For convenience, the following shortcuts are defined:</p>
<ul>
<li><code>linux</code> points to <code>x86_64-unknown-linux-gnu.tar.gz</code></li>
<li><code>linux-musl</code> points to <code>x86_64-unknown-linux-musl.tar.gz</code></li>
<li><code>linux-arm</code> points to <code>aarch64-unknown-linux-gnu.tar.gz</code></li>
<li><code>mac</code> points to <code>universal-apple-darwin.tar.gz</code></li>
<li><code>windows</code> points to <code>x86_64-pc-windows-msvc.zip</code></li>
<li><code>windows-tar</code> points to <code>x86_64-pc-windows-msvc.tar.gz</code></li>
<li><code>windows-x86</code> points to <code>i686-pc-windows-msvc.zip</code></li>
<li><code>windows-x86-tar</code> points to <code>i686-pc-windows-msvc.tar.gz</code></li>
<li><code>freebsd</code> points to <code>x86_64-unknown-freebsd.tar.gz</code></li>
<li><code>illumos</code> points to <code>x86_64-unknown-illumos.tar.gz</code></li>
</ul>
<p>Also, each release's canonical GitHub Releases URL is available at <strong><code>https://get.nexte.st/{version}/release</code></strong>. For example, the latest GitHub release is available at <a href="https://get.nexte.st/latest/release">get.nexte.st/latest/release</a>.</p>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<p>The latest nextest release in the 0.9 series for macOS is available as a tar.gz file at <a href="https://get.nexte.st/0.9/mac">get.nexte.st/0.9/mac</a>.</p>
<p>Nextest version 0.9.11 for Windows is available as a zip file at <a href="https://get.nexte.st/0.9.11/windows">get.nexte.st/0.9.11/windows</a>, and as a tar.gz file at <a href="https://get.nexte.st/0.9.11/windows-tar">get.nexte.st/0.9.11/windows-tar</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-from-source-1"><a class="header" href="#installing-from-source-1">Installing from source</a></h1>
<p>If pre-built binaries are not available for your platform, or you'd otherwise like to install cargo-nextest from source, here's what you need to do:</p>
<h2 id="installing-from-cratesio"><a class="header" href="#installing-from-cratesio">Installing from crates.io</a></h2>
<p>Run the following command:</p>
<pre><code>cargo install cargo-nextest --locked
</code></pre>
<blockquote>
<p><strong>Note:</strong> A plain <code>cargo install cargo-nextest</code> without <code>--locked</code> is <strong>not supported</strong>. If you run into build issues, please try with <code>--locked</code> before reporting an issue.</p>
</blockquote>
<p><code>cargo nextest</code> must be compiled and installed with <strong>Rust 1.73</strong> or later (see <a href="book/stability.html#minimum-supported-rust-version-msrv">Stability policy</a> for more), but it can build and run
tests against any version of Rust.</p>
<h2 id="using-a-cached-install-in-ci"><a class="header" href="#using-a-cached-install-in-ci">Using a cached install in CI</a></h2>
<p>Most CI users of nextest will benefit from using cached binaries. Consider using the <a href="book/pre-built-binaries.html">pre-built binaries</a> for this purpose.</p>
<p><a href="https://github.com/nextest-rs/nextest/blob/0eadcdfa349ff36354de464ecf6002d89ff50fe6/.github/workflows/ci.yml#L124-L125">See this example for how the nextest repository uses pre-built binaries.</a>.</p>
<p>If your CI is based on GitHub Actions, you may use the
<a href="https://github.com/marketplace/actions/cargo-install">baptiste0928/cargo-install</a> action to build cargo-nextest from source and cache
the cargo-nextest binary.</p>
<pre><code class="language-yml">jobs:
  ci:
    # ...
    steps:
      - uses: actions/checkout@v3
      # Install a Rust toolchain here.
      - name: Install cargo-nextest
        uses: baptiste0928/cargo-install@v1
        with:
          crate: cargo-nextest
          locked: true
          # Uncomment the following line if you'd like to stay on the 0.9 series
          # version: 0.9
      # At this point, cargo-nextest will be available on your PATH
</code></pre>
<p>Also consider using the <a href="https://github.com/marketplace/actions/rust-cache">Swatinem/rust-cache</a>
action to make your builds faster.</p>
<h2 id="installing-from-github"><a class="header" href="#installing-from-github">Installing from GitHub</a></h2>
<p>Install the latest, in-development version of cargo-nextest from the GitHub repository:</p>
<pre><code>cargo install --git https://github.com/nextest-rs/nextest --bin cargo-nextest
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="updating-nextest"><a class="header" href="#updating-nextest">Updating nextest</a></h1>
<p>Starting version 0.9.19, cargo-nextest has update functionality built-in. Simply run <code>cargo nextest self update</code> to check for and perform updates.</p>
<p>The nextest updater downloads and installs the latest version of the cargo-nextest binary from <a href="https://get.nexte.st">get.nexte.st</a>.</p>
<p>To request a specific version, run (e.g.) <code>cargo nextest self update --version 0.9.19</code>.</p>
<h2 id="for-older-versions"><a class="header" href="#for-older-versions">For older versions</a></h2>
<p>If you're on cargo-nextest 0.9.18 or below, update by redownloading and reinstalling the binary following the instructions at <a href="book/pre-built-binaries.html">Pre-built binaries</a>.</p>
<h2 id="for-distributors"><a class="header" href="#for-distributors">For distributors</a></h2>
<p><code>cargo-nextest</code> 0.9.21 and above has a new <code>default-no-update</code> feature, which will contain all default features except for self-update. The recommended, forward-compatible way to build cargo-nextest is with <code>--no-default-features --features default-no-update</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="windows-antivirus-and-macos-gatekeeper-1"><a class="header" href="#windows-antivirus-and-macos-gatekeeper-1">Windows antivirus and macOS Gatekeeper</a></h1>
<p>This page covers common performance issues caused by anti-malware protections on Windows and macOS. These performance issues are not unique to nextest, but <a href="book/how-it-works.html">its execution model</a> may exacerbate them.</p>
<h2 id="windows"><a class="header" href="#windows">Windows</a></h2>
<p>Your antivirus software—typically Windows Security, also known as Microsoft Defender—might interfere with process execution, making your test runs significantly slower. For optimal performance, exclude the following directories from checks:</p>
<ul>
<li>The directory with all your code in it</li>
<li>Your <code>.cargo\bin</code> directory, typically within your home directory (see <a href="https://github.com/rust-lang/cargo/issues/5028">this Rust issue</a>).</li>
</ul>
<p><a href="https://support.microsoft.com/en-us/windows/add-an-exclusion-to-windows-security-811816c0-4dfd-af4a-47e4-c301afe13b26">Here's how to exclude directories from Windows Security.</a></p>
<p><img src="book/../static/windows-exclusions.png" alt="Windows Security exclusion list example" /></p>
<h2 id="macos"><a class="header" href="#macos">macOS</a></h2>
<p>Similar to Windows Security, macOS has a system called Gatekeeper which performs checks on binaries. Gatekeeper can cause nextest runs to be significantly slower. A typical sign of this happening is even the simplest of tests in <code>cargo nextest run</code> taking more than 0.2 seconds.</p>
<p>Adding your terminal to Developer Tools will cause any processes run by it to be excluded from Gatekeeper. <strong>For optimal performance, add your terminal to Developer Tools.</strong> You may also need to run <code>cargo clean</code> afterwards.</p>
<h3 id="how-to-add-your-terminal-to-developer-tools"><a class="header" href="#how-to-add-your-terminal-to-developer-tools">How to add your terminal to Developer Tools</a></h3>
<ol>
<li>Run <code>sudo spctl developer-mode enable-terminal</code> in your terminal.</li>
<li>Go to System Preferences, and then to Security &amp; Privacy.</li>
<li>Under the Privacy tab, an item called <code>Developer Tools</code> should be present. Navigate to it.</li>
<li>Ensure that your terminal is listed and enabled. If you're using a third-party terminal like iTerm, be sure to add it to the list (You may have to click the lock in the bottom-left corner and authenticate).</li>
<li>Restart your terminal.</li>
</ol>
<p><a href="https://news.ycombinator.com/item?id=24394150">See this comment on Hacker News for more.</a></p>
<p><img src="book/../static/macos-exclusions.png" alt="macOS Developer Tools with Terminal.app enabled" /></p>
<blockquote>
<p>There are still some reports of performance issues on macOS after Developer Tools have been enabled. If you're seeing this, please <a href="https://github.com/nextest-rs/nextest/issues/63">add a note to this issue</a>!</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>This section covers usage, features and options for cargo-nextest.</p>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic usage</a></h2>
<p>To build and run all tests in a workspace, cd into the workspace and run:</p>
<pre><code>cargo nextest run
</code></pre>
<p>For more information about running tests, see <a href="book/running.html">Running tests</a>.</p>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<ul>
<li>
<p>The <a href="book/how-it-works.html">nextest execution model</a> means that <strong>each individual test is executed as a separate process</strong>. Tests that depend on being executed within the same process <a href="https://github.com/nextest-rs/nextest/issues/27">may not work correctly</a>.</p>
<p>To work around this, consider combining those tests into one so that nextest runs them as a
unit, or excluding those tests from nextest.</p>
</li>
<li>
<p>There's <a href="https://github.com/nextest-rs/nextest/issues/28">no way</a> to mark a particular test binary as excluded from nextest.</p>
</li>
<li>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust. Locally and in CI, after <code>cargo nextest run</code>, use <code>cargo test --doc</code> to run all doctests.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-tests"><a class="header" href="#running-tests">Running tests</a></h1>
<p>To build and run all tests in a workspace<sup class="footnote-reference"><a href="#doctest">1</a></sup>, cd into the workspace and run:</p>
<pre><code>cargo nextest run
</code></pre>
<p>This will produce output that looks like:</p>
<p><img src="book/../static/nextest-run.png" alt="Output of cargo nextest run" /></p>
<p>In the output above:</p>
<ul>
<li>
<p>Tests are marked <strong><code>PASS</code></strong> or <strong><code>FAIL</code></strong>, and the amount of wall-clock time each test takes is listed within square brackets. In the example above, <strong><code>test_list_tests</code></strong> passed and took 0.052 seconds to execute.</p>
</li>
<li>
<p>Tests that take more than a specified amount of time are marked <strong>SLOW</strong>. The timeout is 60 seconds by default, and can be <a href="book/configuration.html">changed through configuration</a>.</p>
</li>
<li>
<p>The part of the test in purple is the <em>binary ID</em> for a unit test binary (see <a href="book/running.html#binary-ids">Binary IDs</a> below).</p>
</li>
<li>
<p>The part after the binary ID is the <em>test name</em>, including the module the test is in. The final part of the test name is highlighted in bold blue text.</p>
</li>
</ul>
<p><code>cargo nextest run</code> supports all the options that <code>cargo test</code> does. For example, to only execute tests for a package called <code>my-package</code>:</p>
<pre><code>cargo nextest run -p my-package
</code></pre>
<p>For a full list of options accepted by <code>cargo nextest run</code>, see <code>cargo nextest run --help</code>.</p>
<h2 id="binary-ids"><a class="header" href="#binary-ids">Binary IDs</a></h2>
<p>A test binary can be any of:</p>
<ul>
<li>A <em>unit test binary</em> built from tests within <code>lib.rs</code> or its submodules. The binary ID for these are shown by nextest as just the crate name, without a <code>::</code> separator inside them.</li>
<li>An <em>integration test binary</em> built from tests in the <code>[[test]]</code> section of <code>Cargo.toml</code> (typically tests in the <code>tests</code> directory.) The binary ID for these is has the format <code>crate-name::bin-name</code>.</li>
<li>Some other kind of test binary, such as a benchmark. In this case, the binary ID is <code>crate-name::kind/bin-name</code>. For example, <code>nextest-runner::bench/my-bench</code> or <code>quick-junit::example/show-junit</code>.</li>
</ul>
<p>For more about unit and integration tests, see <a href="https://doc.rust-lang.org/cargo/commands/cargo-test.html">the documentation for <code>cargo test</code></a>.</p>
<h2 id="filtering-tests"><a class="header" href="#filtering-tests">Filtering tests</a></h2>
<p>To only run tests that match certain names:</p>
<pre><code>cargo nextest run &lt;test-name1&gt; &lt;test-name2&gt;...
</code></pre>
<h3 id="--skip-and---exact"><a class="header" href="#--skip-and---exact"><code>--skip</code> and <code>--exact</code></a></h3>
<p>Nextest does not support <code>--skip</code> and <code>--exact</code> directly; instead, it supports more powerful <a href="book/filter-expressions.html">filter expressions</a> which supersede these options.</p>
<p>Here are some examples:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Cargo test command</th><th style="text-align: center">Nextest command</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>cargo test -- --skip skip1 --skip skip2 test3</code></td><td style="text-align: center"><code>cargo nextest run -E 'test(test3) - test(/skip[12]/)'</code></td></tr>
<tr><td style="text-align: center"><code>cargo test -- --exact test1 test2</code></td><td style="text-align: center"><code>cargo nextest run -E 'test(=test1) + test(=test2)'</code></td></tr>
</tbody></table>
</div>
<h3 id="filtering-by-build-platform"><a class="header" href="#filtering-by-build-platform">Filtering by build platform</a></h3>
<p>While cross-compiling code, some tests (e.g. proc-macro tests) may need to be run on the host platform. To filter tests based on the build platform they're for, nextest's filter expressions accept the <code>platform()</code> set with values <code>target</code> and <code>host</code>.</p>
<p>For example, to only run tests for the host platform:</p>
<pre><code>cargo nextest run -E 'platform(host)'
</code></pre>
<h2 id="displaying-live-test-output"><a class="header" href="#displaying-live-test-output">Displaying live test output</a></h2>
<p>By default, <code>cargo nextest run</code> will capture test output and only display it on failure. If you do <em>not</em> want to capture test output:</p>
<pre><code>cargo nextest run --no-capture
</code></pre>
<p>In this mode, cargo-nextest will run tests <em>serially</em> so that output from different tests isn't interspersed. This is different from <code>cargo test -- --nocapture</code>, which will run tests in parallel.</p>
<div class="footnote-definition" id="doctest"><sup class="footnote-definition-label">1</sup>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust. For now, run doctests in a separate step with <code>cargo test --doc</code>.</p>
</div>
<h2 id="options-and-arguments"><a class="header" href="#options-and-arguments">Options and arguments</a></h2>
<pre><code>Build and run tests

Usage: cargo nextest run [OPTIONS] [FILTERS]... [-- &lt;TEST-BINARY-ARGS&gt;...]

Arguments:
  [FILTERS]...           Test name filter
  [TEST-BINARY-ARGS]...  Emulated cargo test binary arguments (partially supported)

Options:
  -P, --profile &lt;PROFILE&gt;  Nextest profile to use [env: NEXTEST_PROFILE=]
  -v, --verbose            Verbose output [env: NEXTEST_VERBOSE=]
      --color &lt;WHEN&gt;       Produce color output: auto, always, never [env: CARGO_TERM_COLOR=] [default: auto]
  -h, --help               Print help (see more with '--help')

Package selection:
  -p, --package &lt;PACKAGES&gt;  Package to test
      --workspace           Test all packages in the workspace
      --exclude &lt;EXCLUDE&gt;   Exclude packages from the test
      --all                 Alias for --workspace (deprecated)

Target selection:
      --lib                Test only this package's library unit tests
      --bin &lt;BIN&gt;          Test only the specified binary
      --bins               Test all binaries
      --example &lt;EXAMPLE&gt;  Test only the specified example
      --examples           Test all examples
      --test &lt;TEST&gt;        Test only the specified test target
      --tests              Test all targets
      --bench &lt;BENCH&gt;      Test only the specified bench target
      --benches            Test all benches
      --all-targets        Test all targets

Feature selection:
  -F, --features &lt;FEATURES&gt;  Space or comma separated list of features to activate
      --all-features         Activate all available features
      --no-default-features  Do not activate the `default` feature

Compilation options:
      --build-jobs &lt;N&gt;        Number of build jobs to run
  -r, --release               Build artifacts in release mode, with optimizations
      --cargo-profile &lt;NAME&gt;  Build artifacts with the specified Cargo profile
      --target &lt;TRIPLE&gt;       Build for the target triple
      --target-dir &lt;DIR&gt;      Directory for all generated artifacts
      --unit-graph            Output build graph in JSON (unstable)
      --timings[=&lt;FMTS&gt;]      Timing output formats (unstable) (comma separated): html, json

Manifest options:
      --manifest-path &lt;PATH&gt;  Path to Cargo.toml
      --frozen                Require Cargo.lock and cache are up to date
      --locked                Require Cargo.lock is up to date
      --offline               Run without accessing the network

Other Cargo options:
      --cargo-quiet             Do not print cargo log messages
      --cargo-verbose...        Use cargo verbose output (specify twice for very verbose/build.rs output)
      --ignore-rust-version     Ignore `rust-version` specification in packages
      --future-incompat-report  Outputs a future incompatibility report at the end of the build
      --config &lt;KEY=VALUE&gt;      Override a configuration value
  -Z &lt;FLAG&gt;                     Unstable (nightly-only) flags to Cargo, see 'cargo -Z help' for details

Filter options:
      --run-ignored &lt;WHICH&gt;    Run ignored tests [possible values: default, ignored-only, all]
      --partition &lt;PARTITION&gt;  Test partition, e.g. hash:1/2 or count:2/3
  -E, --filter-expr &lt;EXPR&gt;     Test filter expression (see 
                               &lt;https://nexte.st/book/filter-expressions&gt;)

Runner options:
      --no-run            Compile, but don't run tests
  -j, --test-threads &lt;N&gt;  Number of tests to run simultaneously [possible values: integer or "num-cpus"] [default: from profile] [env: NEXTEST_TEST_THREADS=] [aliases: jobs]
      --retries &lt;N&gt;       Number of retries for failing tests [default: from profile] [env: NEXTEST_RETRIES=]
      --fail-fast         Cancel test run on the first failure
      --no-fail-fast      Run all tests regardless of failure
      --no-capture        Run tests serially and do not capture output

Reporter options:
      --failure-output &lt;WHEN&gt;       Output stdout and stderr on failure [env: NEXTEST_FAILURE_OUTPUT=] [possible values: immediate, immediate-final, final, never]
      --success-output &lt;WHEN&gt;       Output stdout and stderr on success [env: NEXTEST_SUCCESS_OUTPUT=] [possible values: immediate, immediate-final, final, never]
      --status-level &lt;LEVEL&gt;        Test statuses to output [env: NEXTEST_STATUS_LEVEL=] [possible values: none, fail, retry, slow, leak, pass, skip, all]
      --final-status-level &lt;LEVEL&gt;  Test statuses to output at the end of the run [env: NEXTEST_FINAL_STATUS_LEVEL=] [possible values: none, fail, flaky, slow, skip, pass, all]
      --hide-progress-bar           Do not display the progress bar [env: NEXTEST_HIDE_PROGRESS_BAR=]

Reuse build options:
      --archive-file &lt;PATH&gt;       Path to nextest archive
      --archive-format &lt;FORMAT&gt;   Archive format [default: auto] [possible values: auto, tar-zst]
      --extract-to &lt;DIR&gt;          Destination directory to extract archive to [default: temporary directory]
      --extract-overwrite         Overwrite files in destination directory while extracting archive
      --persist-extract-tempdir   Persist extracted temporary directory
      --cargo-metadata &lt;PATH&gt;     Path to cargo metadata JSON
      --workspace-remap &lt;PATH&gt;    Remapping for the workspace root
      --binaries-metadata &lt;PATH&gt;  Path to binaries-metadata JSON
      --target-dir-remap &lt;PATH&gt;   Remapping for the target directory

Config options:
      --config-file &lt;PATH&gt;
          Config file [default: workspace-root/.config/nextest.toml]
      --tool-config-file &lt;TOOL:ABS_PATH&gt;
          Tool-specific config files
      --override-version-check
          Override checks for the minimum version defined in nextest's config
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listing-tests"><a class="header" href="#listing-tests">Listing tests</a></h1>
<p>To build and list all tests in a workspace<sup class="footnote-reference"><a href="#doctest">1</a></sup>, cd into the workspace and run:</p>
<pre><code>cargo nextest list
</code></pre>
<p><code>cargo nextest list</code> takes most of the same options that <code>cargo nextest run</code> takes. For a full list of options accepted, see <code>cargo nextest list --help</code>.</p>
<p><img src="book/../static/nextest-list.png" alt="Output of cargo nextest list" /></p>
<div class="footnote-definition" id="doctest"><sup class="footnote-definition-label">1</sup>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust. For now, run doctests in a separate step with <code>cargo test --doc</code>.</p>
</div>
<h2 id="options-and-arguments-1"><a class="header" href="#options-and-arguments-1">Options and arguments</a></h2>
<pre><code>List tests in workspace

Usage: cargo nextest list [OPTIONS] [FILTERS]... [-- &lt;TEST-BINARY-ARGS&gt;...]

Arguments:
  [FILTERS]...           Test name filter
  [TEST-BINARY-ARGS]...  Emulated cargo test binary arguments (partially supported)

Options:
  -v, --verbose       Verbose output [env: NEXTEST_VERBOSE=]
      --color &lt;WHEN&gt;  Produce color output: auto, always, never [env: CARGO_TERM_COLOR=] [default: auto]
  -h, --help          Print help (see more with '--help')

Package selection:
  -p, --package &lt;PACKAGES&gt;  Package to test
      --workspace           Test all packages in the workspace
      --exclude &lt;EXCLUDE&gt;   Exclude packages from the test
      --all                 Alias for --workspace (deprecated)

Target selection:
      --lib                Test only this package's library unit tests
      --bin &lt;BIN&gt;          Test only the specified binary
      --bins               Test all binaries
      --example &lt;EXAMPLE&gt;  Test only the specified example
      --examples           Test all examples
      --test &lt;TEST&gt;        Test only the specified test target
      --tests              Test all targets
      --bench &lt;BENCH&gt;      Test only the specified bench target
      --benches            Test all benches
      --all-targets        Test all targets

Feature selection:
  -F, --features &lt;FEATURES&gt;  Space or comma separated list of features to activate
      --all-features         Activate all available features
      --no-default-features  Do not activate the `default` feature

Compilation options:
      --build-jobs &lt;N&gt;        Number of build jobs to run
  -r, --release               Build artifacts in release mode, with optimizations
      --cargo-profile &lt;NAME&gt;  Build artifacts with the specified Cargo profile
      --target &lt;TRIPLE&gt;       Build for the target triple
      --target-dir &lt;DIR&gt;      Directory for all generated artifacts
      --unit-graph            Output build graph in JSON (unstable)
      --timings[=&lt;FMTS&gt;]      Timing output formats (unstable) (comma separated): html, json

Manifest options:
      --manifest-path &lt;PATH&gt;  Path to Cargo.toml
      --frozen                Require Cargo.lock and cache are up to date
      --locked                Require Cargo.lock is up to date
      --offline               Run without accessing the network

Other Cargo options:
      --cargo-quiet             Do not print cargo log messages
      --cargo-verbose...        Use cargo verbose output (specify twice for very verbose/build.rs output)
      --ignore-rust-version     Ignore `rust-version` specification in packages
      --future-incompat-report  Outputs a future incompatibility report at the end of the build
      --config &lt;KEY=VALUE&gt;      Override a configuration value
  -Z &lt;FLAG&gt;                     Unstable (nightly-only) flags to Cargo, see 'cargo -Z help' for details

Filter options:
      --run-ignored &lt;WHICH&gt;    Run ignored tests [possible values: default, ignored-only, all]
      --partition &lt;PARTITION&gt;  Test partition, e.g. hash:1/2 or count:2/3
  -E, --filter-expr &lt;EXPR&gt;     Test filter expression (see 
                               &lt;https://nexte.st/book/filter-expressions&gt;)

Output options:
  -T, --message-format &lt;FMT&gt;  Output format [default: human] [possible values: human, json, json-pretty]
      --list-type &lt;TYPE&gt;      Type of listing [default: full] [possible values: full, binaries-only]

Reuse build options:
      --archive-file &lt;PATH&gt;       Path to nextest archive
      --archive-format &lt;FORMAT&gt;   Archive format [default: auto] [possible values: auto, tar-zst]
      --extract-to &lt;DIR&gt;          Destination directory to extract archive to [default: temporary directory]
      --extract-overwrite         Overwrite files in destination directory while extracting archive
      --persist-extract-tempdir   Persist extracted temporary directory
      --cargo-metadata &lt;PATH&gt;     Path to cargo metadata JSON
      --workspace-remap &lt;PATH&gt;    Remapping for the workspace root
      --binaries-metadata &lt;PATH&gt;  Path to binaries-metadata JSON
      --target-dir-remap &lt;PATH&gt;   Remapping for the target directory

Config options:
      --config-file &lt;PATH&gt;
          Config file [default: workspace-root/.config/nextest.toml]
      --tool-config-file &lt;TOOL:ABS_PATH&gt;
          Tool-specific config files
      --override-version-check
          Override checks for the minimum version defined in nextest's config
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="retries-and-flaky-tests"><a class="header" href="#retries-and-flaky-tests">Retries and flaky tests</a></h1>
<p>Sometimes, tests fail nondeterministically, which can be quite annoying to developers locally and in CI. cargo-nextest supports <em>retrying</em> failed tests with the <code>--retries</code> option. If a test succeeds during a retry, the test is marked <em>flaky</em>. Here's an example:</p>
<p><img src="book/../static/nextest-retry.png" alt="Output of cargo nextest run --retries 2" /></p>
<p><code>--retries 2</code> means that the test is retried twice, for a total of three attempts. In this case, the test fails on the first try but succeeds on the second try. The <code>TRY 2 PASS</code> text means that the test passed on the second try.</p>
<p>Flaky tests are treated as ultimately successful. If there are no other tests that failed, the exit code for the test run is 0.</p>
<p>Retries can also be:</p>
<ul>
<li>passed in via the environment variable <code>NEXTEST_RETRIES</code>.</li>
<li><a href="book/configuration.html">configured in <code>.config/nextest.toml</code></a>.</li>
</ul>
<p>For the order that configuration parameters are resolved in, see <a href="book/configuration.html#hierarchical-configuration">Hierarchical configuration</a>.</p>
<h2 id="delays-and-backoff"><a class="header" href="#delays-and-backoff">Delays and backoff</a></h2>
<p>In some situations, you may wish to add delays between retries—for example, if your test hits a network service which is rate limited.</p>
<p>In those cases, you can insert delays between test attempts with a backoff algorithm.</p>
<blockquote>
<p><strong>Note:</strong> Delays and backoff can only be specified through configuration. Passing in <code>--retries</code> via the command line or specifying the <code>NEXTEST_RETRIES</code> environment variable will override delays and backoff specified through configuration.</p>
</blockquote>
<h3 id="fixed-backoff"><a class="header" href="#fixed-backoff">Fixed backoff</a></h3>
<p>To insert a constant delay between test attempts, use the fixed backoff algorithm. For example, to retry tests up to twice with a 1 second delay between attempts, use:</p>
<pre><code class="language-toml">[profile.default]
retries = { backoff = "fixed", count = 2, delay = "1s" }
</code></pre>
<h3 id="exponential-backoff"><a class="header" href="#exponential-backoff">Exponential backoff</a></h3>
<p>Nextest also supports <a href="https://en.wikipedia.org/wiki/Exponential_backoff">exponential backoff</a>, where the delay between attempts doubles each time. For example, to retry tests up to 3 times with successive delays of 5 seconds, 10 seconds, and 20 seconds, use:</p>
<pre><code class="language-toml">[profile.default]
retries = { backoff = "exponential", count = 3, delay = "5s" }
</code></pre>
<p>A maximum delay can also be specified to avoid delays from becoming too large. In the above example, if <code>count = 5</code>, the fourth and fifth retries would be with delays of 40 seconds and 80 seconds, respectively. To clamp delays at 30 seconds, use:</p>
<pre><code class="language-toml">[profile.default]
retries = { backoff = "exponential", count = 3, delay = "5s", max-delay = "30s" }
</code></pre>
<p>This effectively performs a <a href="https://en.wikipedia.org/wiki/Exponential_backoff#Truncated_exponential_backoff">truncated exponential backoff</a>.</p>
<h3 id="adding-jitter"><a class="header" href="#adding-jitter">Adding jitter</a></h3>
<p>To avoid <a href="https://en.wikipedia.org/wiki/Thundering_herd_problem">thundering herd problems</a>, it can be useful to add randomness to delays. To do so, use <code>jitter = true</code>.</p>
<pre><code class="language-toml">[profile.default]
retries = { backoff = "exponential", count = 3, delay = "1s", jitter = true }
</code></pre>
<p><code>jitter = true</code> also works for fixed backoff.</p>
<p>The current jitter algorithm picks a value in between <code>0.5 * delay</code> and <code>delay</code> uniformly at random. This is not part of the stable interface and is subject to change.</p>
<h2 id="per-test-overrides"><a class="header" href="#per-test-overrides">Per-test overrides</a></h2>
<p>Nextest supports <a href="book/per-test-overrides.html">per-test overrides</a> for retries, letting you mark a subset of tests as needing retries. For example, to mark test names containing <code>"test_e2e"</code> as requiring retries:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
filter = 'test(test_e2e)'
retries = 2
</code></pre>
<p>Per-test overrides support the full set of delay and backoff options as well. For example:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
filter = 'test(test_remote_api)'
retries = { backoff = "exponential", count = 2, delay = "5s", jitter = true }
</code></pre>
<blockquote>
<p><strong>Note:</strong> The <code>--retries</code> command-line option and the <code>NEXTEST_RETRIES</code> environment variable both disable overrides.</p>
</blockquote>
<h2 id="junit-support"><a class="header" href="#junit-support">JUnit support</a></h2>
<p>Flaky test detection is integrated with nextest's JUnit support. For more information, see <a href="book/junit.html">JUnit support</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="slow-tests-and-timeouts"><a class="header" href="#slow-tests-and-timeouts">Slow tests and timeouts</a></h1>
<p>Slow tests can bottleneck your test run. Nextest identifies tests that take more than a certain amount of time, and optionally lets you terminate tests that take too long to run.</p>
<h2 id="slow-tests"><a class="header" href="#slow-tests">Slow tests</a></h2>
<p>For tests that take more than a certain amount of time (by default 60 seconds), nextest prints out a <strong>SLOW</strong> status. For example, in the output below, <code>test_slow_timeout</code> takes 90 seconds to execute and is marked as a slow test.</p>
<hr />
<pre><font color="#4E9A06"><b>    Starting</b></font> <b>6</b> tests across <b>8</b> binaries (<b>19</b> skipped)
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_success</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_success_should_panic</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>nextest-tests::other</b></font> <font color="#3465A4"><b>other_test_success</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>       nextest-tests</b></font> <font color="#06989A">tests::</font><font color="#3465A4"><b>unit_test_success</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   1.501s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_slow_timeout_2</b></font>
<font color="#C4A000"><b>        SLOW</b></font> [&gt; 60.000s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_slow_timeout</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [  90.001s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_slow_timeout</b></font>
------------
<font color="#4E9A06"><b>     Summary</b></font> [  90.002s] <b>6</b> tests run: <b>6</b> <font color="#4E9A06"><b>passed</b></font> (<b>1</b> <font color="#C4A000"><b>slow</b></font>), <b>19</b> <font color="#C4A000"><b>skipped</b></font>
</pre>
<hr />
<h2 id="configuring-timeouts"><a class="header" href="#configuring-timeouts">Configuring timeouts</a></h2>
<p>To customize how long it takes before a test is marked slow, you can use the <code>slow-timeout</code> <a href="book/configuration.html">configuration parameter</a>. For example, to set a timeout of 2 minutes before a test is marked slow, add this to <code>.config/nextest.toml</code>:</p>
<pre><code class="language-toml">[profile.default]
slow-timeout = "2m"
</code></pre>
<p>Nextest uses the <code>humantime</code> parser: see <a href="https://docs.rs/humantime/latest/humantime/fn.parse_duration.html">its documentation</a> for the full supported syntax.</p>
<h2 id="terminating-tests-after-a-timeout"><a class="header" href="#terminating-tests-after-a-timeout">Terminating tests after a timeout</a></h2>
<p>Nextest lets you optionally specify a number of <code>slow-timeout</code> periods after which a test is terminated. For example, to configure a slow timeout of 30 seconds and for tests to be terminated after 120 seconds (4 periods of 30 seconds), add this to <code>.config/nextest.toml</code>:</p>
<pre><code class="language-toml">[profile.default]
slow-timeout = { period = "30s", terminate-after = 4 }
</code></pre>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>The run below is configured with:</p>
<pre><code class="language-toml">slow-timeout = { period = "1s", terminate-after = 2 }
</code></pre>
<hr />
<pre><font color="#4E9A06"><b>    Starting</b></font> <b>5</b> tests across <b>8</b> binaries (<b>20</b> skipped)
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_success</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_success_should_panic</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>nextest-tests::other</b></font> <font color="#3465A4"><b>other_test_success</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.001s] <font color="#75507B"><b>       nextest-tests</b></font> <font color="#06989A">tests::</font><font color="#3465A4"><b>unit_test_success</b></font>
<font color="#C4A000"><b>        SLOW</b></font> [&gt;  1.000s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_slow_timeout</b></font>
<font color="#C4A000"><b>        SLOW</b></font> [&gt;  2.000s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_slow_timeout</b></font>
<font color="#CC0000"><b>     TIMEOUT</b></font> [   2.001s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_slow_timeout</b></font>

<font color="#CC0000"><b>--- STDOUT:              </b></font><font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_slow_timeout</b></font><font color="#CC0000"><b> ---</b></font>

running 1 test

------------
<font color="#CC0000"><b>     Summary</b></font> [   2.001s] <b>5</b> tests run: <b>4</b> <font color="#4E9A06"><b>passed</b></font>, <b>1</b> <font color="#CC0000"><b>timed out</b></font>, <b>20</b> <font color="#C4A000"><b>skipped</b></font>
</pre>
<hr />
<h3 id="how-nextest-terminates-tests"><a class="header" href="#how-nextest-terminates-tests">How nextest terminates tests</a></h3>
<p>On Unix platforms, nextest creates a <a href="https://en.wikipedia.org/wiki/Process_group">process group</a> for each test. On timing out, nextest attempts a graceful shutdown: it first sends the <a href="https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html">SIGTERM</a> signal to the process group, then waits for a grace period (by default 10 seconds) for the test to shut down. If the test doesn't shut itself down within that time, nextest sends SIGKILL (<code>kill -9</code>) to the process group to terminate it immediately.</p>
<p>To customize the grace period, use the <code>slow-timeout.grace-period</code> configuration setting. For example, with the <code>ci</code> profile, to terminate tests after 5 minutes with a grace period of 30 seconds:</p>
<pre><code class="language-toml">[profile.ci]
slow-timeout = { period = "60s", terminate-after = 5, grace-period = "30s" }
</code></pre>
<p>To send SIGKILL to a process immediately, without a grace period, set <code>slow-timeout.grace-period</code> to zero:</p>
<pre><code class="language-toml">[profile.ci]
slow-timeout = { period = "60s", terminate-after = 5, grace-period = "0s" }
</code></pre>
<blockquote>
<p><strong>Note:</strong> Starting nextest 0.9.61, the <code>slow-timeout.grace-period</code> setting is also applied to terminations due to Ctrl-C or other signals. With older versions, nextest always waits 10 seconds before sending SIGKILL.</p>
</blockquote>
<p>On other platforms including Windows, nextest terminates the test immediately in a manner akin to SIGKILL. (On Windows, nextest uses <a href="https://docs.microsoft.com/en-us/windows/win32/procthread/job-objects">job objects</a> to kill the test process and all its descendants.) The <code>slow-timeout.grace-period</code> configuration setting is ignored.</p>
<h2 id="per-test-overrides-1"><a class="header" href="#per-test-overrides-1">Per-test overrides</a></h2>
<p>Nextest supports <a href="book/per-test-overrides.html">per-test overrides</a> for the <code>slow-timeout</code> and <code>terminate-after</code> settings.</p>
<p>For example, some end-to-end tests might take longer to run and sometimes get stuck. For tests containing the substring <code>test_e2e</code>, to configure a slow timeout of 120 seconds, and to terminate tests after 10 minutes:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
filter = 'test(test_e2e)'
slow-timeout = { period = "120s", terminate-after = 5 }
</code></pre>
<p>See <a href="book/per-test-overrides.html#override-precedence">Override precedence</a> for more about the order in which overrides are evaluated.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="leaky-tests"><a class="header" href="#leaky-tests">Leaky tests</a></h1>
<p>Some tests create subprocesses but may not clean them up properly. Typical scenarios include:</p>
<ul>
<li>A test creates a server process to test against, but does not shut it down at the end of the test.</li>
<li>A test starts a subprocess with the intent to shut it down, but panics, and does not use the <a href="https://doc.rust-lang.org/rust-by-example/scope/raii.html">RAII pattern</a> to clean up subprocesses.
<ul>
<li>Note that <code>std::process::Child</code> <a href="https://doc.rust-lang.org/std/process/struct.Child.html#warning">does <strong>not</strong> kill subprocesses</a> on being dropped. Some alternatives, such as <code>tokio::process::Command</code>, <a href="https://docs.rs/tokio/1/tokio/process/struct.Command.html#method.kill_on_drop">can be configured</a> to do so.</li>
</ul>
</li>
<li>This can happen transitively as well: a test creates a process which creates its own subprocess, and so on.</li>
</ul>
<p>Nextest can detect some, but not all, such situations. If nextest detects a subprocess leak, it marks the corresponding test as <em>leaky</em>.</p>
<h2 id="leaky-tests-nextest-detects"><a class="header" href="#leaky-tests-nextest-detects">Leaky tests nextest detects</a></h2>
<p>Currently, nextest is limited to detecting subprocesses that inherit standard output or standard error from the test. For example, here's a test that nextest will mark as leaky.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
fn test_subprocess_doesnt_exit() {
    let mut cmd = std::process::Command::new("sleep");
    cmd.arg("120");
    cmd.spawn().unwrap();
}
<span class="boring">}</span></code></pre></pre>
<p>For this test, nextest will output something like:</p>
<hr />
<pre><font color="#4E9A06"><b>    Starting</b></font> <b>1</b> tests across <b>8</b> binaries (<b>24</b> skipped)
<font color="#C4A000"><b>        LEAK</b></font> [   0.103s] <font color="#75507B"><b>nextest-tests::basic</b></font> <font color="#3465A4"><b>test_subprocess_doesnt_exit</b></font>
------------
<font color="#4E9A06"><b>     Summary</b></font> [   0.103s] <b>1</b> tests run: <b>1</b> <font color="#4E9A06"><b>passed</b></font> (<b>1</b> <font color="#C4A000"><b>leaky</b></font>), <b>24</b> <font color="#C4A000"><b>skipped</b></font>
</pre>
<hr />
<p>Leaky tests that are otherwise successful are considered to have passed.</p>
<h2 id="leaky-tests-that-nextest-currently-does-not-detect"><a class="header" href="#leaky-tests-that-nextest-currently-does-not-detect">Leaky tests that nextest currently does not detect</a></h2>
<p>Tests which spawn subprocesses that do not inherit either standard output or standard error are not currently detected by nextest. For example, the following test is not currently detected as leaky:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
fn test_subprocess_doesnt_exit_2() {
    let mut cmd = std::process::Command::new("sleep");
    cmd.arg("120")
        .stdout(std::process::Stdio::null())
        .stderr(std::process::Stdio::null());
    cmd.spawn().unwrap();
}
<span class="boring">}</span></code></pre></pre>
<p>Detecting such tests is a <a href="https://github.com/oconnor663/duct.py/blob/master/gotchas.md#killing-grandchild-processes">very difficult problem to solve</a>, particularly on Unix platforms.</p>
<blockquote>
<p><strong>Note:</strong> This section is not part of nextest's <a href="book/stability.html">stability guarantees</a>. In the future, these tests might get marked as leaky by nextest.</p>
</blockquote>
<h2 id="configuring-the-leak-timeout"><a class="header" href="#configuring-the-leak-timeout">Configuring the leak timeout</a></h2>
<p>Nextest waits a specified amount of time (by default 100 milliseconds) after the test exits for standard output and standard error to be closed. In rare cases, you may need to configure the leak timeout.</p>
<p>To do so, use the <code>leak-timeout</code> <a href="book/configuration.html">configuration parameter</a>. For example, to wait up to 500 milliseconds after the test exits, add this to <code>.config/nextest.toml</code>:</p>
<pre><code class="language-toml">[profile.default]
leak-timeout = "500ms"
</code></pre>
<p>Nextest also supports <a href="book/per-test-overrides.html">per-test overrides</a> for the leak timeout.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filter-expressions"><a class="header" href="#filter-expressions">Filter expressions</a></h1>
<p>Nextest supports a domain-specific language (DSL) for filtering tests. The DSL is inspired by, and is similar to, <a href="https://bazel.build/docs/query-how-to">Bazel query</a> and <a href="https://www.mercurial-scm.org/repo/hg/help/revsets">Mercurial revsets</a>.</p>
<h2 id="example-running-all-tests-in-a-crate-and-its-dependencies"><a class="header" href="#example-running-all-tests-in-a-crate-and-its-dependencies">Example: Running all tests in a crate and its dependencies</a></h2>
<p>To run all tests in <code>my-crate</code> and its dependencies, run:</p>
<pre><code>cargo nextest run -E 'deps(my-crate)'
</code></pre>
<p>The argument passed into the <code>-E</code> command-line option is called a <em>filter expression</em>. The rest of this page describes the full syntax for the expression DSL.</p>
<h2 id="the-filter-expression-dsl"><a class="header" href="#the-filter-expression-dsl">The filter expression DSL</a></h2>
<p>A <em>filter expression</em> defines a set of tests. A test will be run if it matches a filter expression.</p>
<p>On the command line, multiple filter expressions can be passed in. A test will be run if it matches any of these expressions. For example, to run tests whose names contain the string <code>my_test</code> as well as all tests in package <code>my-crate</code>, run:</p>
<pre><code>cargo nextest run -E 'test(my_test)' -E 'package(my-crate)'
</code></pre>
<p>This is equivalent to:</p>
<pre><code>cargo nextest run -E 'test(my_test) + package(my-crate)'
</code></pre>
<h3 id="examples-1"><a class="header" href="#examples-1">Examples</a></h3>
<ul>
<li><code>package(serde) and test(deserialize)</code>: every test containing the string <code>deserialize</code> in the package <code>serde</code></li>
<li><code>deps(nextest*)</code>: all tests in packages whose names start with <code>nextest</code>, and all of their (possibly transitive) dependencies</li>
<li><code>not (test(/parse[0-9]*/) | test(run))</code>: every test name not matching the regex <code>parse[0-9]*</code> or the substring <code>run</code></li>
</ul>
<blockquote>
<p><strong>Note:</strong> If you pass in both a filter expression and a standard, substring-based filter, tests
must match <strong>both</strong> filter expressions and substring-based filters.</p>
<p>For example, the command:</p>
<pre><code>cargo nextest run -E 'package(foo)' -- test_bar test_baz
</code></pre>
<p>will run all tests that are both in package <code>foo</code> and match <code>test_bar</code> or <code>test_baz</code>.</p>
</blockquote>
<h2 id="dsl-reference"><a class="header" href="#dsl-reference">DSL reference</a></h2>
<p>This section contains the full set of operators supported by the DSL.</p>
<h3 id="basic-predicates"><a class="header" href="#basic-predicates">Basic predicates</a></h3>
<ul>
<li><code>all()</code>: include all tests.</li>
<li><code>test(name-matcher)</code>: include all tests matching <code>name-matcher</code>.</li>
<li><code>package(name-matcher)</code>: include all tests in packages (crates) matching <code>name-matcher</code>.</li>
<li><code>deps(name-matcher)</code>: include all tests in crates matching <code>name-matcher</code>, and all of their (possibly transitive) dependencies.</li>
<li><code>rdeps(name-matcher)</code>: include all tests in crates matching <code>name-matcher</code>, and all the crates that (possibly transitively) depend on <code>name-matcher</code>.</li>
<li><code>kind(name-matcher)</code>: include all tests in binary kinds matching <code>name-matcher</code>. Binary kinds include:
<ul>
<li><code>lib</code> for unit tests, typically in the <code>src/</code> directory</li>
<li><code>test</code> for integration tests, typically in the <code>tests/</code> directory</li>
<li><code>bench</code> for benchmark tests</li>
<li><code>bin</code> for tests within <code>[[bin]]</code> targets</li>
<li><code>proc-macro</code> for tests in the <code>src/</code> directory of a procedural macro</li>
</ul>
</li>
<li><code>binary(name-matcher)</code>: include all tests in binary names matching <code>name-matcher</code>.
<ul>
<li>For tests of kind <code>lib</code> and <code>proc-macro</code>, the binary name is the same as the name of the crate.</li>
<li>Otherwise, it's the name of the integration test, benchmark, or binary target.</li>
</ul>
</li>
<li><code>binary_id(name-matcher)</code>: include all tests in <a href="book/running.html#binary-ids">binary IDs</a> matching <code>name-matcher</code>.</li>
<li><code>platform(host)</code> or <code>platform(target)</code>: include all tests that are <a href="book/running.html#filtering-by-build-platform">built for the host or target platform</a>, respectively.</li>
<li><code>none()</code>: include no tests.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> If a filter expression always excludes a particular binary, it will not be run, even to
get the list of tests within it. This means that a command like:</p>
<pre><code>cargo nextest list -E 'platform(host)'
</code></pre>
<p>will not execute any test binaries built for the target platform. This is generally what you want,
but if you would like to list tests anyway, include a <code>test()</code> predicate. For example, to
list test binaries for the target platform (using, for example, a <a href="book/target-runners.html">target
runner</a>), but skip running them:</p>
<pre><code>cargo nextest list -E 'platform(host) + not test(/.*/)' --verbose
</code></pre>
</blockquote>
<h3 id="name-matchers"><a class="header" href="#name-matchers">Name matchers</a></h3>
<ul>
<li><code>=string</code>: <em>equality matcher</em>—match a package or test name that's equal to <code>string</code>.</li>
<li><code>~string</code>: <em>contains matcher</em>—match a package or test name containing <code>string</code>.</li>
<li><code>/regex/</code>: <em>regex matcher</em>—match a package or test name if any part of it matches the regular expression <code>regex</code>. To match the entire string against a regular expression, use <code>/^regex$/</code>. The implementation uses the <a href="https://github.com/rust-lang/regex">regex</a> crate.</li>
<li><code>#glob</code>: <em>glob matcher</em>—match a package or test name if the full name matches the glob expression <code>glob</code>. The implementation uses the <a href="https://docs.rs/globset">globset crate</a>.</li>
<li><code>string</code>: Default matching strategy.
<ul>
<li>For <code>test()</code> predicates, this is the <em>contains matcher</em>, equivalent to <code>~string</code>.</li>
<li>For package-related predicates (<code>package()</code>, <code>deps()</code>, and <code>rdeps()</code>), this is the <em>glob matcher</em>, equivalent to <code>#string</code>.</li>
<li>For binary-related predicates (<code>binary()</code> and <code>binary_id()</code>), this is also the <em>glob matcher</em>.</li>
<li>For <code>kind()</code> and <code>platform()</code>, this is the <em>equality matcher</em>, equivalent to <code>=string</code>.</li>
</ul>
</li>
</ul>
<p>If you're constructing an expression string programmatically, <strong>always use a prefix</strong> to avoid ambiguity.</p>
<h4 id="escape-sequences"><a class="header" href="#escape-sequences">Escape sequences</a></h4>
<p>The <em>equality</em>, <em>contains</em>, and <em>glob</em> matchers can contain escape sequences, preceded by a
backslash (<code>\</code>).</p>
<ul>
<li><code>\n</code>: line feed</li>
<li><code>\r</code>: carriage return</li>
<li><code>\t</code>: tab</li>
<li><code>\\</code>: backslash</li>
<li><code>\/</code>: forward slash</li>
<li><code>\)</code>: closing parenthesis</li>
<li><code>\,</code>: comma</li>
<li><code>\u{7FFF}</code>: 24-bit Unicode character code (up to 6 hex digits)</li>
</ul>
<p>For the <em>glob matcher</em>, to match against a literal glob metacharacter such as <code>*</code> or <code>?</code>, enclose it in square brackets: <code>[*]</code> or <code>[?]</code>.</p>
<p>All other escape sequences are invalid.</p>
<p>The <em>regular expression</em> matcher supports the same escape sequences that <a href="https://docs.rs/regex/latest/regex/#escape-sequences">the regex crate does</a>. This includes character classes like <code>\d</code>. Additionally, <code>\/</code> is interpreted as an escaped <code>/</code>.</p>
<h3 id="operators"><a class="header" href="#operators">Operators</a></h3>
<ul>
<li><code>set_1 &amp; set_2</code>, <code>set_1 and set_2</code>: the intersection of <code>set_1</code> and <code>set_2</code></li>
<li><code>set_1 | set_2</code>, <code>set_1 + set_2</code>, <code>set_1 or set_2</code>: the union of <code>set_1</code> or <code>set_2</code></li>
<li><code>not set</code>, <code>!set</code>: include everything not included in <code>set</code></li>
<li><code>set_1 - set_2</code>: equivalent to <code>set_1 and not set_2</code></li>
<li><code>(set)</code>: include everything in <code>set</code></li>
</ul>
<h4 id="operator-precedence"><a class="header" href="#operator-precedence">Operator precedence</a></h4>
<p>In order from highest to lowest, or in other words from tightest to loosest binding:</p>
<ol>
<li><code>()</code></li>
<li><code>not</code>, <code>!</code></li>
<li><code>and</code>, <code>&amp;</code>, <code>-</code></li>
<li><code>or</code>, <code>|</code>, <code>+</code></li>
</ol>
<p>Within a precedence group, operators bind from left to right.</p>
<h5 id="examples-2"><a class="header" href="#examples-2">Examples</a></h5>
<ul>
<li><code>test(a) &amp; test(b) | test(c)</code> is equivalent to <code>(test(a) &amp; test(b)) | test(c)</code>.</li>
<li><code>test(a) | test(b) &amp; test(c)</code> is equivalent to <code>test(a) | (test(b) &amp; test(c))</code>.</li>
<li><code>test(a) &amp; test(b) - test(c)</code> is equivalent to <code>(test(a) &amp; test(b)) - test(c)</code>.</li>
<li><code>not test(a) | test(b)</code> is equivalent to <code>(not test(a)) | test(b)</code>.</li>
</ul>
<h2 id="more-information-about-filter-expressions"><a class="header" href="#more-information-about-filter-expressions">More information about filter expressions</a></h2>
<p>This section covers additional information that is of interest to nextest's developers and curious readers.</p>
<details>
<summary>Click to expand</summary>
<h3 id="motivation"><a class="header" href="#motivation">Motivation</a></h3>
<p>Developer tools often work with some notion of sets, and many of them have grown some kind of domain-specific query language to be able to efficiently specify those sets.</p>
<p>The biggest advantage of a query language is <em>orthogonality</em>: rather than every command having to grow a number of options such as <code>--include</code> and <code>--exclude</code>, developers can learn the query language once and use it everywhere.</p>
<h3 id="design-decisions"><a class="header" href="#design-decisions">Design decisions</a></h3>
<p>Nextest's filter expressions are meant to be specified at the command line as well as in configuration. This led to the following design decisions:</p>
<ul>
<li><strong>No quotes:</strong> Filter expressions do not have embedded quotes. This lets users use either single (<code>''</code>) or double quotes (<code>""</code>) to specify filter expressions, without having to worry about escaping them.</li>
<li><strong>Minimize nesting of parens:</strong> If an expression language uses parentheses or other brackets heavily (e.g. Rust's <a href="https://doc.rust-lang.org/reference/conditional-compilation.html"><code>cfg()</code> expressions</a>), getting them wrong can be annoying when trying to write an expression. Text editors typically highlight matching and missing parens, but there's so such immediate feedback on the command line.</li>
<li><strong>Infix operators:</strong> Nextest's filter expressions use infix operators, which are more natural to read and write for most people. (As an alternative, Rust's <a href="https://doc.rust-lang.org/reference/conditional-compilation.html"><code>cfg()</code> expressions</a> use the prefix operators <code>all()</code> and <code>any()</code>).</li>
<li><strong>Operator aliases:</strong> Operators are supported as both words (<code>and</code>, <code>or</code>, <code>not</code>) and symbols (<code>&amp;</code>, <code>|</code>, <code>+</code>, <code>-</code>, <code>!</code>), letting users write expressions in the style most natural to them. Filter expressions are a small language, so there's no need to be particularly opinionated.</li>
</ul>
</details>
<div style="break-before: page; page-break-before: always;"></div><h1 id="archiving-and-reusing-builds"><a class="header" href="#archiving-and-reusing-builds">Archiving and reusing builds</a></h1>
<p>In some cases, it can be useful to separate out building tests from running them. Nextest supports archiving builds on one machine, and then extracting the archive to run tests on another machine.</p>
<h2 id="terms"><a class="header" href="#terms">Terms</a></h2>
<ul>
<li><strong>Build machine:</strong> The computer that builds tests.</li>
<li><strong>Target machine:</strong> The computer that runs tests.</li>
</ul>
<h2 id="use-cases"><a class="header" href="#use-cases">Use cases</a></h2>
<ul>
<li><strong>Cross-compilation.</strong> The build machine has a different architecture, or runs a different operating system, from the target machine.</li>
<li><strong>Test partitioning.</strong> Build once on the build machine, then <a href="book/partitioning.html">partition test execution</a> across multiple target machines.</li>
<li><strong>Saving execution time on more valuable machines.</strong> For example, build tests on a regular machine, then run them on a machine with a GPU attached to it.</li>
</ul>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li><strong>The project source must be checked out to the same revision on the target machine.</strong> This might be needed for test fixtures and other assets, and nextest sets the right working directory relative to the workspace root when executing tests.</li>
<li><strong>It is your responsibility to transfer over the archive.</strong> Use the examples below as a template.</li>
<li><strong>Nextest must be installed on the target machine.</strong> For best results, use the same version of nextest on both machines.</li>
</ul>
<h3 id="non-requirements"><a class="header" href="#non-requirements">Non-requirements</a></h3>
<ul>
<li><strong>Cargo does not need to be installed on the target machine.</strong> If <code>cargo</code> is unavailable, replace <code>cargo nextest</code> with <code>cargo-nextest nextest</code> in the following examples.</li>
</ul>
<h2 id="creating-archives"><a class="header" href="#creating-archives">Creating archives</a></h2>
<p><code>cargo nextest archive --archive-file &lt;name-of-archive.tar.zst&gt;</code> creates an archive with the following contents:</p>
<ul>
<li>
<p>Cargo-related metadata, at the location <code>target/nextest/cargo-metadata.json</code>.</p>
</li>
<li>
<p>Metadata about test binaries, at the location <code>target/nextest/binaries-metadata.json</code>.</p>
</li>
<li>
<p>All test binaries</p>
</li>
<li>
<p>Other relevant files:</p>
<ul>
<li>
<p>Dynamic libraries that test binaries might link to</p>
</li>
<li>
<p>Non-test binaries used by integration tests</p>
</li>
<li>
<p>Starting nextest 0.9.66, build script output directories for workspace packages that have associated test binaries</p>
<blockquote>
<p><strong>NOTE:</strong> Currently, <code>OUT_DIR</code>s are only archived one level deep to avoid bloating archives too much. In the future, we may add configuration to archive more or less of the output directory. If you have a use case that would benefit from this, please <a href="https://github.com/nextest-rs/nextest/issues/new">file an issue</a>.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>Note that archives do not include the source code for your project.</strong> It is your responsibility to ensure that the source code for your workspace is transferred over to the target machine and has the same contents.</p>
<p>Currently, the only format supported is a Zstandard-compressed tarball (<code>.tar.zst</code>).</p>
<h2 id="running-tests-from-archives"><a class="header" href="#running-tests-from-archives">Running tests from archives</a></h2>
<p><code>cargo nextest list</code> and <code>run</code> support a new <code>--archive-file</code> option. This option accepts archives created by <code>cargo nextest archive</code> as above.</p>
<p>By default, archives are extracted to a temporary directory, and nextest remaps paths to use the new
target directory. To specify the directory archives should be extracted to, use the <code>--extract-to</code>
option.</p>
<h3 id="specifying-a-new-location-for-the-source-code"><a class="header" href="#specifying-a-new-location-for-the-source-code">Specifying a new location for the source code</a></h3>
<p>By default, nextest expects the workspace's source code to be in the same location on both the build and target machines. To specify a new location for the workspace, use the <code>--workspace-remap &lt;path-to-workspace-root&gt;</code> option with the <code>list</code> or <code>run</code> commands.</p>
<h2 id="example-simple-buildrun-split"><a class="header" href="#example-simple-buildrun-split">Example: Simple build/run split</a></h2>
<ol>
<li>
<p>Build and archive tests:</p>
<p>Here you should specify all the options you would normally use to build your tests.</p>
<pre><code class="language-shell">cargo nextest archive --workspace --all-features --archive-file my-archive.tar.zst
</code></pre>
</li>
<li>
<p>Run the tests:</p>
<p>Archive keeps the options used to build the tests, so you <strong>should not</strong> specify them again.</p>
<pre><code class="language-shell">cargo nextest run --archive-file my-archive.tar.zst
</code></pre>
</li>
</ol>
<h2 id="example-use-in-github-actions"><a class="header" href="#example-use-in-github-actions">Example: Use in GitHub Actions</a></h2>
<p>See <a href="https://github.com/nextest-rs/reuse-build-partition-example/blob/main/.github/workflows/ci.yml">this working example</a> for how to reuse builds and <a href="book/partitioning.html">partition test runs</a> on GitHub Actions.</p>
<h2 id="example-cross-compilation"><a class="header" href="#example-cross-compilation">Example: Cross-compilation</a></h2>
<p>While cross-compiling code, some tests may need to be run on the host platform. (See the note about <a href="book/running.html#filtering-by-build-platform">Filtering by build platform</a> for more.)</p>
<h3 id="on-the-build-machine"><a class="header" href="#on-the-build-machine">On the build machine</a></h3>
<ol>
<li>
<p>Build and run host-only tests:</p>
<pre><code class="language-shell">cargo nextest run --target &lt;TARGET&gt; -E 'platform(host)'
</code></pre>
</li>
<li>
<p>Archive tests:</p>
<pre><code class="language-shell">cargo nextest archive --target &lt;TARGET&gt; --archive-file my-archive.tar.zst
</code></pre>
</li>
<li>
<p>Copy <code>my-archive.tar.zst</code> to the target machine.</p>
</li>
</ol>
<h3 id="on-the-target-machine"><a class="header" href="#on-the-target-machine">On the target machine</a></h3>
<ol>
<li>
<p>Check out the project repository to a path <code>&lt;REPO-PATH&gt;</code>, to the same revision as the build machine.</p>
</li>
<li>
<p>List target-only tests:</p>
<pre><code class="language-shell">cargo nextest list -E 'platform(target)' \
    --archive-file my-archive.tar.zst \
    --workspace-remap &lt;REPO-PATH&gt;
</code></pre>
</li>
<li>
<p>Run target-only tests:</p>
<pre><code class="language-shell">cargo nextest run -E 'platform(target)' \
    --archive-file my-archive.tar.zst \
    --workspace-remap &lt;REPO-PATH&gt;
</code></pre>
</li>
</ol>
<h2 id="manually-creating-your-own-archives"><a class="header" href="#manually-creating-your-own-archives">Manually creating your own archives</a></h2>
<p>You can also create and manage your own archives, with the following options to <code>cargo nextest list</code> and <code>run</code>:</p>
<ul>
<li><code>--binaries-metadata</code>: The path to JSON metadata generated by <code>cargo nextest list --list-type binaries-only --message-format json</code>.</li>
<li><code>--target-dir-remap</code>: A possible new location for the target directory. Requires <code>--binaries-metadata</code>.</li>
<li><code>--cargo-metadata</code>: The path to JSON metadata generated by <code>cargo metadata --format-version 1</code>.</li>
</ul>
<h2 id="making-tests-relocatable"><a class="header" href="#making-tests-relocatable">Making tests relocatable</a></h2>
<p>Some tests may need to be modified to handle changes in the workspace and target directories. Some common situations:</p>
<ul>
<li>
<p>To obtain the path to the source directory, Cargo provides the <code>CARGO_MANIFEST_DIR</code> option at both build time and runtime. For relocatable tests, use the value of <code>CARGO_MANIFEST_DIR</code> at runtime. This means <code>std::env::var("CARGO_MANIFEST_DIR")</code>, not <code>env!("CARGO_MANIFEST_DIR")</code>.</p>
<p>If the workspace is remapped, nextest automatically sets <code>CARGO_MANIFEST_DIR</code> to the new location.</p>
</li>
<li>
<p>To obtain the path to a crate's executables, Cargo provides the <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates"><code>CARGO_BIN_EXE_&lt;name&gt;</code></a> option to integration tests at build time. To handle target directory remapping, use the value of <code>NEXTEST_BIN_EXE_&lt;name&gt;</code> at runtime.</p>
<p>To retain compatibility with <code>cargo test</code>, you can fall back to the value of <code>CARGO_BIN_EXE_&lt;name&gt;</code> at build time.</p>
</li>
</ul>
<h2 id="options-and-arguments-for-cargo-nextest-archive"><a class="header" href="#options-and-arguments-for-cargo-nextest-archive">Options and arguments for <code>cargo nextest archive</code></a></h2>
<pre><code>Build and archive tests

Usage: cargo nextest archive [OPTIONS] --archive-file &lt;PATH&gt;

Options:
  -v, --verbose       Verbose output [env: NEXTEST_VERBOSE=]
      --color &lt;WHEN&gt;  Produce color output: auto, always, never [env: CARGO_TERM_COLOR=] [default: auto]
  -h, --help          Print help (see more with '--help')

Package selection:
  -p, --package &lt;PACKAGES&gt;  Package to test
      --workspace           Test all packages in the workspace
      --exclude &lt;EXCLUDE&gt;   Exclude packages from the test
      --all                 Alias for --workspace (deprecated)

Target selection:
      --lib                Test only this package's library unit tests
      --bin &lt;BIN&gt;          Test only the specified binary
      --bins               Test all binaries
      --example &lt;EXAMPLE&gt;  Test only the specified example
      --examples           Test all examples
      --test &lt;TEST&gt;        Test only the specified test target
      --tests              Test all targets
      --bench &lt;BENCH&gt;      Test only the specified bench target
      --benches            Test all benches
      --all-targets        Test all targets

Feature selection:
  -F, --features &lt;FEATURES&gt;  Space or comma separated list of features to activate
      --all-features         Activate all available features
      --no-default-features  Do not activate the `default` feature

Compilation options:
      --build-jobs &lt;N&gt;        Number of build jobs to run
  -r, --release               Build artifacts in release mode, with optimizations
      --cargo-profile &lt;NAME&gt;  Build artifacts with the specified Cargo profile
      --target &lt;TRIPLE&gt;       Build for the target triple
      --target-dir &lt;DIR&gt;      Directory for all generated artifacts
      --unit-graph            Output build graph in JSON (unstable)
      --timings[=&lt;FMTS&gt;]      Timing output formats (unstable) (comma separated): html, json

Manifest options:
      --manifest-path &lt;PATH&gt;  Path to Cargo.toml
      --frozen                Require Cargo.lock and cache are up to date
      --locked                Require Cargo.lock is up to date
      --offline               Run without accessing the network

Other Cargo options:
      --cargo-quiet             Do not print cargo log messages
      --cargo-verbose...        Use cargo verbose output (specify twice for very verbose/build.rs output)
      --ignore-rust-version     Ignore `rust-version` specification in packages
      --future-incompat-report  Outputs a future incompatibility report at the end of the build
      --config &lt;KEY=VALUE&gt;      Override a configuration value
  -Z &lt;FLAG&gt;                     Unstable (nightly-only) flags to Cargo, see 'cargo -Z help' for details

Archive options:
      --archive-file &lt;PATH&gt;      File to write archive to
      --archive-format &lt;FORMAT&gt;  Archive format [default: auto] [possible values: auto, tar-zst]
      --zstd-level &lt;LEVEL&gt;       Zstandard compression level (-7 to 22, higher is more compressed + slower) [default: 0]

Config options:
      --config-file &lt;PATH&gt;
          Config file [default: workspace-root/.config/nextest.toml]
      --tool-config-file &lt;TOOL:ABS_PATH&gt;
          Tool-specific config files
      --override-version-check
          Override checks for the minimum version defined in nextest's config
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partitioning-test-runs-in-ci"><a class="header" href="#partitioning-test-runs-in-ci">Partitioning test runs in CI</a></h1>
<p>For CI scenarios where test runs take too long on a single machine, nextest supports automatically <em>partitioning</em> or <em>sharding</em> tests into buckets, using the <code>--partition</code> option.</p>
<p>cargo-nextest supports two kinds of partitioning: <em>counted</em> and <em>hashed</em>.</p>
<h2 id="counted-partitioning"><a class="header" href="#counted-partitioning">Counted partitioning</a></h2>
<p>Counted partitioning is specified with <code>--partition count:m/n</code>, where m and n are both integers, and 1 ≤ m ≤ n. Specifying this operator means "run tests in count-based bucket m of n".</p>
<p>Here's an example of running tests in bucket 1 of 2:</p>
<p><img src="book/../static/nextest-partition.png" alt="Output of cargo nextest run --partition count:1/2" /></p>
<p>Tests not in the current bucket are marked skipped.</p>
<p>Counted partitioning is done <em>per test binary</em>. This means that the tests in one binary <em>do not</em> influence counting for other binaries.</p>
<p>Counted partitioning also applies after all other test filters. For example, if you specify <code>cargo nextest run --partition count:1/3 test_parsing</code>, nextest first selects tests that match the substring <code>test_parsing</code>, then buckets this subset of tests into 3 partitions and runs the tests in partition 1.</p>
<h2 id="hashed-sharding"><a class="header" href="#hashed-sharding">Hashed sharding</a></h2>
<p>Hashed sharding is specified with <code>--partition hash:m/n</code>, where m and n are both integers, and 1 ≤ m ≤ n. Specifying this operator means "run tests in hashed bucket m of n".</p>
<p>The main benefit of hashed sharding is that it is completely deterministic (the hash is based on a combination of the binary and test names). Unlike with counted partitioning, adding or removing tests, or changing test filters, will never cause a test to fall into a different bucket. The hash algorithm is guaranteed never to change within a nextest version series.</p>
<p>For sufficiently large numbers of tests, hashed sharding produces roughly the same number of tests per bucket. However, smaller test runs may result in an uneven distribution.</p>
<h2 id="reusing-builds"><a class="header" href="#reusing-builds">Reusing builds</a></h2>
<p>By default, each job has to do its own build before starting a test run. To save on the extra work, nextest supports <a href="book/reusing-builds.html">archiving builds</a> in one job for later reuse in other jobs. See the example below for how to do this.</p>
<h2 id="example-use-in-github-actions-1"><a class="header" href="#example-use-in-github-actions-1">Example: Use in GitHub Actions</a></h2>
<p>See <a href="https://github.com/nextest-rs/reuse-build-partition-example/blob/main/.github/workflows/ci.yml">this working example</a> for how to <a href="book/reusing-builds.html">reuse builds</a> and partition test runs on GitHub Actions.</p>
<h2 id="example-use-in-gitlab-ci"><a class="header" href="#example-use-in-gitlab-ci">Example: Use in GitLab CI</a></h2>
<p>GitLab can <a href="https://docs.gitlab.com/ee/ci/yaml/#parallel">parallelize jobs</a> across runners. This works neatly with <code>--partition</code>. For example:</p>
<pre><code class="language-yaml">test:
  stage: test
  parallel: 3
  script:
    - echo "Node index - ${CI_NODE_INDEX}. Total amount - ${CI_NODE_TOTAL}"
    - time cargo nextest run --workspace --partition count:${CI_NODE_INDEX}/${CI_NODE_TOTAL}
</code></pre>
<p>This creates three jobs that run in parallel: <code>test 1/3</code>, <code>test 2/3</code> and <code>test 3/3</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="target-runners"><a class="header" href="#target-runners">Target runners</a></h1>
<p>If you're cross-compiling Rust code, you may wish to run tests through a wrapper executable or script. For this purpose, nextest supports <em>target runners</em>, using the same configuration options used by Cargo:</p>
<ul>
<li>The environment variable <code>CARGO_TARGET_&lt;triple&gt;_RUNNER</code>, if it matches the target platform, takes highest precedence.</li>
<li>Otherwise, nextest reads <a href="https://doc.rust-lang.org/cargo/reference/config.html#targettriplerunner">the <code>target.&lt;triple&gt;.runner</code> and <code>target.&lt;cfg&gt;.runner</code> settings</a> from <code>.cargo/config.toml</code>.</li>
</ul>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<p>If you're on Linux cross-compiling to Windows, you can choose to run tests through <a href="https://www.winehq.org/">Wine</a>.</p>
<p>If you add the following to <code>.cargo/config.toml:</code></p>
<pre><code class="language-toml">[target.x86_64-pc-windows-msvc]
runner = "wine"
</code></pre>
<p>Or, in your shell:</p>
<pre><code>export CARGO_TARGET_X86_64_PC_WINDOWS_MSVC_RUNNER=wine
</code></pre>
<p>Then, running this command will cause your tests to be run as <code>wine &lt;test-binary&gt;</code>:</p>
<pre><code>cargo nextest run --target x86_64-pc-windows-msvc
</code></pre>
<blockquote>
<p><strong>Note:</strong> If your target runner is a shell script, it might malfunction on macOS due to System Integrity Protection's environment sanitization. Nextest provides the <code>NEXTEST_LD_*</code> and <code>NEXTEST_DYLD_*</code> environment variables as workarounds: see <a href="book/env-vars.html#environment-variables-nextest-sets">Environment variables nextest sets</a> for more.</p>
</blockquote>
<h2 id="cross-compiling"><a class="header" href="#cross-compiling">Cross-compiling</a></h2>
<p>While cross-compiling code, some tests may need to be run on the host platform. (See the note about <a href="book/running.html#filtering-by-build-platform">Filtering by build platform</a> for more.)</p>
<p>For tests that run on the host platform, nextest uses the target runner defined for the host. For example, if cross-compiling from <code>x86_64-unknown-linux-gnu</code> to <code>x86_64-pc-windows-msvc</code>, nextest will use the <code>CARGO_TARGET_X86_64_UNKNOWN_LINUX_GNU_RUNNER</code> for proc-macro and other host-only tests, and <code>CARGO_TARGET_X86_64_PC_WINDOWS_MSVC_RUNNER</code> for other tests.</p>
<p>This behavior is similar to that of <a href="book/specifying-platforms.html#host-tests">per-test overrides</a>.</p>
<h2 id="debugging-output"><a class="header" href="#debugging-output">Debugging output</a></h2>
<p>Nextest invokes target runners during both the list and run phases. During the list phase, nextest has <a href="https://nexte.st/book/custom-test-harnesses.html#manually-implementing-a-test-harness">stringent rules</a> for the contents of standard output.</p>
<p>If a target runner produces debugging or any other kind of output, it MUST NOT go to standard output. You can produce output to standard error, to a file on disk, etc.</p>
<p>For example, this target runner will not work:</p>
<pre><code class="language-bash">#!/bin/bash
echo "This is some debugging output"
$@
</code></pre>
<p>Instead, redirect debugging output <a href="https://stackoverflow.com/questions/2990414/echo-that-outputs-to-stderr">to standard error</a>:</p>
<pre><code class="language-bash">#!/bin/bash
echo "This is some debugging output" &gt;&amp;2
$@
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="other-options"><a class="header" href="#other-options">Other options</a></h1>
<p>Some other options accepted by <code>cargo nextest run</code>. Many of these options are also accepted as <a href="book/configuration.html">configuration settings</a> and <a href="book/env-vars.html">environment variables</a>.</p>
<h2 id="runner-options"><a class="header" href="#runner-options">Runner options</a></h2>
<ul>
<li><code>--no-fail-fast</code>: do not exit the test run on the first failure. Most useful for CI scenarios.</li>
<li><code>-j, --test-threads</code>: number of tests to run simultaneously. Note that this is separate from the number of build jobs to run simultaneously, which is specified by <code>--build-jobs</code>.</li>
<li><code>--run-ignored ignored-only</code> runs ignored tests, while <code>--run-ignored all</code> runs both ignored and non-ignored tests.</li>
</ul>
<h2 id="reporter-options"><a class="header" href="#reporter-options">Reporter options</a></h2>
<h3 id="--success-output-and---failure-output"><a class="header" href="#--success-output-and---failure-output"><code>--success-output</code> and <code>--failure-output</code></a></h3>
<p>These options control when standard output and standard error are displayed for failing and passing tests, respectively. The possible values are:</p>
<ul>
<li><code>immediate</code>: display output as soon as the test fails. Default for <code>--failure-output</code>.</li>
<li><code>final</code>: display output at the end of the test run.</li>
<li><code>immediate-final</code>: display output as soon as the test fails, and at the end of the run. This is most useful for CI jobs.</li>
<li><code>never</code>: never display output. Default for <code>--success-output</code>.</li>
</ul>
<p>These options can also be configured via <a href="book/configuration.html">global configuration</a> and <a href="book/per-test-overrides.html">per-test overrides</a>. Specifying these options over the command line will override configuration settings.</p>
<h3 id="--status-level-and---final-status-level"><a class="header" href="#--status-level-and---final-status-level"><code>--status-level</code> and <code>--final-status-level</code></a></h3>
<ul>
<li><code>--status-level</code>: which test statuses (<strong>PASS</strong>, <strong>FAIL</strong> etc) to display. There are 7 status levels: <code>none, fail, retry, slow, pass, skip, all</code>. Each status level causes all earlier status levels to be displayed as well (similar to log levels). (For example, setting <code>status-level</code> to <code>skip</code> will show failing, retried, slow and passing tests along with skipped tests.) The default is <code>pass</code>.</li>
<li><code>--final-status-level</code>: which test statuses to display at the end of a test run. For example, this can be set to <code>fail</code> to print out a list of failing tests at the end of a test run. The default is <code>none</code>.</li>
</ul>
<p>For a full list of options, see <a href="book/running.html#options-and-arguments">Options and arguments</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="machine-readable-output"><a class="header" href="#machine-readable-output">Machine-readable output</a></h1>
<p>cargo-nextest can be configured to produce machine-readable JSON output, readable by other programs. The <a href="https://crates.io/crates/nextest-metadata">nextest-metadata crate</a> provides a Rust interface to deserialize the output to. (The same crate is used by nextest to generate the output.)</p>
<h2 id="listing-tests-1"><a class="header" href="#listing-tests-1">Listing tests</a></h2>
<p>To produce a list of tests using the JSON output, use <code>cargo nextest list --message-format json</code> (or <code>json-pretty</code> for nicely formatted output). Here's some example output for <a href="https://github.com/camino-rs/camino">camino</a>:</p>
<pre><code class="language-json">% cargo nextest list --all-features --lib --message-format json-pretty
{
  "rust-build-meta": {
    "target-directory": "/home/rain/dev/camino/target",
    "base-output-directories": [
      "debug"
    ],
    "non-test-binaries": {},
    "build-script-out-dirs": {
      "camino 1.1.6 (path+file:///home/rain/dev/camino)": "debug/build/camino-02991de38c555ca1/out"
    },
    "linked-paths": [],
    "target-platforms": [
      {
        "triple": "x86_64-unknown-linux-gnu",
        "target-features": [
          "fxsr",
          "sse",
          "sse2"
        ]
      }
    ],
    "target-platform": null
  },
  "test-count": 5,
  "rust-suites": {
    "camino": {
      "package-name": "camino",
      "binary-id": "camino",
      "binary-name": "camino",
      "package-id": "camino 1.1.6 (path+file:///home/rain/dev/camino)",
      "kind": "lib",
      "binary-path": "/home/rain/dev/camino/target/debug/deps/camino-1bdca073ddd4474a",
      "build-platform": "target",
      "cwd": "/home/rain/dev/camino",
      "status": "listed",
      "testcases": {
        "serde_impls::tests::invalid_utf8": {
          "ignored": false,
          "filter-match": {
            "status": "matches"
          }
        },
        "serde_impls::tests::valid_utf8": {
          "ignored": false,
          "filter-match": {
            "status": "matches"
          }
        },
        "tests::test_borrowed_into": {
          "ignored": false,
          "filter-match": {
            "status": "matches"
          }
        },
        "tests::test_deref_mut": {
          "ignored": false,
          "filter-match": {
            "status": "matches"
          }
        },
        "tests::test_owned_into": {
          "ignored": false,
          "filter-match": {
            "status": "matches"
          }
        }
      }
    }
  }
}
</code></pre>
<p>The value of <code>"package-id"</code> can be matched up to the package IDs produced by running <code>cargo metadata</code>.</p>
<h2 id="running-tests-1"><a class="header" href="#running-tests-1">Running tests</a></h2>
<p>This is currently an experimental feature. For more information, see <a href="book/run-machine-readable.html">Machine-readable output for test runs</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>cargo-nextest supports repository-specific configuration at the location <code>.config/nextest.toml</code> from the Cargo workspace root. The location of the configuration file can be overridden with the <code>--config-file</code> option.</p>
<p>The default configuration shipped with cargo-nextest is:</p>
<pre><code class="language-toml"># This is the default config used by nextest. It is embedded in the binary at
# build time. It may be used as a template for .config/nextest.toml.

[store]
# The directory under the workspace root at which nextest-related files are
# written. Profile-specific storage is currently written to dir/&lt;profile-name&gt;.
dir = "target/nextest"

# This section defines the default nextest profile. Custom profiles are layered
# on top of the default profile.
[profile.default]
# "retries" defines the number of times a test should be retried. If set to a
# non-zero value, tests that succeed on a subsequent attempt will be marked as
# flaky. Can be overridden through the `--retries` option.
# Examples
# * retries = 3
# * retries = { backoff = "fixed", count = 2, delay = "1s" }
# * retries = { backoff = "exponential", count = 10, delay = "1s", jitter = true, max-delay = "10s" }
retries = 0

# The number of threads to run tests with. Supported values are either an integer or
# the string "num-cpus". Can be overridden through the `--test-threads` option.
test-threads = "num-cpus"

# The number of threads required for each test. This is generally used in overrides to
# mark certain tests as heavier than others. However, it can also be set as a global parameter.
threads-required = 1

# Show these test statuses in the output.
#
# The possible values this can take are:
# * none: no output
# * fail: show failed (including exec-failed) tests
# * retry: show flaky and retried tests
# * slow: show slow tests
# * pass: show passed tests
# * skip: show skipped tests (most useful for CI)
# * all: all of the above
#
# Each value includes all the values above it; for example, "slow" includes
# failed and retried tests.
#
# Can be overridden through the `--status-level` flag.
status-level = "pass"

# Similar to status-level, show these test statuses at the end of the run.
final-status-level = "flaky"

# "failure-output" defines when standard output and standard error for failing tests are produced.
# Accepted values are
# * "immediate": output failures as soon as they happen
# * "final": output failures at the end of the test run
# * "immediate-final": output failures as soon as they happen and at the end of
#   the test run; combination of "immediate" and "final"
# * "never": don't output failures at all
#
# For large test suites and CI it is generally useful to use "immediate-final".
#
# Can be overridden through the `--failure-output` option.
failure-output = "immediate"

# "success-output" controls production of standard output and standard error on success. This should
# generally be set to "never".
success-output = "never"

# Cancel the test run on the first failure. For CI runs, consider setting this
# to false.
fail-fast = true

# Treat a test that takes longer than the configured 'period' as slow, and print a message.
# See &lt;https://nexte.st/book/slow-tests&gt; for more information.
#
# Optional: specify the parameter 'terminate-after' with a non-zero integer,
# which will cause slow tests to be terminated after the specified number of
# periods have passed.
# Example: slow-timeout = { period = "60s", terminate-after = 2 }
slow-timeout = { period = "60s" }

# Treat a test as leaky if after the process is shut down, standard output and standard error
# aren't closed within this duration.
#
# This usually happens in case of a test that creates a child process and lets it inherit those
# handles, but doesn't clean the child process up (especially when it fails).
#
# See &lt;https://nexte.st/book/leaky-tests&gt; for more information.
leak-timeout = "100ms"

# `nextest archive` automatically includes any build output required by a standard build.
# However sometimes extra non-standard files are required.
# To address this "archive-include" specifies additional paths that will be included in the archive.
archive-include = [
    # Examples:
    #
    # { path = "application-data", relative-to = "target" },
    # { path = "data-from-some-dependency/file.txt", relative-to = "target" },
    #
    # In the above example:
    # * the directory and its contents at "target/application-data" will be included recursively in the archive.
    # * the file "target/data-from-some-dependency/file.txt" will be included in the archive.
]

[profile.default.junit]
# Output a JUnit report into the given file inside 'store.dir/&lt;profile-name&gt;'.
# If unspecified, JUnit is not written out.

# path = "junit.xml"

# The name of the top-level "report" element in JUnit report. If aggregating
# reports across different test runs, it may be useful to provide separate names
# for each report.
report-name = "nextest-run"

# Whether standard output and standard error for passing tests should be stored in the JUnit report.
# Output is stored in the &lt;system-out&gt; and &lt;system-err&gt; elements of the &lt;testcase&gt; element.
store-success-output = false

# Whether standard output and standard error for failing tests should be stored in the JUnit report.
# Output is stored in the &lt;system-out&gt; and &lt;system-err&gt; elements of the &lt;testcase&gt; element.
#
# Note that if a description can be extracted from the output, it is always stored in the
# &lt;description&gt; element.
store-failure-output = true

# This profile is activated if MIRI_SYSROOT is set.
[profile.default-miri]
</code></pre>
<h2 id="profiles"><a class="header" href="#profiles">Profiles</a></h2>
<p>With cargo-nextest, local and CI runs often need to use different settings. For example, CI test runs should not be cancelled as soon as the first test failure is seen.</p>
<p>cargo-nextest supports multiple <em>profiles</em>, where each profile is a set of options for cargo-nextest. Profiles are selected on the command line with the <code>-P</code> or <code>--profile</code> option. Most individual configuration settings can also be overridden at the command line.</p>
<p>Here is a recommended profile for CI runs:</p>
<pre><code class="language-toml">[profile.ci]
# Print out output for failing tests as soon as they fail, and also at the end
# of the run (for easy scrollability).
failure-output = "immediate-final"
# Do not cancel the test run on the first failure.
fail-fast = false
</code></pre>
<p>After checking the profile into <code>.config/nextest.toml</code>, use <code>cargo nextest --profile ci</code> in your CI runs.</p>
<blockquote>
<p><strong>Note:</strong> Nextest's embedded configuration may define new profiles whose names start with <code>default-</code> in the future. To avoid backwards compatibility issues, do not name custom profiles starting with <code>default-</code>.</p>
</blockquote>
<h2 id="tool-specific-configuration"><a class="header" href="#tool-specific-configuration">Tool-specific configuration</a></h2>
<p>Some tools that <a href="book/integrations.html">integrate with nextest</a> may wish to customize nextest's defaults. However, in most cases, command-line arguments and repository-specific configuration should still override those defaults.</p>
<p>To support these tools, nextest supports the <code>--tool-config-file</code> argument. Values to this argument are specified in the form <code>tool:/path/to/config.toml</code>. For example, if your tool <code>my-tool</code> needs to call nextest with customized defaults, it should run:</p>
<pre><code>cargo nextest run --tool-config-file my-tool:/path/to/my/config.toml
</code></pre>
<p>The <code>--tool-config-file</code> argument may be specified multiple times. Config files specified earlier are higher priority than those that come later.</p>
<h2 id="hierarchical-configuration"><a class="header" href="#hierarchical-configuration">Hierarchical configuration</a></h2>
<p>For this example:</p>
<p>Configuration is resolved in the following order:</p>
<ol>
<li>
<p>Command-line arguments. For example, if <code>--retries=3</code> is specified on the command line, failing tests are retried up to 3 times.</p>
</li>
<li>
<p>Environment variables. For example, if <code>NEXTEST_RETRIES=4</code> is specified on the command line, failing tests are retried up to 4 times.</p>
</li>
<li>
<p><a href="book/per-test-overrides.html">Per-test overrides</a>, if they're supported for this configuration variable.</p>
</li>
<li>
<p>If a profile is specified, profile-specific configuration in <code>.config/nextest.toml</code>. For example, if the repository-specific configuration looks like:</p>
<pre><code class="language-toml">[profile.ci]
retries = 2
</code></pre>
<p>then, if <code>--profile ci</code> is selected, failing tests are retried up to 2 times.</p>
</li>
<li>
<p>If a profile is specified, tool-specific configuration for the given profile.</p>
</li>
<li>
<p>Repository-specific configuration for the <code>default</code> profile. For example, if the repository-specific configuration looks like:</p>
<pre><code class="language-toml">[profile.default]
retries = 5
</code></pre>
<p>then failing tests are retried up to 5 times.</p>
</li>
<li>
<p>Tool-specific configuration for the <code>default</code> profile.</p>
</li>
<li>
<p>The default configuration listed above, which is that tests are never retried.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h1>
<p>This section contains information about the environment variables nextest reads and sets.</p>
<h2 id="environment-variables-nextest-reads"><a class="header" href="#environment-variables-nextest-reads">Environment variables nextest reads</a></h2>
<p>Nextest reads some of its command-line options as environment variables. In all cases, passing in a command-line option overrides the respective environment variable.</p>
<ul>
<li><code>NEXTEST_PROFILE</code> — <a href="book/configuration.html#profiles">Nextest profile</a> to use while running tests.</li>
<li><code>NEXTEST_TEST_THREADS</code> — Number of tests to run simultaneously.</li>
<li><code>NEXTEST_RETRIES</code> — Number of times to retry running tests.</li>
<li><code>NEXTEST_HIDE_PROGRESS_BAR</code> — If set to "1", always hide the progress bar.</li>
<li><code>NEXTEST_FAILURE_OUTPUT</code> and <code>NEXTEST_SUCCESS_OUTPUT</code> — When standard output and standard error are displayed for failing and passing tests, respectively. See <a href="book/other-options.html#reporter-options">Reporter options</a> for possible values.</li>
<li><code>NEXTEST_STATUS_LEVEL</code> — Which test statuses (<strong>PASS</strong>, <strong>FAIL</strong> etc) to display. See <a href="book/other-options.html#reporter-options">Reporter options</a> for possible values.</li>
<li><code>NEXTEST_FINAL_STATUS_LEVEL</code> — Which test statuses (<strong>PASS</strong>, <strong>FAIL</strong> etc) to display at the end of a test run. See <a href="book/other-options.html#reporter-options">Reporter options</a> for possible values.</li>
<li><code>NEXTEST_VERBOSE</code> — Verbose output.</li>
</ul>
<p>Nextest also reads the following environment variables to emulate Cargo's behavior.</p>
<ul>
<li><code>CARGO</code> — Path to the <code>cargo</code> binary to use for builds.</li>
<li><code>CARGO_TARGET_DIR</code> — Location of where to place all generated artifacts, relative to the current working directory.</li>
<li><code>CARGO_TARGET_&lt;triple&gt;_RUNNER</code> — Support for <a href="book/target-runners.html">target runners</a>.</li>
<li><code>CARGO_TERM_COLOR</code> — The default color mode: <code>always</code>, <code>auto</code> or <code>never</code>.</li>
</ul>
<h3 id="cargo-related-environment-variables-nextest-reads"><a class="header" href="#cargo-related-environment-variables-nextest-reads">Cargo-related environment variables nextest reads</a></h3>
<p>Nextest delegates to Cargo for the build, which recognizes a number of environment variables. See <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-reads">Environment variables Cargo reads</a> for a full list.</p>
<h2 id="environment-variables-nextest-sets"><a class="header" href="#environment-variables-nextest-sets">Environment variables nextest sets</a></h2>
<p>Nextest exposes these environment variables to your tests <em>at runtime only</em>. They are not set at build time because cargo-nextest may reuse builds done outside of the nextest environment.</p>
<ul>
<li>
<p><code>NEXTEST</code> — always set to <code>"1"</code>.</p>
</li>
<li>
<p><code>NEXTEST_RUN_ID</code> — A UUID corresponding to a particular nextest run. All tests run via a particular invocation of <code>cargo nextest run</code> will have the same UUID.</p>
</li>
<li>
<p><code>NEXTEST_EXECUTION_MODE</code> — currently, always set to <code>process-per-test</code>. More options may be added in the future if nextest gains the ability to run all tests within the same process (<a href="https://github.com/nextest-rs/nextest/issues/27">#27</a>).</p>
</li>
<li>
<p><code>NEXTEST_BIN_EXE_&lt;name&gt;</code> — The absolute path to a binary target's executable. This is only set when running an <a href="https://doc.rust-lang.org/cargo/reference/cargo-targets.html#integration-tests">integration test</a> or benchmark. The <code>&lt;name&gt;</code> is the name of the binary target, exactly as-is. For example, <code>NEXTEST_BIN_EXE_my-program</code> for a binary named <code>my-program</code>.</p>
<ul>
<li>Binaries are automatically built when the test is built, unless the binary has required features that are not enabled.</li>
<li>When <a href="book/reusing-builds.html">reusing builds</a> from an archive, this is set to the remapped path within the target directory.</li>
</ul>
</li>
<li>
<p><code>NEXTEST_LD_*</code> and <code>NEXTEST_DYLD_*</code> — These replicate the values of any environment variables that start with the prefixes <code>LD_</code> or <code>DYLD_</code>, such as <code>LD_PRELOAD</code> or <code>DYLD_FALLBACK_LIBRARY_PATH</code>.</p>
<p>This is a workaround for <a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/System_Integrity_Protection_Guide/RuntimeProtections/RuntimeProtections.html">macOS's System Integrity Protection</a> sanitizing dynamic linker environment variables for processes like the system <code>bash</code>, and is particularly relevant for <a href="book/target-runners.html">target runners</a>. See <a href="https://briandfoy.github.io/macos-s-system-integrity-protection-sanitizes-your-environment/">this blog post</a> for more about how sanitization works.</p>
<blockquote>
<p><strong>Note:</strong> The <code>NEXTEST_LD_*</code> and <code>NEXTEST_DYLD_*</code> variables are set on all platforms, not just macOS.</p>
</blockquote>
</li>
</ul>
<h3 id="cargo-related-environment-variables-nextest-sets"><a class="header" href="#cargo-related-environment-variables-nextest-sets">Cargo-related environment variables nextest sets</a></h3>
<p>Nextest delegates to Cargo for the build, which controls the environment variables that are set. See <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates">Environment variables Cargo sets for crates</a> for a full list.</p>
<p>Nextest also sets these environment variables at runtime, matching the behavior of <code>cargo test</code>:</p>
<ul>
<li><code>CARGO</code> — Path to the <code>cargo</code> binary performing the build.</li>
<li><code>CARGO_MANIFEST_DIR</code> — The directory containing the manifest of your package. If <a href="book/reusing-builds.html#specifying-a-new-location-for-the-workspace"><code>--workspace-remap</code></a> is passed in, this is set to the remapped manifest directory. You can obtain the non-remapped directory using the value of this variable at compile-time, e.g. <code>env!("CARGO_MANIFEST_DIR")</code>.</li>
<li><code>CARGO_PKG_VERSION</code> — The full version of your package.</li>
<li><code>CARGO_PKG_VERSION_MAJOR</code> — The major version of your package.</li>
<li><code>CARGO_PKG_VERSION_MINOR</code> — The minor version of your package.</li>
<li><code>CARGO_PKG_VERSION_PATCH</code> — The patch version of your package.</li>
<li><code>CARGO_PKG_VERSION_PRE</code> — The pre-release version of your package.</li>
<li><code>CARGO_PKG_AUTHORS</code> — Colon separated list of authors from the manifest of your package.</li>
<li><code>CARGO_PKG_NAME</code> — The name of your package.</li>
<li><code>CARGO_PKG_DESCRIPTION</code> — The description from the manifest of your package.</li>
<li><code>CARGO_PKG_HOMEPAGE</code> — The home page from the manifest of your package.</li>
<li><code>CARGO_PKG_REPOSITORY</code> — The repository from the manifest of your package.</li>
<li><code>CARGO_PKG_LICENSE</code> — The license from the manifest of your package.</li>
<li><code>CARGO_PKG_LICENSE_FILE</code> — The license file from the manifest of your package.</li>
<li>Environment variables specified in <a href="https://doc.rust-lang.org/cargo/reference/config.html#env">the <code>[env]</code> section of <code>.cargo/config.toml</code></a>.</li>
<li><code>OUT_DIR</code> — The path to the package's build script output directory. Only set if the crate has a build script.</li>
</ul>
<h3 id="dynamic-library-paths"><a class="header" href="#dynamic-library-paths">Dynamic library paths</a></h3>
<p>Nextest sets the dynamic library path at runtime, similar to <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#dynamic-library-paths">what Cargo does</a>. This helps with locating shared libraries that are part of the build process. The variable name depends on the platform:</p>
<ul>
<li>Windows: <code>PATH</code></li>
<li>macOS: <code>DYLD_FALLBACK_LIBRARY_PATH</code></li>
<li>Unix: <code>LD_LIBRARY_PATH</code></li>
</ul>
<p>Nextest includes the following paths:</p>
<ul>
<li>Search paths included from any build script with the <a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html#rustc-link-search"><code>rustc-link-search</code> instruction</a>. Paths outside of the target directory are removed. It is the responsibility of the user running nextest to properly set the environment if additional libraries on the system are needed in the search path.</li>
<li>The base output directory, such as <code>target/debug</code>, and the "deps" directory. This enables support for <code>dylib</code> dependencies and rustc compiler plugins.</li>
</ul>
<p>Nextest currently relies on being invoked as a Cargo subcommand to set the rustc sysroot library path.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minimum-nextest-versions"><a class="header" href="#minimum-nextest-versions">Minimum nextest versions</a></h1>
<p>Starting version 0.9.55, nextest lets you set minimum <em>required</em> and <em>recommended</em> versions
per-repository. This is similar to the <a href="https://doc.rust-lang.org/cargo/reference/manifest.html#the-rust-version-field"><code>rust-version</code>
field</a> in
<code>Cargo.toml</code>.</p>
<ul>
<li>If the current version of nextest is lower than the required version, nextest will produce an error and exit with code 92 (<a href="https://docs.rs/nextest-metadata/latest/nextest_metadata/enum.NextestExitCode.html#associatedconstant.REQUIRED_VERSION_NOT_MET"><code>REQUIRED_VERSION_NOT_MET</code></a>).</li>
<li>If the current version of nextest is lower than the recommended version, nextest will produce a warning, but will run as normal.</li>
</ul>
<h2 id="setting-minimum-versions"><a class="header" href="#setting-minimum-versions">Setting minimum versions</a></h2>
<p>To set a minimum required version, add to <a href="book/configuration.html"><code>.config/nextest.toml</code></a>, at the top of
the file:</p>
<pre><code class="language-toml">nextest-version = "0.9.55"
# or
nextest-version = { required = "0.9.55" }
</code></pre>
<p>To set a minimum recommended version, add to <code>.config/nextest.toml</code>:</p>
<pre><code class="language-toml">nextest-version = { recommended = "0.9.55" }
</code></pre>
<p>Both required and recommended versions can be set simultaneously:</p>
<pre><code class="language-toml">nextest-version = { required = "0.9.53", recommended = "0.9.55" }
</code></pre>
<blockquote>
<p><strong>Note:</strong> Versions of nextest prior to 0.9.55 do not support the <code>nextest-version</code> configuration. Depending on how old the version is, nextest may print an "unknown configuration" warning or ignore nextest-version entirely.</p>
</blockquote>
<h2 id="bypassing-the-version-check"><a class="header" href="#bypassing-the-version-check">Bypassing the version check</a></h2>
<p>Nextest accepts an <code>--override-version-check</code> CLI option that bypasses the version check. If the override is activated, nextest will print a message informing you of that.</p>
<pre><font color="#D3D7CF">% </font><font color="#4E9A06">cargo</font> nextest run --override-version-check
<b>info</b>: overriding version check (required: 0.9.55, current: 0.9.54)
<font color="#4E9A06"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.22s
<font color="#4E9A06"><b>    Starting</b></font> <b>191</b> tests across <b>13</b> binaries
...
</pre>
<h2 id="showing-required-and-recommended-versions"><a class="header" href="#showing-required-and-recommended-versions">Showing required and recommended versions</a></h2>
<p>To show and verify the version status, run <code>cargo nextest show-config version</code>. This will produce output similar to:</p>
<pre><font color="#D3D7CF">% </font><font color="#4E9A06">cargo</font> nextest show-config version
current nextest version: <b>0.9.54</b>
version requirements:
    - required: <b>0.9.55</b>
evaluation result: <font color="#CC0000"><b>does not meet required version</b></font>
<font color="#CC0000"><b>error</b></font>: update nextest with <b>cargo nextest self update</b>, or bypass check
with --override-version-check
</pre>
<p>This command exits with:</p>
<ul>
<li>Exit code 92 (<a href="https://docs.rs/nextest-metadata/latest/nextest_metadata/enum.NextestExitCode.html#associatedconstant.REQUIRED_VERSION_NOT_MET"><code>REQUIRED_VERSION_NOT_MET</code></a>) if the current version of nextest is lower than the required version.</li>
<li>Exit code 10 (<a href="https://docs.rs/nextest-metadata/latest/nextest_metadata/enum.NextestExitCode.html#associatedconstant.RECOMMENDED_VERSION_NOT_MET"><code>RECOMMENDED_VERSION_NOT_MET</code></a>) if the current version of nextest is lower than the recommended version. This is an advisory exit code that does not necessarily indicate failure.</li>
<li>Exit code 0 if the version check was satisfied, or if the check was overridden.</li>
</ul>
<h2 id="note-for-tool-developers"><a class="header" href="#note-for-tool-developers">Note for tool developers</a></h2>
<p>If you're building a tool on top of nextest, you can use <a href="book/configuration.html#tool-specific-configuration">tool-specific configuration</a> to define minimum required and recommended nextest versions.</p>
<p><strong>As an exception to the general priority rules</strong> with tool-specific configuration, required and recommended versions across <em>all</em> config files (both repository and tool-specific configurations) are taken into account.</p>
<p>For example, if:</p>
<ul>
<li>The repository requires nextest 0.9.54.</li>
<li>There are two tool config files, and the first one requires nextest 0.9.57.</li>
<li>The second one requires nextest 0.9.60.</li>
</ul>
<p>Then, nextest will produce an error unless it is at 0.9.60.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="per-test-overrides-2"><a class="header" href="#per-test-overrides-2">Per-test overrides</a></h1>
<p>Nextest supports overriding some settings for subsets of tests, using the <a href="book/filter-expressions.html">filter expression</a> and Rust conditional compilation syntaxes.</p>
<p>Overrides are set via the <code>[[profile.&lt;name&gt;.overrides]]</code> list. Each override consists of the following:</p>
<ul>
<li><code>filter</code> — The filter expression to match.</li>
<li><code>platform</code> — The <a href="book/specifying-platforms.html">platforms</a> to match.</li>
<li>Supported overrides, which are optional. Currently supported are:
<ul>
<li><code>threads-required</code> — Number of <a href="book/threads-required.html">threads required</a> for this test.</li>
<li><code>test-group</code> — An optional <a href="book/test-groups.html">test group</a> for this test.</li>
<li><code>slow-timeout</code> — Amount of time after which <a href="book/slow-tests.html">tests are marked slow</a>.</li>
<li><code>leak-timeout</code> — How long to wait after the test completes <a href="book/leaky-tests.html">for any subprocesses to exit</a>.</li>
<li><code>success-output</code> and <code>failure-output</code> — Control <a href="book/other-options.html#--success-output-and---failure-output">when standard output and standard error are displayed</a> for passing and failing tests, respectively. Values supported are:
<ul>
<li><code>immediate</code>: display output as soon as the test fails. Default for <code>failure-output</code>.</li>
<li><code>final</code>: display output at the end of the test run.</li>
<li><code>immediate-final</code>: display output as soon as the test fails, and at the end of the run.</li>
<li><code>never</code>: never display output. Default for <code>success-output</code>.</li>
</ul>
</li>
<li><code>junit.store-success-output</code> and <code>junit.store-failure-output</code> — Whether to store output for passing and failing tests, respectively, in <a href="book/junit.html">JUnit reports</a>.</li>
</ul>
</li>
</ul>
<h2 id="example-2"><a class="header" href="#example-2">Example</a></h2>
<pre><code class="language-toml">[profile.ci]
retries = 1

[[profile.ci.overrides]]
filter = 'test(/\btest_network_/)'
retries = 4

[[profile.ci.overrides]]
platform = 'x86_64-unknown-linux-gnu'
slow-timeout = "5m"

[[profile.ci.overrides]]
filter = 'test(/\btest_filesystem_/)'
platform = { host = 'cfg(target_os = "macos")' }
leak-timeout = "500ms"
success-output = "immediate"
</code></pre>
<p>When <code>--profile ci</code> is specified:</p>
<ul>
<li>for test names that start with <code>test_network_</code> (including test names like <code>my_module::test_network_</code>), retry tests up to 4 times</li>
<li>on <code>x86_64-unknown-linux-gnu</code>, set a slow timeout of 5 minutes</li>
<li>on macOS hosts, for test names that start with <code>test_filesystem_</code> (including test names like <code>my_module::test_filesystem_</code>), set a leak timeout of 500 milliseconds, and show success output immediately.</li>
</ul>
<h2 id="override-precedence"><a class="header" href="#override-precedence">Override precedence</a></h2>
<p>Overrides are configured as an ordered list. They're are applied in the following order. For a given test <em>T</em> and a given setting <em>S</em>:</p>
<ol>
<li>If nextest is run with <code>--profile my-profile</code>, the first override within <code>profile.my-profile.overrides</code> that matches <em>T</em> and configures <em>S</em>.</li>
<li>The first override within <code>profile.default.overrides</code> that matches <em>T</em> and configures <em>S</em>.</li>
<li>If nextest is run with <code>--profile my-profile</code>, the global configuration for that profile, if it configures <em>S</em>.</li>
<li>The global configuration specified by <code>profile.default</code>.</li>
</ol>
<p>Precedence is evaluated separately for each override. If a particular override does not configure a setting, it is ignored for that setting.</p>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<pre><code class="language-toml">[profile.default]
retries = 0  # this is the default, so it doesn't need to be specified
slow-timeout = "30s"

[[profile.default.overrides]]
filter = 'package(my-package)'
retries = 2
slow-timeout = "45s"

[profile.ci]
retries = 1
slow-timeout = { period = "15s", terminate-after = 2 }

[[profile.ci.overrides]]
filter = 'package(my-package) and test(/^flaky::/)'
retries = 3
</code></pre>
<p>If nextest is run with <code>--profile ci</code>:</p>
<ul>
<li>Tests in <code>my-package</code> that begin with <code>flaky::</code> are retried 3 times, and are run with a slow timeout of 45 seconds.</li>
<li>Other tests in <code>my-package</code> are retried 2 times and are run with a slow timeout of 45 seconds.</li>
<li>All other tests are retried up to one time and are run with a slow-timeout of 15 seconds. Tests that take longer than 30 seconds are terminated.</li>
</ul>
<p>If nextest is run without <code>--profile</code>:</p>
<ul>
<li>Tests in <code>my-package</code> are retried 2 times and with a slow timeout of 45 seconds.</li>
<li>Other tests are retried 0 times with a slow timeout of 30 seconds.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specifying-platforms-for-per-test-overrides"><a class="header" href="#specifying-platforms-for-per-test-overrides">Specifying platforms for per-test overrides</a></h1>
<p><a href="book/per-test-overrides.html">Per-test overrides</a> support filtering by platform. Either a Rust <a href="https://doc.rust-lang.org/beta/rustc/platform-support.html#platform-support">target triple</a> or <a href="https://doc.rust-lang.org/reference/conditional-compilation.html"><code>cfg()</code> expression</a> may be specified.</p>
<p>For example, with the following configuration:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
platform = 'cfg(target_os = "linux")'
retries = 3
</code></pre>
<p>Test runs on Linux will have 3 retries.</p>
<h2 id="cross-compiling-1"><a class="header" href="#cross-compiling-1">Cross-compiling</a></h2>
<p>While cross-compiling code, nextest's per-test overrides support filtering by either <em>host</em> or <em>target</em> platforms.</p>
<p>If <code>platform</code> is set to a string, then nextest will consider it to be the <em>target</em> filter. For example, if the following is specified:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
platform = 'aarch64-apple-darwin'
slow-timeout = "120s"
</code></pre>
<p>Then test runs performed either natively on <code>aarch64-apple-darwin</code>, or while cross-compiling from some other operating system to <code>aarch64-apple-darwin</code>, will be marked slow after 120 seconds.</p>
<p>Starting nextest version 0.9.58, <code>platform</code> can also be set to a map with <code>host</code> and <code>target</code> keys. While determining whether a particular override applies, nextest will apply both host and target filters (AND operation).</p>
<p>For example:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
platform = { host = 'cfg(target_os = "macos")' }
retries = 1

[[profile.default.overrides]]
platform = { host = 'x86_64-unknown-linux-gnu', target = 'cfg(windows)' }
threads-required = 2
</code></pre>
<p>With this configuration:</p>
<ul>
<li>On macOS hosts (regardless of the target platform), tests will be retried once.</li>
<li>On x86_64 Linux hosts, while cross-compiling to Windows, tests will be marked as requiring two threads each.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Specifying <code>platform</code> as a string is equivalent to specifying it as a map with the <code>target</code> key.</p>
</blockquote>
<h2 id="host-tests"><a class="header" href="#host-tests">Host tests</a></h2>
<p>While cross-compiling code, some tests may need to be run on the host platform. (See the note about <a href="book/running.html#filtering-by-build-platform">Filtering by build platform</a> for more.)</p>
<p>For tests that run on the host platform, to figure out if an override applies nextest will compute the result of the <em>target</em> filter against the <em>host</em> platform. (If the <code>host</code> key is specified, it will be considered as well based on the AND semantics listed above.)</p>
<p>This behavior is similar to that of <a href="book/target-runners.html#cross-compiling">target runners</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="heavy-tests-and-threads-required"><a class="header" href="#heavy-tests-and-threads-required">Heavy tests and <code>threads-required</code></a></h1>
<p>Nextest achieves <a href="book/benchmarks.html">its performance</a> through running <a href="book/how-it-works.html">many tests in parallel</a>. However, some projects have tests that consume a disproportionate amount of resources like CPU or memory. If too many of these <em>heavy tests</em> are run concurrently, your machine's CPU might be overwhelmed, or it might run out of memory.</p>
<p>With nextest, you can mark heavy tests as taking up multiple threads or "slots" out of the total amount of available parallelism. In other words, you can assign those tests a higher "weight". This is done by using the <code>threads-required</code> <a href="book/per-test-overrides.html">per-test override</a>.</p>
<p>For example, on a machine with 16 logical CPUs, nextest will run 16 tests concurrently by default. However, if you mark tests that begin with <code>tests::heavy::</code> as requiring 2 threads each:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
filter = 'test(/^tests::heavy::/)'
threads-required = 2
</code></pre>
<p>Then each test in the <code>tests::heavy</code> module will take up 2 of those 16 threads.</p>
<p>The <code>threads-required</code> configuration can also be set to one of two special values:</p>
<ul>
<li><code>"num-cpus"</code> — The number of logical CPUs on the system.</li>
<li><code>"num-test-threads"</code> — The number of test threads nextest is currently running with.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> <code>threads-required</code> is not meant to ensure mutual exclusion across subsets of tests. See <a href="book/test-groups.html">Test groups and mutual exclusion</a>.</p>
</blockquote>
<h2 id="use-cases-1"><a class="header" href="#use-cases-1">Use cases</a></h2>
<p>Some use cases that may benefit from limiting concurrency:</p>
<ul>
<li>Integration tests that spin up a network of services to run against.</li>
<li>Tests that are multithreaded internally, possibly using a <a href="book/custom-test-harnesses.html">custom test harness</a> where a single test is presented to nextest.</li>
<li>Tests that consume large amounts of memory.</li>
<li>Tests that must be mutually exclusive with all other tests globally (set <code>threads-required</code> to <code>num-test-threads</code>).</li>
</ul>
<blockquote>
<p><strong>Tip:</strong> Be sure to benchmark your test runs! <code>threads-required</code> will often cause test runs to become slower overall. However, setting it might still be desirable if it makes test runs more reliable.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-groups-and-mutual-exclusion"><a class="header" href="#test-groups-and-mutual-exclusion">Test groups and mutual exclusion</a></h1>
<p>Starting version 0.9.48, nextest allows users to specify test <em>groups</em> for sets of tests. This lets you configure groups of tests to run serially or with a limited amount of concurrency.</p>
<p>In other words, nextest lets you define logical <em>semaphores</em> and <em>mutexes</em> that apply to certain subsets of tests.</p>
<p>Tests that aren't part of a test group are not affected by these concurrency limits.</p>
<p>If the limit is set to 1, this is similar to <code>cargo test</code> with <a href="https://crates.io/crates/serial_test">the <code>serial_test</code> crate</a>, or a global mutex.</p>
<blockquote>
<p><strong>Note:</strong> Nextest does not support in-process mutexes (or semaphores), directly. Instead, you can emulate these features by using test groups.</p>
</blockquote>
<h2 id="use-cases-2"><a class="header" href="#use-cases-2">Use cases</a></h2>
<ul>
<li>Your tests access a network service (perhaps running on the same system) that can only handle one, or a limited number of, tests being run at a time.</li>
<li>Your tests run against a global system resource that may fail, or encounter race conditions, if accessed by more than one process at a time.</li>
<li>Your tests start up a network service that listens on a fixed TCP or UDP port on localhost, and if several tests try to open up the same port concurrently, they'll collide with each other.</li>
</ul>
<blockquote>
<p>While you can use test groups to make your existing network service tests work with nextest, <strong>this is not the "correct" way to write such tests</strong>. For example, your tests might collide with a network service already running on the system. The logical mutex will also make your test runs slower.</p>
<p>Consider these two recommended approaches instead:</p>
<ul>
<li><strong>Use a randomly assigned port.</strong> On all platforms you can do this by binding to port 0. Once your test creates the service, you'll need a way to communicate the actual port assigned back to your test.
<ul>
<li>If your service is in the same process as your test, you can expose an API to retrieve the actual port assigned.</li>
<li>If your service is in another process, you'll need a way to communicate the port assigned back to the test. One approach is to pass in a temporary directory as an environment variable, then arrange for the service to write the port number in a file within the temporary directory.</li>
</ul>
</li>
<li><strong>Rather than using TCP/IP, bind to a <a href="https://en.wikipedia.org/wiki/Unix_domain_socket">Unix domain socket</a></strong> in a temporary directory. This approach also <a href="https://devblogs.microsoft.com/commandline/windowswsl-interop-with-af_unix/">works on Windows</a>.</li>
</ul>
</blockquote>
<h2 id="configuring-test-groups"><a class="header" href="#configuring-test-groups">Configuring test groups</a></h2>
<p>Test groups are specified in <a href="book/configuration.html">nextest's configuration</a> by:</p>
<ol>
<li>Declaring test group names along with concurrency limits, using the <code>max-threads</code> parameter.</li>
<li>Using the <code>test-groups</code> <a href="book/per-test-overrides.html">per-test override</a>.</li>
</ol>
<p>For example:</p>
<pre><code class="language-toml">[test-groups]
resource-limited = { max-threads = 4 }
serial-integration = { max-threads = 1 }

[[profile.default.overrides]]
filter = 'test(resource_limited::)'
test-group = 'resource-limited'

[[profile.default.overrides]]
filter = 'package(integration-tests)'
platform = 'cfg(unix)'
test-group = 'serial-integration'
</code></pre>
<p>This configuration defines two test groups:</p>
<ol>
<li><code>resource-limited</code>, which is limited to 4 threads.</li>
<li><code>serial-integration</code>, which is limited to 1 thread.</li>
</ol>
<p>These test groups impact execution in the following ways:</p>
<ol>
<li>Any tests whose name contains <code>resource_limited::</code> will be limited to running four at a time. In other words, there is a logical semaphore around all tests that contain <code>resource_limited::</code>, with four available permits.</li>
<li>On Unix platforms, tests in the <code>integration-tests</code> package will be limited to running one at a time, i.e. serially. In other words, on Unix platforms, there is a logical mutex around all tests in the <code>integration-tests</code> package.</li>
<li>Tests that are not in either of these groups will run with global concurrency limits.</li>
</ol>
<p>Nextest will continue to schedule as many tests as possible, accounting for global and group concurrency limits.</p>
<h2 id="showing-test-groups"><a class="header" href="#showing-test-groups">Showing test groups</a></h2>
<p>You can show the test groups currently in effect with <code>cargo nextest show-config test-groups</code>.</p>
<p>With the above example, you might see the following output:</p>
<pre>
<font color="#4E9A06"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.09s
group: <u style="text-decoration-style:single"><b>resource-limited</b></u> (max threads = <b>4</b>)
  * override for <b>default</b> profile with filter <font color="#C4A000">&apos;test(resource_limited::)&apos;</font>:
      <font color="#75507B"><b>resource-bindings</b></font>:
          <font color="#3465A4"><b>access::resource_limited::test_resource_access</b></font>
          <font color="#3465A4"><b>edit::resource_limited::test_resource_edit</b></font>
group: <u style="text-decoration-style:single"><b>serial-integration</b></u> (max threads = <b>1</b>)
  * override for <b>default</b> profile with filter <font color="#C4A000">&apos;package(integration-tests)&apos;</font>:
      <font color="#75507B"><b>integration-tests::integration</b></font>:
          <font color="#3465A4"><b>test_service_read</b></font>
          <font color="#3465A4"><b>test_service_write</b></font>
</pre>
<p>This command accepts <a href="book/listing.html#options-and-arguments">all the same options</a> that <code>cargo nextest list</code> does.</p>
<h2 id="comparison-with-threads-required"><a class="header" href="#comparison-with-threads-required">Comparison with <code>threads-required</code></a></h2>
<p>Test groups are similar to <a href="book/threads-required.html">heavy tests and <code>threads-required</code></a>. The key difference is that test groups are meant to limit concurrency for subsets of tests, while <code>threads-required</code> sets global limits across the entire test run.</p>
<p>Both of these options can be combined. For example:</p>
<pre><code class="language-toml">[test-groups]
my-group = { max-threads = 8 }

[[profile.default.overrides]]
filter = 'test(/^group::heavy::/)'
test-group = 'my-group'
threads-required = 2

[[profile.default.overrides]]
filter = 'test(/^group::light::/)'
test-group = 'my-group'
threads-required = 1  # this is the default, shown for clarity
</code></pre>
<p>With this configuration:</p>
<ul>
<li>Tests whose names start with <code>group::heavy::</code>, and tests that start with <code>group::light::</code>, are both part of <code>my-group</code>.</li>
<li>The <code>group::heavy::</code> tests will take up two slots within <em>both</em> global and group concurrency limits.</li>
<li>The <code>group::light::</code> tests will take up one slot within both limits.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Setting <code>threads-required</code> to be greater than a test group's <code>max-threads</code> will not cause issues; a test that does so will take up all slots available.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="junit-support-1"><a class="header" href="#junit-support-1">JUnit support</a></h1>
<p>Nextest can produce output in the <a href="https://llg.cubic.org/docs/junit/">JUnit/XUnit XML format</a>. This format is widely understood by test analysis tools and libraries.</p>
<p>To enable JUnit support, add this to your <a href="book/configuration.html">nextest configuration</a>:</p>
<pre><code class="language-toml">[profile.ci.junit]  # this can be some other profile, too
path = "junit.xml"
</code></pre>
<p>If <code>--profile ci</code> is selected on the command line, a JUnit report will be written out to <code>target/nextest/ci/junit.xml</code> within the workspace root.</p>
<p>Some notes about the JUnit support:</p>
<ul>
<li>There are several slightly different formats all called "JUnit" or "XUnit". Nextest adheres to the <a href="https://llg.cubic.org/docs/junit/">Jenkins XML format</a>.</li>
<li>Every test binary forms a single <code>&lt;testsuite&gt;</code>. Every test forms a single <code>&lt;testcase&gt;</code>.</li>
<li>Standard output and standard error are included for failed and retried tests. (However, <a href="https://en.wikipedia.org/wiki/Valid_characters_in_XML">invalid XML characters</a> are stripped out.)</li>
</ul>
<h2 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h2>
<p>Configuration options supported for JUnit reports, within the <code>junit</code> section:</p>
<ul>
<li><code>report-name</code> — The name of the report. Defaults to <code>"nextest-run"</code>.</li>
<li><code>store-success-output</code> — Whether to store output for successful tests in the <code>&lt;system-out&gt;</code> and <code>&lt;system-err&gt;</code> elements. Defaults to false.</li>
<li><code>store-failure-output</code> — Whether to store output for failing tests in the <code>&lt;system-out&gt;</code> and <code>&lt;system-err&gt;</code> elements. Defaults to true.</li>
</ul>
<p><code>store-success-output</code> and <code>store-failure-output</code> can also be configured as <a href="book/per-test-overrides.html">per-test overrides</a>.</p>
<h3 id="example-configuration"><a class="header" href="#example-configuration">Example configuration</a></h3>
<pre><code class="language-toml">[profile.default.junit]
path = "junit.xml"
# These are the default values, specified for clarity.
store-success-output = false
store-failure-output = true

[[profile.default.overrides]]
filter = 'test(important-test)'
junit.store-success-output = true
</code></pre>
<p>In this example, the JUnit report will contain the output for all failing tests, and for successful tests that contain "important-test" in the name.</p>
<h2 id="post-processing"><a class="header" href="#post-processing">Post-processing</a></h2>
<p>Some tools that read JUnit files don't follow the Jenkins standard. You can post-process the JUnit file in such cases. Here's some recommendations for post-processing tools written by community members:</p>
<ul>
<li>CircleCI: <a href="https://github.com/conradludgate/circleci-junit-fix"><code>circleci-junit-fix</code></a></li>
</ul>
<h2 id="example-4"><a class="header" href="#example-4">Example</a></h2>
<p>Here's an example JUnit file generated by <code>cargo-nextest</code>.</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;testsuites name="nextest-run" tests="3" failures="1" errors="0" uuid="45c50042-482e-477e-88a2-60cfcc3eaf95" timestamp="2024-01-09T07:50:12.664+00:00" time="0.023"&gt;
    &lt;testsuite name="nextest-tests::basic" tests="3" disabled="0" errors="0" failures="1"&gt;
        &lt;testcase name="test_cwd" classname="nextest-tests::basic" timestamp="2024-01-09T07:50:12.665+00:00" time="0.004"&gt;
        &lt;/testcase&gt;
        &lt;testcase name="test_failure_assert" classname="nextest-tests::basic" timestamp="2024-01-09T07:50:12.665+00:00" time="0.004"&gt;
            &lt;failure type="test failure"&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at tests/basic.rs:19:5:
assertion `left == right` failed: this is an assertion
  left: 4
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace&lt;/failure&gt;
            &lt;rerunFailure timestamp="2024-01-09T07:50:12.670+00:00" time="0.004" type="test failure"&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at tests/basic.rs:19:5:
assertion `left == right` failed: this is an assertion
  left: 4
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
                &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 17 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at tests/basic.rs:19:5:
assertion `left == right` failed: this is an assertion
  left: 4
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/rerunFailure&gt;
            &lt;rerunFailure timestamp="2024-01-09T07:50:12.676+00:00" time="0.004" type="test failure"&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at tests/basic.rs:19:5:
assertion `left == right` failed: this is an assertion
  left: 4
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
                &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 17 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at tests/basic.rs:19:5:
assertion `left == right` failed: this is an assertion
  left: 4
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/rerunFailure&gt;
            &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 17 filtered out; finished in 0.00s

&lt;/system-out&gt;
            &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at tests/basic.rs:19:5:
assertion `left == right` failed: this is an assertion
  left: 4
 right: 5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
        &lt;/testcase&gt;
        &lt;testcase name="test_flaky_mod_4" classname="nextest-tests::basic" timestamp="2024-01-09T07:50:12.683+00:00" time="0.004"&gt;
            &lt;flakyFailure timestamp="2024-01-09T07:50:12.665+00:00" time="0.004" type="test failure"&gt;thread &amp;apos;test_flaky_mod_4&amp;apos; panicked at tests/basic.rs:43:9:
Failed because attempt 1 % 4 != 0
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
                &lt;system-out&gt;
running 1 test
test test_flaky_mod_4 ... FAILED

failures:

failures:
    test_flaky_mod_4

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 17 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_flaky_mod_4&amp;apos; panicked at tests/basic.rs:43:9:
Failed because attempt 1 % 4 != 0
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/flakyFailure&gt;
            &lt;flakyFailure timestamp="2024-01-09T07:50:12.671+00:00" time="0.004" type="test failure"&gt;thread &amp;apos;test_flaky_mod_4&amp;apos; panicked at tests/basic.rs:43:9:
Failed because attempt 2 % 4 != 0
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
                &lt;system-out&gt;
running 1 test
test test_flaky_mod_4 ... FAILED

failures:

failures:
    test_flaky_mod_4

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 17 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_flaky_mod_4&amp;apos; panicked at tests/basic.rs:43:9:
Failed because attempt 2 % 4 != 0
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/flakyFailure&gt;
            &lt;flakyFailure timestamp="2024-01-09T07:50:12.676+00:00" time="0.005" type="test failure"&gt;thread &amp;apos;test_flaky_mod_4&amp;apos; panicked at tests/basic.rs:43:9:
Failed because attempt 3 % 4 != 0
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
                &lt;system-out&gt;
running 1 test
test test_flaky_mod_4 ... FAILED

failures:

failures:
    test_flaky_mod_4

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 17 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_flaky_mod_4&amp;apos; panicked at tests/basic.rs:43:9:
Failed because attempt 3 % 4 != 0
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/flakyFailure&gt;
        &lt;/testcase&gt;
    &lt;/testsuite&gt;
&lt;/testsuites&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="integrations-with-other-tools"><a class="header" href="#integrations-with-other-tools">Integrations with other tools</a></h1>
<p>This section covers other tools that integrate with nextest. Supported are:</p>
<ul>
<li><a href="book/test-coverage.html">Test coverage with llvm-cov</a></li>
<li><a href="book/miri.html">The Miri interpreter for Rust</a></li>
<li><a href="book/benchmark-integration.html">Criterion benchmarks</a></li>
<li><a href="book/cargo-mutants.html">Mutation testing with cargo-mutants</a></li>
</ul>
<blockquote>
<p>If your tool integrates with nextest, please feel free to <a href="https://github.com/nextest-rs/nextest/issues/new">open an issue</a> to discuss including it in this section!</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-coverage"><a class="header" href="#test-coverage">Test coverage</a></h1>
<p>Test coverage support is provided by third-party tools that wrap around nextest.</p>
<h2 id="llvm-cov"><a class="header" href="#llvm-cov">llvm-cov</a></h2>
<p><a href="https://github.com/taiki-e/cargo-llvm-cov">cargo-llvm-cov</a> supports nextest. To generate llvm-cov data with nextest, run:</p>
<pre><code>cargo install cargo-llvm-cov
cargo llvm-cov nextest
</code></pre>
<h3 id="using-llvm-cov-in-github-actions"><a class="header" href="#using-llvm-cov-in-github-actions">Using llvm-cov in GitHub Actions</a></h3>
<p>Install Rust with the <code>llvm-tools-preview</code> component, nextest, and llvm-cov in GitHub Actions. Then, run <code>cargo llvm-cov nextest</code>.</p>
<pre><code class="language-yaml">- uses: dtolnay/rust-toolchain@stable
  with:
    components: llvm-tools-preview
- uses: taiki-e/install-action@cargo-llvm-cov
- uses: taiki-e/install-action@nextest

- name: Collect coverage data
  run: cargo llvm-cov nextest
</code></pre>
<h3 id="collecting-coverage-data-from-doctests"><a class="header" href="#collecting-coverage-data-from-doctests">Collecting coverage data from doctests</a></h3>
<p>Nextest doesn't currently support doctests, so coverage data from nextest must be <a href="https://github.com/taiki-e/cargo-llvm-cov?tab=readme-ov-file#merge-coverages-generated-under-different-test-conditions">merged</a> with doctest data.</p>
<p>Here's an example GitHub Actions configuration:</p>
<pre><code class="language-yaml"># Nightly Rust is required for cargo llvm-cov --doc.
- uses: dtolnay/rust-toolchain@nightly
  with:
    components: llvm-tools-preview
- uses: taiki-e/install-action@cargo-llvm-cov
- uses: taiki-e/install-action@nextest

- name: Collect coverage data (including doctests)
  run: |
    cargo llvm-cov --no-report nextest
    cargo llvm-cov --no-report --doc
    cargo llvm-cov report --doctests --lcov --output-path lcov.info
</code></pre>
<h3 id="reporting-to-an-external-coverage-service"><a class="header" href="#reporting-to-an-external-coverage-service">Reporting to an external coverage service</a></h3>
<p>External services like <a href="https://about.codecov.io/">Codecov.io</a> can be used to collect and display coverage data. Codecov is free for open source projects, and supports <code>lcov.info</code> files.</p>
<p>After generating an <code>lcov.info</code> file, upload it to Codecov with:</p>
<pre><code class="language-yaml">- name: Upload coverage data to codecov
  uses: codecov/codecov-action@v3
  with:
    files: lcov.info
</code></pre>
<h3 id="example-5"><a class="header" href="#example-5">Example</a></h3>
<p>Nextest itself uses the above mechanisms to collect coverage for its project. The config is located in <a href="https://github.com/nextest-rs/nextest/blob/main/.github/workflows/coverage.yml"><code>.github/workflows/coverage.yml</code></a>.</p>
<h2 id="integrating-nextest-into-coverage-tools"><a class="header" href="#integrating-nextest-into-coverage-tools">Integrating nextest into coverage tools</a></h2>
<p>Most coverage tools work by setting a few environment variables such as <code>RUSTFLAGS</code> or <code>RUSTC_WRAPPER</code>. Nextest runs Cargo for the build, which will read those environment variables as usual. This means that it should generally be quite straightforward to integrate nextest into other coverage tools.</p>
<blockquote>
<p>If you've integrated nextest into a coverage tool, feel free to <a href="https://github.com/nextest-rs/nextest/pulls">submit a pull request</a> with documentation.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="miri-and-nextest"><a class="header" href="#miri-and-nextest">Miri and nextest</a></h1>
<p>Nextest works with the <a href="https://github.com/rust-lang/miri">Miri interpreter</a> for Rust. This interpreter can check for certain classes of <a href="https://doc.rust-lang.org/reference/behavior-considered-undefined.html">undefined behavior</a>.
It can also run your tests for (almost) arbitrary targets.</p>
<h2 id="benefits"><a class="header" href="#benefits">Benefits</a></h2>
<p>The main benefit of using nextest with Miri is that each test runs in its own process. This means that it's easier to <a href="https://github.com/rust-lang/miri/issues/1481">identify memory leaks</a>, for example.</p>
<p>Miri can be very taxing on most computers. If nextest is run under Miri, it configures itself to use 1 thread by default. This mirrors <code>cargo miri test</code>. You can customize this with the <code>--test-threads</code>/<code>-j</code> option.</p>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<ul>
<li>cargo-nextest 0.9.29 or above</li>
<li>Miri from Rust nightly 2022-07-24 or after</li>
</ul>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>After <a href="https://github.com/rust-lang/miri#using-miri">installing Miri</a>, run:</p>
<pre><code>cargo miri nextest run
</code></pre>
<p>You may need to specify the toolchain to run as, using <code>cargo +nightly-YYYY-MM-DD miri nextest run</code>.</p>
<p>Miri supports cross-interpretation, so e.g. to run your tests on a big-endian target, run:</p>
<pre><code>cargo miri nextest run --target mips64-unknown-linux-gnuabi64
</code></pre>
<p>This does not require installing any special toolchain, and will work even if you are using macOS or Windows.</p>
<blockquote>
<p><strong>Note:</strong> <a href="book/reusing-builds.html">Archiving and reusing builds</a> is not supported under Miri.</p>
</blockquote>
<h2 id="configuring-nextest-running-under-miri"><a class="header" href="#configuring-nextest-running-under-miri">Configuring nextest running under Miri</a></h2>
<p>If nextest detects a Miri environment, it uses the <code>default-miri</code> profile by default. Add repository-specific Miri configuration to this profile. For example, to <a href="book/slow-tests.html#terminating-tests-after-a-timeout">terminate tests</a> after 2 minutes, add this to <code>.config/nextest.toml</code>:</p>
<pre><code class="language-toml">[profile.default-miri]
slow-timeout = { period = "60s", terminate-after = 2 }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="criterion-benchmarks"><a class="header" href="#criterion-benchmarks">Criterion benchmarks</a></h1>
<p>Nextest supports running benchmarks in "test mode" with <a href="https://bheisler.github.io/criterion.rs/book/index.html">Criterion.rs</a>.</p>
<h2 id="what-is-test-mode"><a class="header" href="#what-is-test-mode">What is test mode?</a></h2>
<p>Many benchmarks depend on the system that's running them being <a href="https://en.wiktionary.org/wiki/quiescent">quiescent</a>. In other words, while benchmarks are being run there shouldn't be any other user or system activity. This can make benchmarks hard or even unsuitable to run in CI systems like GitHub Actions, where the capabilities of individual runners vary or are too noisy to produce useful results.</p>
<p>However, it can still be good to verify in CI that benchmarks compile correctly, and don't panic when run. To support this use case, libraries like Criterion support running benchmarks in "test mode".</p>
<p>For criterion and nextest, benchmarks are run with the following settings:</p>
<ul>
<li>With the <code>test</code> Cargo profile. This is typically the same as the <code>dev</code> profile, and can be overridden with <code>--cargo-profile</code>.</li>
<li>With one iteration of the benchmark.</li>
</ul>
<h2 id="requirements-2"><a class="header" href="#requirements-2">Requirements</a></h2>
<ul>
<li>Criterion 0.5.0 or above; previous versions are not compatible with nextest.</li>
<li>Any recent version of cargo-nextest.</li>
</ul>
<h2 id="running-benchmarks"><a class="header" href="#running-benchmarks">Running benchmarks</a></h2>
<p>By default, <code>cargo nextest run</code> does not include benchmarks as part of the test run. (This matches <code>cargo test</code>.)</p>
<p>To include benchmarks in your test run, use <code>cargo nextest run --all-targets</code>.</p>
<p>This will produce output that looks like:</p>
<pre><font color="#D3D7CF">% </font><font color="#4E9A06">cargo</font> nextest run --all-targets
<font color="#4E9A06"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.05s
<font color="#4E9A06"><b>    Starting</b></font> <b>7</b> tests across <b>1</b> binaries
<font color="#4E9A06"><b>        PASS</b></font> [   0.368s] <font color="#75507B"><b>my-benchmarks::bench/my_bench</b></font> <font color="#3465A4"><b>depends_on_cache</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.404s] <font color="#75507B"><b>my-benchmarks::bench/my_bench</b></font> <font color="#3465A4"><b>depends_on</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.443s] <font color="#75507B"><b>my-benchmarks::bench/my_bench</b></font> <font color="#3465A4"><b>into_ids</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.520s] <font color="#75507B"><b>my-benchmarks::bench/my_bench</b></font> <font color="#3465A4"><b>make_graph</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.546s] <font color="#75507B"><b>my-benchmarks::bench/my_bench</b></font> <font color="#3465A4"><b>resolve_package</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.588s] <font color="#75507B"><b>my-benchmarks::bench/my_bench</b></font> <font color="#3465A4"><b>make_cycles</b></font>
<font color="#4E9A06"><b>        PASS</b></font> [   0.625s] <font color="#75507B"><b>my-benchmarks::bench/my_bench</b></font> <font color="#3465A4"><b>make_package_name</b></font>
------------
<font color="#4E9A06"><b>     Summary</b></font> [   0.626s] <b>7</b> tests run: <b>7</b> <font color="#4E9A06"><b>passed</b></font>, <b>0</b> <font color="#C4A000"><b>skipped</b></font>
</pre>
<p>To run just benchmarks in test mode, use <code>cargo nextest run --benches</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mutation-testing-with-cargo-mutants"><a class="header" href="#mutation-testing-with-cargo-mutants">Mutation testing with cargo-mutants</a></h1>
<p><a href="https://mutants.rs/">cargo-mutants</a> helps finds gaps in your test coverage by injecting bugs and observing if your tests catch them.</p>
<p>This is complementary to coverage testing: coverage measures whether the tests execute your code, while mutation testing measures whether the tests depend on the results and side-effects of your code.</p>
<p>Mutation testing is typically slower than coverage testing because it runs the test suite many times, once for each mutation, but it is potentially more effective at finding gaps in your test suite, easier to set up, and may produce results that are easier to interpret or act on.</p>
<h2 id="using-cargo-mutants-with-nextest"><a class="header" href="#using-cargo-mutants-with-nextest">Using cargo-mutants with nextest</a></h2>
<p>First, install cargo-mutants with <code>cargo install cargo-mutants</code>.</p>
<p>cargo-mutants has a <code>--test-tool=nextest</code> command line option to run the tests with nextest. You can use this if your project's test suite requires, recommends, or is faster under nextest. For example,</p>
<pre><code class="language-sh">cargo mutants --test-tool=nextest
</code></pre>
<p>If your tree should always be built with nextest, you can configure this in <code>.cargo/mutants.toml</code>:</p>
<pre><code class="language-toml">test_tool = "nextest"
</code></pre>
<p>The <a href="https://mutants.rs/">cargo-mutants documentation</a> has more information on how to use cargo-mutants and how to interpret its results, including examples of how to configure it in CI.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stability-policy"><a class="header" href="#stability-policy">Stability policy</a></h1>
<p>This section contains information on how cargo-nextest will evolve in a backwards-compatible way over time.</p>
<h2 id="the-cargo-nextest-binary"><a class="header" href="#the-cargo-nextest-binary">The cargo-nextest binary</a></h2>
<p>The cargo-nextest binary follows <a href="https://semver.org/">semantic versioning</a>, where the <a href="https://semver.org/#spec-item-1">public API</a> consists of exactly the following:</p>
<ol>
<li>command-line arguments, options and flags</li>
<li><a href="book/machine-readable.html">machine-readable output</a></li>
<li>the <a href="book/configuration.html">configuration file format</a></li>
</ol>
<p><a href="book/experimental-features.html">Experimental features</a> are not part of the public API. They may change or be removed in a patch release.</p>
<p>Within a version series, the public API will be append-only. New options or keys may be added, but
existing keys will continue to be as they were. Existing options may be deprecated but will not be
removed within a version series, except via the policy listed in <a href="book/stability.html#making-behavior-changes">Making behavior changes</a>.</p>
<p>The public API does <em>not</em> include human-readable output generated by nextest, or in general anything
printed to stderr.</p>
<h3 id="making-behavior-changes"><a class="header" href="#making-behavior-changes">Making behavior changes</a></h3>
<p>In general, the meaning of options will not change and functionality will not be removed from
cargo-nextest within a version series.</p>
<p>However, in some cases, we may need to make behavior changes to fix a bug or security issue. These
sorts of changes will be made based on standard semantic versioning rules: bugs will be fixed in
patch releases, with due consideration given to existing use cases.</p>
<p>We may also need to make behavior changes to address what we consider to be major user interface
deficiencies. <strong>This will not be done lightly:</strong> the maintainers of nextest understand the
importance of stable, dependable CLI interfaces.</p>
<p>In those cases, we will follow the following procedure:</p>
<ol>
<li>On the nextest issue tracker, an issue will be filed under the <a href="https://github.com/nextest-rs/nextest/issues?q=is%3Aopen+label%3Abehavior-change+sort%3Aupdated-desc"><em>behavior-change</em> label</a>. This issue will outline the motivation, and be used for coordination and feedback.</li>
<li>The behavior will be marked as deprecated and a warning will be provided within the CLI. If applicable, an alternative will be provided in the warning message. If there is no alternative, a configuration option and/or environment variable will be provided to silence the warning.</li>
<li>A timeline to change the behavior will be provided. The timeline will be at least 3 months long to provide ample time for users to adapt to the new behavior.</li>
<li>After that time has elapsed, the behavior will be changed in the following version of nextest.</li>
</ol>
<h2 id="libraries"><a class="header" href="#libraries">Libraries</a></h2>
<p>The libraries used by cargo-nextest, <a href="https://crates.io/crates/nextest-metadata">nextest-metadata</a> and <a href="https://crates.io/crates/nextest-runner">nextest-runner</a>, follow the standard Rust library versioning policy.</p>
<h3 id="nextest-metadata"><a class="header" href="#nextest-metadata">nextest-metadata</a></h3>
<p>nextest-metadata contains data structures for deserializing cargo-nextest's <a href="book/machine-readable.html">machine-readable output</a>.</p>
<p><strong>nextest-metadata is forward-compatible with cargo-nextest</strong>. A given version of nextest-metadata will continue to work with all future versions of cargo-nextest (within the same version series).</p>
<p>However, currently, <strong>nextest-metadata is not backwards-compatible</strong>: a new version of nextest-metadata may not be able to parse metadata generated by older versions of cargo-nextest. In other words, each version of nextest-metadata has a minimum supported cargo-nextest version, analogous to a crate's <a href="https://rust-lang.github.io/rfcs/2495-min-rust-version.html">minimum supported Rust version (MSRV)</a>.</p>
<p>A bump to the minimum supported cargo-nextest version is considered a breaking change, and will be paired with a major version bump.</p>
<p>(The policy around backwards compatibility may be relaxed in the future based on user needs.)</p>
<h3 id="nextest-runner"><a class="header" href="#nextest-runner">nextest-runner</a></h3>
<p>nextest-runner is built to serve the needs of cargo-nextest. Every <code>cargo-nextest</code> release is likely to correspond to a breaking change to nextest-runner.</p>
<h2 id="minimum-supported-rust-version-msrv"><a class="header" href="#minimum-supported-rust-version-msrv">Minimum supported Rust version (MSRV)</a></h2>
<p>The MSRV of cargo-nextest or dependent crates may be changed in a patch release. At least the last 3 versions of Rust will be supported at any time.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="experimental-features"><a class="header" href="#experimental-features">Experimental features</a></h1>
<p>This section documents new features in nextest that aren't stable yet. These features
may be changed or removed at any time, and must be accessed through a configuration option or environment variable, depending on the feature.</p>
<h2 id="current-features"><a class="header" href="#current-features">Current features</a></h2>
<ul>
<li><a href="book/setup-scripts.html">Setup scripts</a></li>
<li><a href="book/run-machine-readable.html">Machine-readable output for test runs</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-scripts"><a class="header" href="#setup-scripts">Setup scripts</a></h1>
<ul>
<li><strong>Nextest version:</strong> 0.9.59 and above</li>
<li><strong>Enable with:</strong> Add <code>experimental = ["setup-scripts"]</code> to <code>.config/nextest.toml</code></li>
<li><strong>Tracking issue:</strong> <a href="https://github.com/nextest-rs/nextest/issues/978">#978</a></li>
</ul>
<p>Nextest supports running <em>setup scripts</em> before tests are run. Setup scripts can be scoped to
particular tests via <a href="book/filter-expressions.html">filter expressions</a>.</p>
<p>Setup scripts are configured in two parts: <em>defining scripts</em>, and <em>setting up rules</em> for when they should be executed.</p>
<h2 id="defining-scripts"><a class="header" href="#defining-scripts">Defining scripts</a></h2>
<p>Setup scripts are defined using the top-level <code>script</code> configuration. For example, to define a script named "my-script", which runs <code>my-script.sh</code>:</p>
<pre><code class="language-toml">[script.my-script]
command = 'my-script.sh'
</code></pre>
<p>Commands can either be specified using Unix shell rules, or as a list of arguments. In the following example, <code>script1</code> and <code>script2</code> are equivalent.</p>
<pre><code class="language-toml">[script.script1]
command = 'script.sh -c "Hello, world!"'

[script.script2]
command = ['script.sh', '-c', 'Hello, world!']
</code></pre>
<p>Setup scripts can have the following configuration options attached to them:</p>
<ul>
<li><strong><code>slow-timeout</code></strong>: Mark a setup script <a href="book/slow-tests.html">as slow</a> or <a href="book/slow-tests.html#terminating-tests-after-a-timeout">terminate it</a>, using the same configuration as for tests. By default, setup scripts are not marked as slow or terminated (this is different from the slow timeout for tests).</li>
<li><strong><code>leak-timeout</code></strong>: Mark setup scripts <a href="book/leaky-tests.html">leaky</a> after a timeout, using the same configuration as for tests. By default, the leak timeout is 100ms.</li>
<li><strong><code>capture-stdout</code></strong>: <code>true</code> if the script's standard output should be captured, <code>false</code> if not. By default, this is <code>false</code>.</li>
<li><strong><code>capture-stderr</code></strong>: <code>true</code> if the script's standard error should be captured, <code>false</code> if not. By default, this is <code>false</code>.</li>
</ul>
<h3 id="example-6"><a class="header" href="#example-6">Example</a></h3>
<pre><code class="language-toml">[script.db-generate]
command = 'cargo run -p db-generate'
slow-timeout = { period = "60s", terminate-after = 2 }
leak-timeout = "1s"
capture-stdout = true
capture-stderr = false
</code></pre>
<h2 id="setting-up-rules"><a class="header" href="#setting-up-rules">Setting up rules</a></h2>
<p>In configuration, you can create rules for when to use scripts on a per-profile basis. This is done via the <code>profile.&lt;profile-name&gt;.scripts</code> array. For example, you can set up a script that generates a database if tests from the <code>db-tests</code> package, or any packages that depend on it, are run.</p>
<pre><code class="language-toml">[[profile.default.scripts]]
filter = 'rdeps(db-tests)'
setup = 'db-generate'
</code></pre>
<p>(This example uses the <code>rdeps</code> <a href="book/filter-expressions.html">filter expression</a> predicate.)</p>
<p>Setup scripts can also filter based on platform, using the rules listed in <a href="book/specifying-platforms.html">Specifying platforms</a>:</p>
<pre><code class="language-toml">[[profile.default.scripts]]
platform = { host = "cfg(unix)" }
setup = 'script1'
</code></pre>
<p>A set of scripts can also be specified. All scripts in the set will be executed.</p>
<pre><code class="language-toml">[[profile.default.scripts]]
filter = 'test(/^script_tests::/)'
setup = ['script1', 'script2']
</code></pre>
<h2 id="script-execution"><a class="header" href="#script-execution">Script execution</a></h2>
<p>A given setup script <em>S</em> is only executed if the current profile has at least one rule where the <code>filter</code> and <code>platform</code> predicates match the current execution environment, and the setup script <em>S</em> is listed in <code>setup</code>.</p>
<p>Setup scripts are executed serially, in the order they are defined (<em>not</em> the order they're specified in the rules). If any setup script exits with a non-zero exit code, the entire test run is terminated.</p>
<h3 id="environment-variables-1"><a class="header" href="#environment-variables-1">Environment variables</a></h3>
<p>Setup scripts can define environment variables that will be exposed to tests that match the script. This is done by writing to the <code>$NEXTEST_ENV</code> environment variable from within the script.</p>
<p>For example, let's say you have a script <code>my-env-script.sh</code>:</p>
<pre><code class="language-bash">#!/bin/bash

# Exit with 1 if NEXTEST_ENV isn't defined.
if [ -z "$NEXTEST_ENV" ]; then
    exit 1
fi

# Write out an environment variable to $NEXTEST_ENV.
echo "MY_ENV_VAR=Hello, world!" &gt;&gt; "$NEXTEST_ENV"
</code></pre>
<p>And you define a setup script and a corresponding rule:</p>
<pre><code class="language-toml">[script.my-env-script]
command = 'my-env-script.sh'

[[profile.default.scripts]]
filter = 'test(my_env_test)'
setup = 'my-env-script'
</code></pre>
<p>Then, in tests which match this script, the environment variable will be available:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
fn my_env_test() {
    assert_eq!(std::env::var("MY_ENV_VAR"), Ok("Hello, world!".to_string()));
}
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="machine-readable-output-for-test-runs"><a class="header" href="#machine-readable-output-for-test-runs">Machine-readable output for test runs</a></h1>
<ul>
<li><strong>Nextest version:</strong> 0.9.66 and above</li>
<li><strong>Enable with:</strong> Set <code>NEXTEST_EXPERIMENTAL_LIBTEST_JSON=1</code> in the environment</li>
<li><strong>Tracking issue:</strong> <a href="https://github.com/nextest-rs/nextest/issues/1152">#1152</a></li>
</ul>
<p>Nextest has experimental support for producing machine-readable output for test runs, in a format similar to <code>cargo test</code>'s <a href="https://github.com/rust-lang/rust/issues/49359">libtest JSON output</a>.</p>
<p>The upstream libtest JSON format is currently unstable as of 2023-12. However, nextest's stabilization of the format is not gated on the upstream format being stabilized.</p>
<p>The implementation, and this documentation, is a work in progress.</p>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<p>Pass in the <code>--message-format</code> option:</p>
<pre><code>NEXTEST_EXPERIMENTAL_LIBTEST_JSON=1 cargo nextest run --message-format &lt;format&gt;
</code></pre>
<p>The <code>&lt;format&gt;</code> can be any of:</p>
<ul>
<li><code>libtest-json</code>: Produce output similar to the unstable libtest JSON.</li>
<li><code>libtest-json-plus</code>: Produce libtest JSON output, along with an extra <code>nextest</code> field.</li>
</ul>
<p>In addition, the version of the format can be specified via the <code>--message-format-version &lt;version&gt;</code> option. Supported values for <code>&lt;version&gt;</code> are:</p>
<ul>
<li><code>0.1</code>: The unstable libtest JSON format as of 2023-12.</li>
</ul>
<h2 id="format-specification"><a class="header" href="#format-specification">Format specification</a></h2>
<p>TODO</p>
<h2 id="stability-policy-1"><a class="header" href="#stability-policy-1">Stability policy</a></h2>
<p><strong>While this is an experimental feature:</strong> The format may be changed to fix issues or track upstream changes. Changes will be documented in the <a href="book/../CHANGELOG.html">changelog</a>.</p>
<p><strong>After this format is stabilized in nextest:</strong> If the unstable libtest JSON format changes, this will be accompanied with a bump in the version number. For example, the next unstable format will be called <code>0.2</code>. Once the libtest JSON format is stabilized, the corresponding format version in nextest will be <code>1</code> or <code>1.0</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-nextest-works"><a class="header" href="#how-nextest-works">How nextest works</a></h1>
<p>To understand how nextest works, it is useful to first look at the execution model used by cargo test.</p>
<h2 id="the-cargo-test-execution-model"><a class="header" href="#the-cargo-test-execution-model">The cargo test execution model</a></h2>
<p>By default, cargo test uses this execution model:</p>
<p><img src="book/../static/cargo-test-model.png" alt="Cargo test execution model" /></p>
<p>In this model, each test binary is run serially, and binaries are responsible for running individual tests in parallel.</p>
<p>This model provides the greatest flexibility because <em>the only interface between cargo test and the binary is the exit code</em>. For cargo test, a binary exiting with exit code 0 means that all tests within it passed, while a non-zero exit code means that some tests within it failed.</p>
<p>However, this model has several problems:</p>
<ol>
<li><strong>There's no structured way to get individual test pass/fail status</strong>, or the time taken by each test.</li>
<li><strong>The first binary failure means that no further tests are run</strong>, unless <code>--no-fail-fast</code> is passed in. If that argument is passed in in CI scenarios, then failing test output is not printed at the end, making it hard to figure out which tests failed.</li>
<li><strong>Performance can be affected by test bottlenecks.</strong> For example, if a binary has 20 tests and 19 of them take less than 5s, while one of them takes 60s, then the test binary will take 60s to complete execution. <code>cargo test</code> has no way to start running other test binaries in those last 55 seconds.</li>
</ol>
<h2 id="the-nextest-model"><a class="header" href="#the-nextest-model">The nextest model</a></h2>
<p>cargo-nextest uses a very different execution model, inspired by state-of-the-art test runners used at large corporations. Here's what cargo-nextest does:</p>
<p><img src="book/../static/nextest-model.png" alt="Nextest execution model" /></p>
<p>A cargo-nextest run has two separate phases:</p>
<ul>
<li><strong>The list phase.</strong> cargo-nextest first builds all test binaries with <code>cargo test --no-run</code>, then queries those binaries to produce a list of all tests within them.</li>
<li><strong>The run phase.</strong> cargo-nextest then executes each individual test in a separate process, in parallel. It then collects, displays and aggregates results for each individual test.</li>
</ul>
<p>This model solves all the problems of cargo test's execution model, at the cost of a <em>significantly</em> thicker interface to test binaries. This means that <strong>custom test harnesses <a href="book/custom-test-harnesses.html">may need to be adapted</a> to work with cargo-nextest.</strong></p>
<h2 id="contributing-features-back-to-cargo"><a class="header" href="#contributing-features-back-to-cargo">Contributing features back to cargo?</a></h2>
<p>Readers may be wondering if any of this work will be contributed back to cargo.</p>
<p>There is currently <a href="https://epage.github.io/blog/2023/06/iterating-on-test/">an ongoing effort</a> to add parts of nextest to cargo test. However, there are a few reasons nextest remains a separate project for now:</p>
<ul>
<li>As documented above, nextest has a significantly thicker interface with the test binary than Cargo does. <code>cargo test</code> cannot just change how it works without breaking backwards compatibility, while nextest did not have this constraint at the time it was created.</li>
<li>While nextest aims to be stable as far as possible, it has fewer stability guarantees than Cargo does. It is easier to experiment with improvements without having to worry about the long-term stability guarantees provided by Cargo, or go through the (necessarily) heavyweight Rust RFC process.</li>
<li>Ultimately, the primary maintainer of nextest considers it a more efficient use of their time to maintain nextest, than to try and port the changes over to <code>cargo test</code> (which won't make nextest fully redundant anyway, so it would still need to be maintained).</li>
</ul>
<p>With all that said, we'd love to see how cargo changes over time. However the expectation is that nextest will always have a role as a place to experiment with UX and workflow improvements.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="benchmarks"><a class="header" href="#benchmarks">Benchmarks</a></h1>
<p>Nextest's <a href="book/how-it-works.html">execution model</a> generally leads to faster test runs than Cargo. How much faster depends on the specifics, but here are some general guidelines:</p>
<ul>
<li><em>Larger workspaces will see a greater benefit.</em> This is because larger workspaces have more crates, more test binaries, and more potential spots for bottlenecks.</li>
<li><em>Bottlenecks with "long pole" tests.</em> Nextest excels in situations where there are bottlenecks in multiple test binaries: cargo test can only run them serially, while nextest can run those tests in parallel.</li>
<li><em>Build caching.</em> Test runs are one component of end-to-end execution times. Speeding up the build by using <a href="https://github.com/mozilla/sccache">sccache</a>, the <a href="https://github.com/marketplace/actions/rust-cache">Rust Cache GitHub Action</a>, or similar, will make test run times be a proportionally greater part of overall times.</li>
</ul>
<p>Even if nextest doesn't result in faster test runs, you may find it useful for identifying test bottlenecks, for its user interface, or for its <a href="book/../README.html#features">other features</a>.</p>
<h2 id="results"><a class="header" href="#results">Results</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Project</th><th>Revision</th><th style="text-align: right">Test count</th><th style="text-align: right">cargo test (s)</th><th style="text-align: right">nextest (s)</th><th style="text-align: right">Improvement</th></tr></thead><tbody>
<tr><td><a href="https://github.com/oxidecomputer/crucible">crucible</a></td><td><a href="https://github.com/oxidecomputer/crucible/commit/cb228c2b0c29ac2acdea730b149cc70d41effcbf"><code>cb228c2b</code></a></td><td style="text-align: right">483</td><td style="text-align: right">5.14</td><td style="text-align: right">1.52</td><td style="text-align: right">3.38×</td></tr>
<tr><td><a href="https://github.com/guppy-rs/guppy">guppy</a></td><td><a href="https://github.com/guppy-rs/guppy/commit/2cc51b411fe7fec9df6d5f459d5ebb51ba357b9a"><code>2cc51b41</code></a></td><td style="text-align: right">271</td><td style="text-align: right">6.42</td><td style="text-align: right">2.80</td><td style="text-align: right">2.29×</td></tr>
<tr><td><a href="https://github.com/rust-lang/mdBook">mdBook</a></td><td><a href="https://github.com/rust-lang/mdBook/commit/0079184c16de0916b82e5b3785963f3ef3f505ff"><code>0079184c</code></a></td><td style="text-align: right">199</td><td style="text-align: right">3.85</td><td style="text-align: right">1.66</td><td style="text-align: right">2.31×</td></tr>
<tr><td><a href="https://github.com/meilisearch/meilisearch">meilisearch</a></td><td><a href="https://github.com/meilisearch/meilisearch/commit/bfb1f9279bc5648bc9b90109f92e91cb259c288a"><code>bfb1f927</code></a></td><td style="text-align: right">721</td><td style="text-align: right">57.04</td><td style="text-align: right">28.99</td><td style="text-align: right">1.96×</td></tr>
<tr><td><a href="https://github.com/oxidecomputer/omicron">omicron</a></td><td><a href="https://github.com/oxidecomputer/omicron/commit/e7949cd15e775d326ada59c23c933c1714784a31"><code>e7949cd1</code></a></td><td style="text-align: right">619</td><td style="text-align: right">444.08</td><td style="text-align: right">202.50</td><td style="text-align: right">2.19×</td></tr>
<tr><td><a href="https://github.com/penumbra-zone/penumbra">penumbra</a></td><td><a href="https://github.com/penumbra-zone/penumbra/commit/4ecd94cce2d41427cc8d89693d745448e5253265"><code>4ecd94cc</code></a></td><td style="text-align: right">144</td><td style="text-align: right">125.38</td><td style="text-align: right">90.96</td><td style="text-align: right">1.37×</td></tr>
<tr><td><a href="https://github.com/seanmonstar/reqwest">reqwest</a></td><td><a href="https://github.com/seanmonstar/reqwest/commit/3459b89488e293eaed9f3c413155e2dff3018093"><code>3459b894</code></a></td><td style="text-align: right">113</td><td style="text-align: right">5.57</td><td style="text-align: right">2.26</td><td style="text-align: right">2.48×</td></tr>
<tr><td><a href="https://github.com/briansmith/ring">ring</a></td><td><a href="https://github.com/briansmith/ring/commit/450ada288f1805795140097ec96396b890bcf722"><code>450ada28</code></a></td><td style="text-align: right">179</td><td style="text-align: right">13.12</td><td style="text-align: right">9.40</td><td style="text-align: right">1.39×</td></tr>
<tr><td><a href="https://github.com/tokio-rs/tokio">tokio</a></td><td><a href="https://github.com/tokio-rs/tokio/commit/e7a0da60cd997f10b33f32c4763c8ecef01144f8"><code>1f50c571</code></a></td><td style="text-align: right">1138</td><td style="text-align: right">24.27</td><td style="text-align: right">11.60</td><td style="text-align: right">2.09×</td></tr>
</tbody></table>
</div>
<h2 id="specifications"><a class="header" href="#specifications">Specifications</a></h2>
<p>All measurements were done on:</p>
<ul>
<li><strong>Processor:</strong> AMD Ryzen 9 7950X x86_64, 16 cores/32 threads</li>
<li><strong>Operating system:</strong> Pop_OS! 22.04 running Linux kernel 6.0.12</li>
<li><strong>RAM:</strong> 64GB</li>
<li><strong>Rust:</strong> version 1.66.0</li>
</ul>
<p>The commands run were:</p>
<ul>
<li><strong>cargo test:</strong> <code>cargo test --workspace --bins --lib --tests --examples --no-fail-fast</code> (to exclude doctests since they're not supported by nextest)</li>
<li><strong>nextest:</strong> <code>cargo nextest run --workspace --bins --lib --tests --examples --no-fail-fast</code></li>
</ul>
<p>The measurements do not include time taken to build the tests. To ensure that, each command was run 5 times in succession. The measurement recorded is the minimum of runs 3, 4 and 5.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-test-harnesses"><a class="header" href="#custom-test-harnesses">Custom test harnesses</a></h1>
<p>A custom test harness is defined in <code>Cargo.toml</code> as:</p>
<pre><code class="language-toml">[[test]]
name = "my-test"
harness = false
</code></pre>
<p>As mentioned in <a href="book/how-it-works.html"><em>How nextest works</em></a>, cargo-nextest has a much thicker interface with the test harness than cargo test does. If you don't use any custom harnesses, cargo-nextest will run out of the box. However, custom test harnesses need to follow certain rules in order to work with nextest.</p>
<h2 id="libtest-mimic-recommended"><a class="header" href="#libtest-mimic-recommended">libtest-mimic (recommended)</a></h2>
<p>Nextest is compatible with custom test harnesses based on <a href="https://github.com/LukasKalbertodt/libtest-mimic">libtest-mimic</a>, version 0.4.0, or 0.5.2 or above (note that 0.5.0 and 0.5.1 have <a href="https://github.com/nextest-rs/datatest-stable/pull/5">a regression</a>). Using this crate is recommended.</p>
<h3 id="example-datatest-stable"><a class="header" href="#example-datatest-stable">Example: datatest-stable</a></h3>
<p>For a test harness based on libtest-mimic, see <a href="https://github.com/nextest-rs/datatest-stable">datatest-stable</a>. This harness implements <em>data-driven tests</em>.</p>
<ul>
<li>datatest-stable can be used out of the box if each test is specified by a file within a particular directory on disk. For example, it is used by the <a href="https://github.com/move-language/move">Move smart contract language</a> for many of its internal tests. With <a href="https://github.com/move-language/move/tree/dfd7cf14a32f8182ddd9f39e9da086c29cb20b7b/language/move-ir-compiler/transactional-tests/tests/bytecode-generation/declarations">these tests</a>, the harness is used to verify that each <code>.mvir</code> input results in the <code>.exp</code> output.</li>
<li>datatest-stable also serves as an example for how to write your own custom test harness, if you need to.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Versions of libtest-mimic prior to 0.4.0 are not compatible with nextest.</p>
</blockquote>
<h2 id="manually-implementing-a-test-harness"><a class="header" href="#manually-implementing-a-test-harness">Manually implementing a test harness</a></h2>
<p>For your test harness to work with nextest, follow these rules (keywords are as in <a href="https://datatracker.ietf.org/doc/html/rfc2119">RFC 2119</a>):</p>
<ul>
<li>
<p><strong>The test harness MUST support being run with <code>--list --format terse</code>.</strong> This command MUST print to stdout all tests in <em>exactly</em> the format</p>
<pre><code>my-test-1: test
my-test-2: test
</code></pre>
<p>Other output MUST NOT be written to stdout.</p>
<p>Custom test harnesses that are meant to be run as a single unit MUST produce just one line in the output.</p>
</li>
<li>
<p><strong>The test harness MUST support being run with <code>--list --format terse --ignored</code></strong>. This command MUST print to stdout exactly the set of ignored tests (however the harness defines them) in the same format as above. If there are no ignored tests or if the test harness doesn't support ignored tests, the output MUST be empty. The set of ignored tests MUST be either of the following two options:</p>
<ul>
<li>A subset of the tests printed out without <code>--ignored</code>; this is what libtest does.</li>
<li>A completely disjoint set of tests from those printed out without <code>--ignored</code>.</li>
</ul>
</li>
<li>
<p><strong>Test names that are not at the top level (however the harness defines this) SHOULD be returned as <code>path::to::test::test_name</code>.</strong> This is recommended because the cargo-nextest UI uses <code>::</code> as a separator to format test names nicely.</p>
</li>
<li>
<p><strong>The test harness MUST support being run with <code>&lt;test-name&gt; --nocapture --exact</code></strong>. This command will be called with every test name provided by the harness in <code>--list</code> above.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<p>This page documents new features and bugfixes for cargo-nextest. Please see the <a href="book/stability.html">stability
policy</a> for how versioning works with cargo-nextest.</p>
<h2 id="0968---2024-03-16"><a class="header" href="#0968---2024-03-16"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.68">0.9.68</a> - 2024-03-16</a></h2>
<p>This is a maintenance release with many internal improvements, and preparation for future features.</p>
<h3 id="changed"><a class="header" href="#changed">Changed</a></h3>
<ul>
<li>
<p>Nextest binaries now ship with symbols, producing better stack traces. This is aligned with the behavior. See <a href="https://github.com/nextest-rs/nextest/issues/1345">issue #1345</a> for more information.</p>
</li>
<li>
<p>Thanks to recent improvements, Miri is now significantly less taxing. As a result, <a href="https://nexte.st/book/miri">nextest with Miri</a> has been changed to use all threads by default. You can restore the old Miri behavior (run one test at a time) with <code>-j1</code>, or by setting in <code>.config/nextest.toml</code>:</p>
<pre><code class="language-toml">[profile.default-miri]
test-threads = 1
</code></pre>
<p>Rules for <a href="https://nexte.st/book/threads-required">heavy tests</a> and <a href="https://nexte.st/book/test-groups">test groups</a> will continue to be followed with Miri.</p>
<p>Thanks to <a href="https://github.com/saethlin">Ben Kimock</a> for driving the Miri improvements and updating nextest!</p>
</li>
</ul>
<h3 id="misc"><a class="header" href="#misc">Misc</a></h3>
<ul>
<li>The <a href="https://nexte.st/book/filter-expressions">filter expression</a> parser now uses <a href="https://docs.rs/winnow">winnow</a>.</li>
<li><a href="https://get.nexte.st">get.nexte.st</a> now uses Cloudflare rather than Netlify for hosting. See <a href="https://github.com/nextest-rs/nextest/discussions/1383">this discussion</a> for more.</li>
</ul>
<h2 id="0967---2024-01-09"><a class="header" href="#0967---2024-01-09"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.67">0.9.67</a> - 2024-01-09</a></h2>
<h3 id="added"><a class="header" href="#added">Added</a></h3>
<ul>
<li>More work on <a href="https://nexte.st/book/run-machine-readable">machine-readable output for test runs</a>: for failing tests, output is now included under the <code>stdout</code> field. This was a large effort which required figuring out how to combine stdout and stderr into the same buffer. Thanks again <a href="https://github.com/Jake-Shadle">Jake</a> for your contribution!</li>
</ul>
<h3 id="fixed"><a class="header" href="#fixed">Fixed</a></h3>
<ul>
<li>On SIGTERM and SIGHUP, outputs for cancelled and failed tests are now displayed. (Output is still hidden on SIGINT to match typical user expectations.)</li>
</ul>
<h2 id="0966---2023-12-10"><a class="header" href="#0966---2023-12-10"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.66">0.9.66</a> - 2023-12-10</a></h2>
<h3 id="added-1"><a class="header" href="#added-1">Added</a></h3>
<h4 id="experimental-feature-machine-readable-output-for-test-runs"><a class="header" href="#experimental-feature-machine-readable-output-for-test-runs">Experimental feature: machine-readable output for test runs</a></h4>
<p>Nextest now has experimental support for machine-readable output during <code>cargo nextest run</code> invocations (<a href="https://github.com/nextest-rs/nextest/pull/1086">#1086</a>), in a format similar to <code>cargo test</code>'s libtest JSON output. For more information, see <a href="https://nexte.st/book/run-machine-readable">the documentation</a>.</p>
<p>Thanks <a href="https://github.com/Jake-Shadle">Jake Shadle</a> for your contribution!</p>
<h4 id="out_dir-support"><a class="header" href="#out_dir-support"><code>OUT_DIR</code> support</a></h4>
<p>Improvements to <a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html#outputs-of-the-build-script">build script <code>OUT_DIR</code></a>
support:</p>
<ul>
<li>
<p>Matching the behavior of <code>cargo test</code>, nextest now sets the <code>OUT_DIR</code> environment variable at
runtime if there's a corresponding build script.</p>
</li>
<li>
<p>While <a href="https://nexte.st/book/reusing-builds">creating archives</a>, nextest now archives <code>OUT_DIR</code>s if:</p>
<ul>
<li>The build script is for a crate in the workspace, and</li>
<li>There's at least one test binary for that crate.</li>
</ul>
<p>This is so that the <code>OUT_DIR</code> environment variable continues to be relevant for test runs out of
archives.</p>
<p>Currently, <code>OUT_DIR</code>s are only archived one level deep to avoid bloating archives too much. In the
future, we may add configuration to archive more or less of the output directory. If you have a
use case that would benefit from this, please <a href="https://github.com/nextest-rs/nextest/issues/new">file an
issue</a>.</p>
</li>
</ul>
<h3 id="misc-1"><a class="header" href="#misc-1">Misc</a></h3>
<ul>
<li>The <code>.crate</code> files uploaded to crates.io now contain the <code>LICENSE-APACHE</code> and <code>LICENSE-MIT</code> license files. Thanks <a href="https://github.com/musicinmybrain">@musicinmybrain</a> for your first contribution!</li>
</ul>
<h2 id="0965---2023-12-10"><a class="header" href="#0965---2023-12-10"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.65">0.9.65</a> - 2023-12-10</a></h2>
<p>This version was not released due to a build issue on illumos.</p>
<h2 id="0964---2023-12-03"><a class="header" href="#0964---2023-12-03"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.64">0.9.64</a> - 2023-12-03</a></h2>
<h3 id="added-2"><a class="header" href="#added-2">Added</a></h3>
<ul>
<li>Stabilized and documented <a href="https://nexte.st/book/running#binary-ids">the binary ID format</a>.</li>
<li>Support for glob matchers in <a href="https://nexte.st/book/filter-expressions">filter expressions</a>. For example, <code>package(foo*)</code> will match all tests whose names start with <code>foo</code>.</li>
<li>A new <code>binary_id()</code> predicate matches against the binary ID.</li>
</ul>
<h3 id="changed-1"><a class="header" href="#changed-1">Changed</a></h3>
<ul>
<li>
<p>Unit tests in proc-macro crates now have a binary ID that consists of just the crate name, similar to unit tests in normal crates.</p>
</li>
<li>
<p>The default string matcher for the following predicates has changed from <em>equality</em> to <em>glob</em>:</p>
<ul>
<li>Package-related matchers: <code>package()</code>, <code>deps()</code>, and <code>rdeps()</code></li>
<li>Binary-related matchers: <code>binary()</code></li>
</ul>
<p>The new <code>binary_id()</code> predicate also uses the glob matcher by default.</p>
</li>
</ul>
<h3 id="fixed-1"><a class="header" href="#fixed-1">Fixed</a></h3>
<ul>
<li>Fixed a regression with some Cargo nightly-only features: see <a href="https://github.com/guppy-rs/guppy/pull/174">guppy-rs/guppy#174</a> for more details.</li>
</ul>
<h2 id="0963---2023-11-17"><a class="header" href="#0963---2023-11-17"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.63">0.9.63</a> - 2023-11-17</a></h2>
<h3 id="fixed-2"><a class="header" href="#fixed-2">Fixed</a></h3>
<ul>
<li>Fixed regressions under some Cargo edge cases, e.g. <a href="https://github.com/guppy-rs/guppy/issues/157">guppy-rs/guppy#157</a>.</li>
</ul>
<h2 id="0962---2023-11-14"><a class="header" href="#0962---2023-11-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.62">0.9.62</a> - 2023-11-14</a></h2>
<h3 id="added-3"><a class="header" href="#added-3">Added</a></h3>
<ul>
<li>If you create a symlink manually named <code>cargo-ntr</code> and pointing to <code>cargo-nextest</code>, you can now
shorten <code>cargo nextest run</code> to <code>cargo ntr</code>. In the future, this symlink will be automatically
created at install time.</li>
</ul>
<h3 id="changed-2"><a class="header" href="#changed-2">Changed</a></h3>
<ul>
<li>Deprecated test name filters passed in before <code>--</code>. For example, <code>cargo nextest run my_test</code> is deprecated; use <code>cargo nextest run -- my_test</code> instead. See <a href="https://github.com/nextest-rs/nextest/issues/1109">#1109</a> for motivation and more information.</li>
<li><code>x86_64-unknown-linux-gnu</code> builds are now performed using <code>cargo zigbuild</code>. The minimum glibc version remains unchanged at 2.27. Please <a href="https://github.com/nextest-rs/nextest/issues/new">file a bug report</a> if you encounter any issues with this change.</li>
</ul>
<h3 id="fixed-3"><a class="header" href="#fixed-3">Fixed</a></h3>
<ul>
<li>Fixed crashes under some Cargo edge cases, e.g. <a href="https://github.com/nextest-rs/nextest/issues/1090">#1090</a>.</li>
</ul>
<h2 id="0961---2023-10-22"><a class="header" href="#0961---2023-10-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.61">0.9.61</a> - 2023-10-22</a></h2>
<h3 id="changed-3"><a class="header" href="#changed-3">Changed</a></h3>
<ul>
<li>The grace period in <code>slow-timeout.grace-period</code> now applies to terminations as well. Thanks <a href="https://github.com/kallisti-dev">@kallisti-dev</a> for your first contribution!</li>
</ul>
<h3 id="fixed-4"><a class="header" href="#fixed-4">Fixed</a></h3>
<ul>
<li>JUnit output now strips ANSI escapes as well. Thanks <a href="https://github.com/MaienM">@MaienM</a> for your first contribution!</li>
</ul>
<h2 id="0960---2023-10-22"><a class="header" href="#0960---2023-10-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.60">0.9.60</a> - 2023-10-22</a></h2>
<p>This version was not released due to a packaging issue.</p>
<h2 id="0959---2023-09-27"><a class="header" href="#0959---2023-09-27"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.59">0.9.59</a> - 2023-09-27</a></h2>
<h3 id="added-4"><a class="header" href="#added-4">Added</a></h3>
<ul>
<li>Experimental support for <a href="https://nexte.st/book/setup-scripts">setup scripts</a>. Please try them out, and provide feedback in the <a href="https://github.com/nextest-rs/nextest/issues/978">tracking issue</a>!</li>
<li>Support for newer error messages generated by Rust 1.73.</li>
</ul>
<h3 id="fixed-5"><a class="header" href="#fixed-5">Fixed</a></h3>
<ul>
<li><code>deps()</code> and <code>rdeps()</code> predicates in <a href="https://nexte.st/book/per-test-overrides">per-test overrides</a> were previously not working correctly. With this version they now work.</li>
</ul>
<h2 id="0958---2023-09-20"><a class="header" href="#0958---2023-09-20"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.58">0.9.58</a> - 2023-09-20</a></h2>
<h3 id="added-5"><a class="header" href="#added-5">Added</a></h3>
<ul>
<li>Per-test overrides <a href="https://nexte.st/book/per-test-overrides#specifying-platforms">can now be filtered separately</a> by host and target platforms.</li>
<li>New <code>--cargo-quiet</code> and <code>--cargo-verbose</code> options to control Cargo's quiet and verbose output options. Thanks <a href="https://github.com/ggwpez">Oliver Tale-Yazdi</a> for your first contribution!</li>
</ul>
<h3 id="fixed-6"><a class="header" href="#fixed-6">Fixed</a></h3>
<ul>
<li>Improved color support by pulling in <a href="https://github.com/zkat/supports-color/pull/14">zkat/supports-color#14</a>. Now nextest should produce color more often when invoked over SSH.</li>
</ul>
<h2 id="0957---2023-08-02"><a class="header" href="#0957---2023-08-02"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.57">0.9.57</a> - 2023-08-02</a></h2>
<h3 id="fixed-7"><a class="header" href="#fixed-7">Fixed</a></h3>
<ul>
<li>Fixed case when <code>.config/nextest.toml</code> isn't present (<a href="https://github.com/nextest-rs/nextest/issues/926">#926</a>).</li>
</ul>
<h2 id="0956---2023-08-02"><a class="header" href="#0956---2023-08-02"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.56">0.9.56</a> - 2023-08-02</a></h2>
<h3 id="fixed-8"><a class="header" href="#fixed-8">Fixed</a></h3>
<ul>
<li><code>nextest-version</code> is now parsed in a separate pass. This means that error reporting in case
there's an incompatible config is now better.</li>
</ul>
<h2 id="0955---2023-07-29"><a class="header" href="#0955---2023-07-29"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.55">0.9.55</a> - 2023-07-29</a></h2>
<h3 id="added-6"><a class="header" href="#added-6">Added</a></h3>
<ul>
<li>Support for Cargo's <code>--timings</code> option (<a href="https://github.com/nextest-rs/nextest/issues/903">#903</a>).</li>
<li>Support for required and recommended versions, via a new <code>nextest-version</code> top-level configuration option. See <a href="https://nexte.st/book/minimum-versions">Minimum nextest versions</a> for more.</li>
</ul>
<h3 id="fixed-9"><a class="header" href="#fixed-9">Fixed</a></h3>
<ul>
<li>Detect tests if debug level <code>line-tables-only</code> is passed in (<a href="https://github.com/nextest-rs/nextest/issues/910">#910</a>).</li>
</ul>
<h2 id="0954---2023-06-25"><a class="header" href="#0954---2023-06-25"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.54">0.9.54</a> - 2023-06-25</a></h2>
<h3 id="added-7"><a class="header" href="#added-7">Added</a></h3>
<h4 id="custom-targets"><a class="header" href="#custom-targets">Custom targets</a></h4>
<ul>
<li>Nextest now supports custom targets specified via <code>--target</code>, <code>CARGO_BUILD_TARGET</code>, or configuration. See the Rust Embedonomicon for <a href="https://docs.rust-embedded.org/embedonomicon/custom-target.html">how to create a custom target</a>.</li>
<li>For <a href="https://nexte.st/book/per-test-overrides">per-test overrides</a>, platform filters now support custom target triples.</li>
</ul>
<h2 id="0953---2023-05-15"><a class="header" href="#0953---2023-05-15"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.53">0.9.53</a> - 2023-05-15</a></h2>
<h3 id="added-8"><a class="header" href="#added-8">Added</a></h3>
<ul>
<li>Filter expressions in TOML files can now be specified as multiline TOML strings. For example:</li>
</ul>
<pre><code class="language-toml">[[profile.default.overrides]]
filter = '''
  test(my_test)
  | package(my-package)
'''
# ...
</code></pre>
<h3 id="changed-4"><a class="header" href="#changed-4">Changed</a></h3>
<ul>
<li><code>show-config test-groups</code> now shows a clean representation of filter expressions, to enable
printing out multiline expressions neatly.</li>
</ul>
<h2 id="0952---2023-05-04"><a class="header" href="#0952---2023-05-04"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.52">0.9.52</a> - 2023-05-04</a></h2>
<h3 id="fixed-10"><a class="header" href="#fixed-10">Fixed</a></h3>
<ul>
<li>Updated dependencies to resolve a build issue on Android (<a href="https://github.com/nextest-rs/nextest/issues/862">#862</a>).</li>
</ul>
<h2 id="0951---2023-03-19"><a class="header" href="#0951---2023-03-19"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.51">0.9.51</a> - 2023-03-19</a></h2>
<h3 id="changed-5"><a class="header" href="#changed-5">Changed</a></h3>
<ul>
<li>The definition of <code>threads-required</code> has changed slightly. Previously, it was possible for global and group concurrency limits to be exceeded in some circumstances. Now, concurrency limits are never exceeded. This enables some new use cases, such as being able to declare that a test is mutually exclusive with all other tests globally.</li>
</ul>
<h2 id="0950---2023-03-13"><a class="header" href="#0950---2023-03-13"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.50">0.9.50</a> - 2023-03-13</a></h2>
<h3 id="added-9"><a class="header" href="#added-9">Added</a></h3>
<ul>
<li><code>cargo nextest r</code> added as a shortcut for <code>cargo nextest run</code>.</li>
</ul>
<h3 id="fixed-11"><a class="header" href="#fixed-11">Fixed</a></h3>
<ul>
<li>Switched to using OpenSSL on RISC-V, since ring isn't available on that platform.</li>
</ul>
<h2 id="0949---2023-01-13"><a class="header" href="#0949---2023-01-13"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.49">0.9.49</a> - 2023-01-13</a></h2>
<h3 id="added-10"><a class="header" href="#added-10">Added</a></h3>
<ul>
<li>New configuration settings added to <a href="https://nexte.st/book/junit">JUnit reports</a>: <code>junit.store-success-output</code> (defaults to false) and <code>junit.store-failure-output</code> (defaults to true) control whether output for passing and failing tests should be stored in the JUnit report.</li>
<li>The following configuration options can now be specified as <a href="https://nexte.st/book/per-test-overrides">per-test overrides</a>:
<ul>
<li><code>success-output</code> and <code>failure-output</code>.</li>
<li><code>junit.store-success-output</code> and <code>junit.store-failure-output</code>.</li>
</ul>
</li>
</ul>
<h2 id="0948---2023-01-02"><a class="header" href="#0948---2023-01-02"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.48">0.9.48</a> - 2023-01-02</a></h2>
<h3 id="added-11"><a class="header" href="#added-11">Added</a></h3>
<ul>
<li>
<p>You can now mark certain <em>groups</em> of tests to be run with a limited amount of concurrency within the group. This can be used to run tests within a group serially, similar to the <a href="https://crates.io/crates/serial_test"><code>serial_test</code> crate</a>.</p>
<p>For more about test groups, see <a href="https://nexte.st/book/test-groups">Test groups and mutual exclusion</a>.</p>
</li>
<li>
<p>A new <code>show-config test-groups</code> command shows test groups currently in effect. (<code>show-config</code> will be broadened to show other kinds of configuration in future releases.)</p>
</li>
<li>
<p>Nextest now warns you if you've defined a profile in the <code>default-</code> namespace that isn't already known. Any profile names starting with <code>default-</code> are reserved for future use.</p>
<p>Thanks <a href="https://github.com/nextest-rs/nextest/pull/747">Marcelo Nicolas Gomez Rivera</a> for your first contribution!</p>
</li>
</ul>
<h3 id="changed-6"><a class="header" href="#changed-6">Changed</a></h3>
<ul>
<li>
<p>On Unix platforms, nextest now uses a new <em>double-spawn</em> test execution mode. This mode resolves some race conditions around signal handling without an apparent performance cost.</p>
<p>This mode is not expected to cause any issues. However, if it does, you can turn it off by setting <code>NEXTEST_DOUBLE_SPAWN=0</code> in your environment. (Please <a href="https://github.com/nextest-rs/nextest/issues/new">report an issue</a> if it does!)</p>
</li>
<li>
<p>MSRV updated to Rust 1.64.</p>
</li>
</ul>
<h2 id="0947---2022-12-10"><a class="header" href="#0947---2022-12-10"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.47">0.9.47</a> - 2022-12-10</a></h2>
<h3 id="fixed-12"><a class="header" href="#fixed-12">Fixed</a></h3>
<ul>
<li><code>cargo nextest run -E 'deps(foo)</code> queries now work again. Thanks <a href="https://github.com/Freyskeyd">Simon Paitrault</a> for your first contribution!</li>
</ul>
<h2 id="0946---2022-12-10"><a class="header" href="#0946---2022-12-10"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.46">0.9.46</a> - 2022-12-10</a></h2>
<p>This version was not published due to a packaging issue.</p>
<h2 id="0945---2022-12-04"><a class="header" href="#0945---2022-12-04"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.45">0.9.45</a> - 2022-12-04</a></h2>
<h3 id="added-12"><a class="header" href="#added-12">Added</a></h3>
<ul>
<li>Support for listing and running tests in examples with the <code>--examples</code> and <code>--example &lt;EXAMPLE&gt;</code> command-line arguments. Thanks <a href="https://github.com/jedbrown">Jed Brown</a> for your first contribution!</li>
<li><a href="https://nexte.st/book/pre-built-binaries">Pre-built binaries</a> are now available for FreeBSD and illumos. Due to GitHub Actions limitations, nextest is not tested on these platforms and might be broken.</li>
</ul>
<h2 id="0944---2022-11-23"><a class="header" href="#0944---2022-11-23"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.44">0.9.44</a> - 2022-11-23</a></h2>
<h3 id="added-13"><a class="header" href="#added-13">Added</a></h3>
<h4 id="double-spawning-test-processes"><a class="header" href="#double-spawning-test-processes">Double-spawning test processes</a></h4>
<p>On Unix platforms, a new experimental "double-spawn" approach to running test binaries has been added. With the double-spawn approach, when listing or running tests, nextest will no longer spawn test processes directly. Instead, nextest will first spawn a copy of itself, which will do some initial setup work and then <code>exec</code> the test process.</p>
<p>The double-spawn approach is currently disabled by default. It can be enabled by setting <code>NEXTEST_EXPERIMENTAL_DOUBLE_SPAWN=1</code> in your environment.</p>
<p>The double-spawn approach will soon be enabled the default.</p>
<h4 id="pausing-and-resuming-test-runs"><a class="header" href="#pausing-and-resuming-test-runs">Pausing and resuming test runs</a></h4>
<p>Nextest now has initial support for handling SIGTSTP (Ctrl-Z) and SIGCONT (<code>fg</code>). On SIGTSTP (e.g. when Ctrl-Z is pressed), all running tests and timers are paused, and nextest is suspended. On SIGCONT (e.g. when <code>fg</code> is run), tests and timers are resumed.</p>
<p>Note that, by default, pressing Ctrl-Z in the middle of a test run can lead to <a href="https://inbox.sourceware.org/libc-help/87tu64w33v.fsf@oldenburg.str.redhat.com/T/#m5e40bfa2378e9df29e077addf1aa72b191902b86">nextest runs hanging sometimes</a>. These nondeterministic hangs will not happen if both of the following are true:</p>
<ul>
<li>
<p>Nextest is built with Rust 1.66 (currently in beta) or above. Rust 1.66 contains <a href="https://github.com/rust-lang/rust/pull/101077">a required fix to upstream Rust</a>.</p>
<p>Note that the <a href="https://nexte.st/book/pre-built-binaries">pre-built binaries</a> for this version are built with beta Rust to pick this fix up.</p>
</li>
<li>
<p>The double-spawn approach is enabled (see above) with <code>NEXTEST_EXPERIMENTAL_DOUBLE_SPAWN=1</code>.</p>
</li>
</ul>
<p><strong>Call for testing:</strong> Please try out the double-spawn approach by setting <code>NEXTEST_EXPERIMENTAL_DOUBLE_SPAWN=1</code> in your environment. It has been extensively tested and should not cause any breakages, but if it does, please <a href="https://github.com/nextest-rs/nextest/issues/new">report an issue</a>. Thank you!</p>
<h3 id="fixed-13"><a class="header" href="#fixed-13">Fixed</a></h3>
<ul>
<li>Fixed an issue with nextest hanging on Windows with spawned processes that outlive the test (<a href="https://github.com/nextest-rs/nextest/issues/656">#656</a>). Thanks to <a href="https://github.com/chipsenkbeil">Chip Senkbeil</a> for reporting it and providing a minimal example!</li>
</ul>
<h2 id="0943---2022-11-04"><a class="header" href="#0943---2022-11-04"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.43">0.9.43</a> - 2022-11-04</a></h2>
<p>Nextest is now built with Rust 1.65. This version of Rust is the first one to spawn processes using <a href="https://pubs.opengroup.org/onlinepubs/007904975/functions/posix_spawn.html"><code>posix_spawn</code></a> rather than <code>fork</code>/<code>exec</code> on macOS, which should lead to performance benefits in some cases.</p>
<p>For example, on an M1 Mac Mini, with the <a href="https://github.com/clap-rs/clap">clap repository</a> at <code>520145e</code>, and the command <code>cargo nextest run -E 'not (test(ui_tests) + test(example_tests))'</code>:</p>
<ul>
<li><strong>Before:</strong> 0.636 seconds</li>
<li><strong>After:</strong> 0.284 seconds (2.23x faster)</li>
</ul>
<p>This is a best-case scenario; tests that take longer to run will generally benefit less.</p>
<h3 id="added-14"><a class="header" href="#added-14">Added</a></h3>
<ul>
<li>The <a href="https://nexte.st/book/threads-required"><code>threads-required</code> configuration</a> now supports the
values "num-cpus", for the total number of logical CPUs available, and "num-test-threads", for the
number of test threads nextest is running with.</li>
<li>Nextest now prints a warning if a configuration setting is unknown.</li>
</ul>
<h3 id="fixed-14"><a class="header" href="#fixed-14">Fixed</a></h3>
<ul>
<li>Configuring <code>retries = 0</code> now works correctly. Thanks <a href="https://github.com/xxchan">xxchan</a> for your first contribution!</li>
</ul>
<h2 id="0942---2022-11-01"><a class="header" href="#0942---2022-11-01"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.42">0.9.42</a> - 2022-11-01</a></h2>
<h3 id="added-15"><a class="header" href="#added-15">Added</a></h3>
<ul>
<li>Added a new <a href="https://nexte.st/book/threads-required"><code>threads-required</code> configuration</a> that can be specified as a <a href="https://nexte.st/book/per-test-overrides">per-test override</a>. This can be used to limit concurrency for heavier tests, to avoid overwhelming CPU or running out of memory.</li>
</ul>
<h2 id="0941---2022-11-01"><a class="header" href="#0941---2022-11-01"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.41">0.9.41</a> - 2022-11-01</a></h2>
<p>This release ran into an issue during publishing and was skipped.</p>
<h2 id="0940---2022-10-25"><a class="header" href="#0940---2022-10-25"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.40">0.9.40</a> - 2022-10-25</a></h2>
<h3 id="added-16"><a class="header" href="#added-16">Added</a></h3>
<ul>
<li>
<p>Overrides can now be restricted to certain platforms, using triples or <code>cfg()</code> expressions. For example, to add retries, but only on macOS:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
platform = 'cfg(target_os = "macos")'
retries = 3
</code></pre>
<p>For an override to match, <code>platform</code> and <code>filter</code> (if specified) must both be true for a given test. While <a href="https://nexte.st/book/running#filtering-by-build-platform">cross-compiling code</a>, <code>platform</code> is matched against the host platform for host tests, and against the target platform for target tests.</p>
</li>
<li>
<p>Nextest now reads environment variables specified in <a href="https://doc.rust-lang.org/cargo/reference/config.html#env">the <code>[env]</code> section</a> from <code>.cargo/config.toml</code> files. The full syntax is supported including <code>force</code> and <code>relative</code>.</p>
<p>Thanks to <a href="https://github.com/arxanas">Waleed Khan</a> for your first contribution!</p>
</li>
<li>
<p>Nextest now sets the <code>CARGO_PKG_RUST_VERSION</code> environment variable when it runs tests. For <code>cargo test</code> this was added in Rust 1.64, but nextest sets it across all versions of Rust.</p>
</li>
</ul>
<h2 id="0939---2022-10-14"><a class="header" href="#0939---2022-10-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.39">0.9.39</a> - 2022-10-14</a></h2>
<h3 id="added-17"><a class="header" href="#added-17">Added</a></h3>
<ul>
<li>
<p>On Unix platforms, if a process times out, nextest attempts to terminate it gracefully by sending it <code>SIGTERM</code>, waiting for a grace period of 10 seconds, and then sending it <code>SIGKILL</code>. A custom grace period can now be specified through the <code>slow-timeout.grace-period</code> parameter. For more information, see <a href="https://nexte.st/book/slow-tests#how-nextest-terminates-tests">How nextest terminates tests</a>.</p>
<p>Thanks to <a href="https://github.com/saethlin">Ben Kimock</a> for your first contribution!</p>
</li>
</ul>
<h3 id="internal-improvements"><a class="header" href="#internal-improvements">Internal improvements</a></h3>
<ul>
<li>Updated clap to version 4.0.</li>
</ul>
<h2 id="0938---2022-10-05"><a class="header" href="#0938---2022-10-05"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.38">0.9.38</a> - 2022-10-05</a></h2>
<h3 id="added-18"><a class="header" href="#added-18">Added</a></h3>
<ul>
<li>Test retries now support fixed delays and exponential backoffs, with optional jitter. See <a href="https://nexte.st/book/retries#delays-and-backoff">Delays and backoff</a> for more information. Thanks <a href="https://github.com/tomasol">Tomas Olvecky</a> for your first contribution!</li>
</ul>
<h3 id="internal-improvements-1"><a class="header" href="#internal-improvements-1">Internal improvements</a></h3>
<ul>
<li>Reading test data from standard output and standard error no longer buffers twice, just once. Thanks <a href="https://github.com/NobodyXu">Jiahao XU</a> for your first contribution!</li>
</ul>
<blockquote>
<p>Note to distributors: now that Rust 1.64 is out, <code>process_group_bootstrap_hack</code> is no longer supported or required. Please remove the following environment variables if you've set them:</p>
<ul>
<li><code>RUSTC_BOOTSTRAP=1</code></li>
<li><code>RUSTFLAGS='--cfg process_group --cfg process_group_bootstrap_hack'</code></li>
</ul>
</blockquote>
<h2 id="0937---2022-09-30"><a class="header" href="#0937---2022-09-30"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.37">0.9.37</a> - 2022-09-30</a></h2>
<h3 id="added-19"><a class="header" href="#added-19">Added</a></h3>
<ul>
<li>Support for a negative value for <code>--test-threads</code>/<code>-j</code>, matching support in recent versions of
Cargo. A value of -1 means the number of logical CPUs minus 1, and so on. Thanks <a href="https://github.com/OLUWAMUYIWA">Onigbinde
Oluwamuyiwa Elijah</a> for your first contribution!</li>
<li>Add a note to the help text for <code>--test-threads</code> indicating that its default value is obtained
from the profile. Thanks <a href="https://github.com/jiangying000">jiangying</a> for your first contribution!</li>
</ul>
<h3 id="changed-7"><a class="header" href="#changed-7">Changed</a></h3>
<ul>
<li>Internal dependency target-spec bumped to 1.2.0 -- this means that newer versions of the windows
crate are now supported.</li>
<li>MSRV updated to Rust 1.62.</li>
</ul>
<h2 id="0936---2022-09-07"><a class="header" href="#0936---2022-09-07"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.36">0.9.36</a> - 2022-09-07</a></h2>
<h3 id="added-20"><a class="header" href="#added-20">Added</a></h3>
<ul>
<li>A new <code>--hide-progress-bar</code> option (environment variable <code>NEXTEST_HIDE_PROGRESS_BAR</code>) forces the
progress bar to be hidden. Thanks <a href="https://github.com/remlse">Remo Senekowitsch</a> for your first
contribution!</li>
</ul>
<h3 id="changed-8"><a class="header" href="#changed-8">Changed</a></h3>
<ul>
<li>Nextest now prints out a list of failing and flaky tests at the end of output by default (the
<code>final-status-level</code> config is set to <code>flaky</code>).</li>
<li>The progress bar is now hidden if a CI environment is detected.</li>
</ul>
<h2 id="0935---2022-08-17"><a class="header" href="#0935---2022-08-17"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.35">0.9.35</a> - 2022-08-17</a></h2>
<h3 id="added-21"><a class="header" href="#added-21">Added</a></h3>
<ul>
<li>
<p>Support for the <code>--config</code> argument, stabilized in Rust 1.63. This option is used to configure
Cargo, not nextest. This argument is passed through to Cargo, and is also used by nextest to
determine e.g. <a href="https://nexte.st/book/target-runners.html">the target runner</a> for a platform.</p>
<p><code>--config</code> is also how <a href="https://nexte.st/book/miri.html">Miri</a> communicates with nextest.</p>
</li>
<li>
<p><a href="https://nexte.st/book/target-runners.html">Target runners</a> for cross-compilation now work with
<a href="https://nexte.st/book/reusing-builds.html">build archives</a>. Thanks <a href="https://github.com/pascalkuthe">Pascal
Kuthe</a> for your first contribution!</p>
</li>
</ul>
<h2 id="0934---2022-08-12"><a class="header" href="#0934---2022-08-12"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.34">0.9.34</a> - 2022-08-12</a></h2>
<h3 id="added-22"><a class="header" href="#added-22">Added</a></h3>
<ul>
<li>For <code>cargo nextest self update</code>, added <code>-f</code> as a short-form alias for <code>--force</code>.</li>
</ul>
<h3 id="fixed-15"><a class="header" href="#fixed-15">Fixed</a></h3>
<ul>
<li>Tests are no longer retried after a run is canceled. Thanks <a href="https://github.com/iskyzh">iskyzh</a> for your contribution!</li>
</ul>
<h2 id="0933---2022-07-31"><a class="header" href="#0933---2022-07-31"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.33">0.9.33</a> - 2022-07-31</a></h2>
<h3 id="fixed-16"><a class="header" href="#fixed-16">Fixed</a></h3>
<ul>
<li>Fixed regression in cargo-nextest 0.9.32 where it no longer produced any output if stderr wasn't a terminal.</li>
</ul>
<h2 id="0932---2022-07-30"><a class="header" href="#0932---2022-07-30"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.32">0.9.32</a> - 2022-07-30</a></h2>
<h3 id="added-23"><a class="header" href="#added-23">Added</a></h3>
<ul>
<li><code>cargo nextest run</code> now has a new <code>--no-run</code> feature to build but not run tests. (This was previously achievable with <code>cargo nextest list -E 'none()'</code>, but is more intuitive this way.)</li>
<li>Pre-built binaries are now available for i686 Windows. Thanks <a href="https://github.com/Guiguiprim">Guiguiprim</a>!</li>
</ul>
<h3 id="internal-improvements-2"><a class="header" href="#internal-improvements-2">Internal improvements</a></h3>
<ul>
<li>Filter expression evaluation now uses a stack machine via the <a href="https://crates.io/crates/recursion">recursion</a> crate. Thanks <a href="https://github.com/inanna-malick">Inanna</a> for your first contribution!</li>
</ul>
<h2 id="0931---2022-07-27"><a class="header" href="#0931---2022-07-27"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.31">0.9.31</a> - 2022-07-27</a></h2>
<h3 id="added-24"><a class="header" href="#added-24">Added</a></h3>
<ul>
<li>Nextest sets a new <code>NEXTEST_RUN_ID</code> environment variable with a UUID for a test run. All tests run
within a single invocation of <code>cargo nextest run</code> will set the same run ID. Thanks <a href="https://github.com/mitsuhiko">mitsuhiko</a> for
your first contribution!</li>
</ul>
<h2 id="0930---2022-07-25"><a class="header" href="#0930---2022-07-25"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.30">0.9.30</a> - 2022-07-25</a></h2>
<h3 id="fixed-17"><a class="header" href="#fixed-17">Fixed</a></h3>
<ul>
<li>
<p>Fixed target runners specified as relative paths.</p>
</li>
<li>
<p>On Unix, cargo-nextest's performance had regressed (by 3x on <a href="https://github.com/clap-rs/clap">clap</a>) due to the change introduced in version 0.9.29 to put each test process into its own process group. In this version, this regression has been fixed, but only if you're using the pre-built binaries or building on Rust 1.64+ (currently in nightly).</p>
<blockquote>
<p>Note to distributors: to fix this regression while building with stable Rust 1.62, set the following environment variables:</p>
<ul>
<li><code>RUSTC_BOOTSTRAP=1</code></li>
<li><code>RUSTFLAGS='--cfg process_group --cfg process_group_bootstrap_hack'</code></li>
</ul>
<p>This is temporary until <a href="https://github.com/rust-lang/rust/issues/93857">the <code>process_set_process_group</code> feature is stabilized</a> in Rust 1.64.</p>
</blockquote>
</li>
</ul>
<h2 id="0929---2022-07-24"><a class="header" href="#0929---2022-07-24"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.29">0.9.29</a> - 2022-07-24</a></h2>
<h3 id="added-25"><a class="header" href="#added-25">Added</a></h3>
<ul>
<li>
<p>On Unix, each test process is now put into its own <a href="https://en.wikipedia.org/wiki/Process_group">process group</a>. If a test times out or Ctrl-C is pressed, the entire process group is signaled. This means that most subprocesses spawned by tests are also killed.</p>
<p>However, because process groups aren't nested, if a test creates a process group itself, those groups won't be signaled. This is a relatively uncommon situation.</p>
</li>
<li>
<p>On Windows, each test process is now associated with a <a href="https://docs.microsoft.com/en-us/windows/win32/procthread/job-objects">job object</a>. On timeouts, the entire job object is terminated. Since job objects <em>are</em> nested in recent versions of Windows, this should result in all subprocesses spawned by tests being killed.</p>
<p>(On Windows, the Ctrl-C behavior hasn't changed. Nextest also doesn't do graceful shutdowns on Windows yet, though this may change in the future.)</p>
</li>
<li>
<p>Nextest can now parse Cargo configs specified via the unstable <code>--config</code> option.</p>
</li>
<li>
<p>Nextest now publishes binaries for <code>aarch64-unknown-linux-gnu</code> (<a href="https://github.com/nextest-rs/nextest/pull/398">#398</a>) and <code>x86_64-unknown-linux-musl</code> (<a href="https://github.com/nextest-rs/nextest/pull/399">#399</a>). Thanks <a href="https://github.com/messense">messense</a> and <a href="https://github.com/teymour-aldridge">Teymour</a> for your first contributions!</p>
</li>
</ul>
<h3 id="fixed-18"><a class="header" href="#fixed-18">Fixed</a></h3>
<ul>
<li>Per-test overrides are now additive across configuration files (including tool-specific configuration files).</li>
</ul>
<h2 id="0929-rc1---2022-07-24"><a class="header" href="#0929-rc1---2022-07-24"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.29-rc.1">0.9.29-rc.1</a> - 2022-07-24</a></h2>
<p>This is a test release to ensure that releasing Linux aarch64 and musl binaries works well.</p>
<h2 id="0928---2022-07-22"><a class="header" href="#0928---2022-07-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.28">0.9.28</a> - 2022-07-22</a></h2>
<p>This is a quick hotfix release to ensure that the right <code>tokio</code> features are enabled under
<code>default-no-update</code>.</p>
<h2 id="0927---2022-07-22"><a class="header" href="#0927---2022-07-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.27">0.9.27</a> - 2022-07-22</a></h2>
<p>This is a major architectural rework of nextest. We've tested it thoroughly to the best of our ability, but if you see regressions please <a href="https://github.com/nextest-rs/nextest/issues/new">report them</a>!</p>
<p>If you encounter a regression, you can temporarily pin nextest to the previous version in CI. If you're on GitHub Actions and are using <code>taiki-e/install-action</code>, use this instead:</p>
<pre><code class="language-yaml">- uses: taiki-e/install-action@v1
- with:
    tool: nextest
    version: 0.9.26
</code></pre>
<h3 id="added-26"><a class="header" href="#added-26">Added</a></h3>
<ul>
<li>Nextest now works with <a href="https://nexte.st/book/miri">the Miri interpreter</a>. Use <code>cargo miri nextest run</code> to run your tests with Miri.</li>
<li>Nextest now detects some situations where tests <a href="https://nexte.st/book/leaky-tests">leak subprocesses</a>. Previously, these situations would cause nextest to hang.</li>
<li><a href="https://nexte.st/book/per-test-overrides">Per-test overrides</a> now support <code>slow-timeout</code> and the new <code>leak-timeout</code> config parameter.</li>
<li>A new option <code>--tool-config-file</code> allows tools that wrap nextest to specify custom config settings, while still prioritizing repository-specific configuration.</li>
</ul>
<h3 id="changed-9"><a class="header" href="#changed-9">Changed</a></h3>
<ul>
<li>Major internal change: The nextest list and run steps now use <a href="https://tokio.rs/">Tokio</a>. This change enables the leak detection described above.</li>
<li>The list step now runs list commands in parallel. This should result in speedups in most cases.</li>
</ul>
<h3 id="fixed-19"><a class="header" href="#fixed-19">Fixed</a></h3>
<ul>
<li>Nextest now redirects standard input during test runs to <code>/dev/null</code> (or <code>NUL</code> on Windows). Most tests do not read from standard input, but if a test does, it will no longer cause nextest to hang.</li>
<li>On Windows, nextest configures standard input, standard output and standard error to <a href="https://github.com/nextest-rs/nextest/commit/0c109db35a5315d7d8c9121e36a9e706e7393049">not be inherited</a>. This prevents some kinds of test hangs on Windows.</li>
<li>If a <a href="https://nexte.st/book/env-vars.html#dynamic-library-paths">dynamic library link path</a> doesn't exist, nextest no longer adds it to <code>LD_LIBRARY_PATH</code> or equivalent. This should have no practical effect.</li>
<li>Archiving tests now works even if the target directory is not called <code>"target"</code>.</li>
</ul>
<h2 id="0926---2022-07-14"><a class="header" href="#0926---2022-07-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.26">0.9.26</a> - 2022-07-14</a></h2>
<p>This is a quick hotfix release to update the version of nextest-metadata, to which a breaking change was accidentally committed.</p>
<h2 id="0925---2022-07-13"><a class="header" href="#0925---2022-07-13"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.25">0.9.25</a> - 2022-07-13</a></h2>
<p>This is a major release with several new features.</p>
<h3 id="filter-expressions-1"><a class="header" href="#filter-expressions-1">Filter expressions</a></h3>
<p><a href="https://nexte.st/book/filter-expressions">Filter expressions</a> are now ready for production. For example, to run all tests in <code>nextest-runner</code> and all its transitive dependencies within the workspace:</p>
<pre><code>cargo nextest run -E 'deps(nextest-runner)'
</code></pre>
<p>This release includes a number of additions and changes to filter expressions.</p>
<h4 id="added-27"><a class="header" href="#added-27">Added</a></h4>
<ul>
<li>The expression language supports several new <a href="https://nexte.st/book/filter-expressions#basic-predicates">predicates</a>:
<ul>
<li><code>kind(name-matcher)</code>: include all tests in binary kinds (e.g. <code>lib</code>, <code>test</code>, <code>bench</code>) matching <code>name-matcher</code>.</li>
<li><code>binary(name-matcher)</code>: include all tests in binary names matching <code>name-matcher</code>.</li>
<li><code>platform(host)</code> or <code>platform(target)</code>: include all tests that are <a href="running.html#filtering-by-build-platform">built for the host or target platform</a>, respectively.</li>
</ul>
</li>
</ul>
<h4 id="changed-10"><a class="header" href="#changed-10">Changed</a></h4>
<ul>
<li>
<p>If a filter expression is guaranteed not to match a particular binary, it will not be listed by nextest. (This allows <code>platform(host)</code> and <code>platform(target)</code> to work correctly.)</p>
</li>
<li>
<p>If both filter expressions and standard substring filters are passed in, a test must match filter expressions AND substring filters to be executed. For example:</p>
</li>
</ul>
<pre><code>cargo nextest run -E 'package(nextest-runner)' test_foo test_bar
</code></pre>
<p>This will execute only the tests in <code>nextest-runner</code> that match <code>test_foo</code> or <code>test_bar</code>.</p>
<h3 id="per-test-overrides-3"><a class="header" href="#per-test-overrides-3">Per-test overrides</a></h3>
<p>Nextest now supports <a href="https://nexte.st/book/per-test-overrides">per-test overrides</a>. These overrides let you customize settings for subsets of tests. For example, to retry tests that contain the substring <code>test_e2e</code> 3 times:</p>
<pre><code class="language-toml">[[profile.default.overrides]]
filter = "test(test_e2e)"
retries = 3
</code></pre>
<p>Currently, only <code>retries</code> are supported. In the future, more kinds of customization will be added.</p>
<h3 id="other-changes"><a class="header" href="#other-changes">Other changes</a></h3>
<ul>
<li>A new environment variable <code>NEXTEST_RETRIES</code> controls the number of retries tests are run with. In terms of precedence, this slots in between the command-line <code>--retries</code> option and per-test overrides for retries.</li>
<li><code>cargo nextest list</code> now hides skipped tests and binaries by default. To print out skipped tests and binaries, use <code>cargo nextest list --verbose</code>.</li>
<li>The <a href="https://nexte.st/book/machine-readable">Machine-readable output</a> for <code>cargo nextest list</code> now contains a new <code>"status"</code> key. By default, this is set to <code>"listed"</code>, and for binaries that aren't run because they don't match expression filters this is set to <code>"skipped"</code>.</li>
<li>The <code>--platform-filter</code> option is deprecated, though it will keep working for all versions within the nextest 0.9 series. Use <code>-E 'platform(host)'</code> or <code>-E 'platform(target)'</code> instead.</li>
<li><code>cargo nextest run -- --skip</code> and <code>--exact</code> now suggest using a filter expression instead.</li>
</ul>
<h2 id="0924---2022-07-01"><a class="header" href="#0924---2022-07-01"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.24">0.9.24</a> - 2022-07-01</a></h2>
<h3 id="added-28"><a class="header" href="#added-28">Added</a></h3>
<ul>
<li>New config option <code>profile.&lt;profile-name&gt;.test-threads</code> controls the number of tests run simultaneously. This option accepts either an integer with the number of threads, or the string "num-cpus" (default) for the number of logical CPUs. As usual, this option is overridden by <code>--test-threads</code> and <code>NEXTEST_TEST_THREADS</code>, in that order.</li>
<li>The command-line <code>--test-threads</code> option and the <code>NEXTEST_TEST_THREADS</code> environment variable now accept <code>num-cpus</code> as their argument.</li>
<li>nextest now works with <a href="https://github.com/ryankurte/cargo-binstall">cargo binstall</a> (<a href="https://github.com/nextest-rs/nextest/pull/332">#332</a>). Thanks [Remoun] for your first contribution!</li>
</ul>
<h3 id="fixed-20"><a class="header" href="#fixed-20">Fixed</a></h3>
<ul>
<li>Within JUnit XML, test failure descriptions (text nodes for <code>&lt;failure&gt;</code> and <code>&lt;error&gt;</code> tags) now have invalid ANSI escape codes stripped from their output.</li>
</ul>
<h2 id="0923---2022-06-26"><a class="header" href="#0923---2022-06-26"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.23">0.9.23</a> - 2022-06-26</a></h2>
<h3 id="added-29"><a class="header" href="#added-29">Added</a></h3>
<ul>
<li>On Windows, nextest now detects tests that abort due to e.g. an access violation (segfault) and prints their status as "ABORT" rather than "FAIL", along with an explanatory message on the next line.</li>
<li>Improved JUnit support: nextest now heuristically detects stack traces and adds them to the text node of the <code>&lt;failure&gt;</code> element (<a href="https://github.com/nextest-rs/nextest/issues/311">#311</a>).</li>
</ul>
<h3 id="changed-11"><a class="header" href="#changed-11">Changed</a></h3>
<ul>
<li>Errors that happen while writing data to the output now have a new documented exit code: <a href="https://docs.rs/nextest-metadata/latest/nextest_metadata/enum.NextestExitCode.html#associatedconstant.WRITE_OUTPUT_ERROR"><code>WRITE_OUTPUT_ERROR</code></a>.</li>
</ul>
<h2 id="0922---2022-06-21"><a class="header" href="#0922---2022-06-21"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.22">0.9.22</a> - 2022-06-21</a></h2>
<h3 id="added-30"><a class="header" href="#added-30">Added</a></h3>
<ul>
<li>
<p>Benchmarks are now treated as normal tests. (<a href="https://github.com/nextest-rs/nextest/pull/283">#283</a>, thanks <a href="https://github.com/tabokie">@tabokie</a> for your contribution!).</p>
<p>Note that criterion.rs benchmarks are currently incompatible with nextest (<a href="https://github.com/nextest-rs/nextest/issues/96">#96</a>) -- this change doesn't have any effect on that.</p>
</li>
<li>
<p>Added <code>-F</code> as a shortcut for <code>--features</code>, mirroring an upcoming addition to Cargo 1.62 (<a href="https://github.com/nextest-rs/nextest/pull/287">#287</a>, thanks <a href="https://github.com/Alexendoo">Alexendoo</a> for your first contribution!)</p>
</li>
</ul>
<h3 id="changed-12"><a class="header" href="#changed-12">Changed</a></h3>
<ul>
<li>If nextest's output is colorized, it no longer strips ANSI escape codes from test runs.</li>
</ul>
<h2 id="0921---2022-06-17"><a class="header" href="#0921---2022-06-17"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.21">0.9.21</a> - 2022-06-17</a></h2>
<h3 id="added-31"><a class="header" href="#added-31">Added</a></h3>
<ul>
<li>On Unix, tests that fail due to a signal (e.g. SIGSEGV) will print out the name of the signal rather than the generic "FAIL".</li>
<li><code>cargo-nextest</code> has a new <code>"default-no-update"</code> feature that will contain all default features except for self-update. If you're distributing nextest or installing it in CI, the recommended, forward-compatible way to build cargo-nextest is with <code>--no-default-features --features default-no-update</code>.</li>
</ul>
<h3 id="changed-13"><a class="header" href="#changed-13">Changed</a></h3>
<ul>
<li>Progress bars now take up the entire width of the screen. This prevents issues with the bar wrapping around on terminals that aren't wide enough.</li>
</ul>
<h2 id="0920---2022-06-13"><a class="header" href="#0920---2022-06-13"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.20">0.9.20</a> - 2022-06-13</a></h2>
<h3 id="fixed-21"><a class="header" href="#fixed-21">Fixed</a></h3>
<ul>
<li>Account for skipped tests when determining the length of the progress bar.</li>
</ul>
<h2 id="0919---2022-06-13"><a class="header" href="#0919---2022-06-13"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.19">0.9.19</a> - 2022-06-13</a></h2>
<h3 id="added-32"><a class="header" href="#added-32">Added</a></h3>
<ul>
<li>
<p>Nextest can now update itself! Once this version is installed, simply run <code>cargo nextest self update</code> to update to the latest version.</p>
<blockquote>
<p>Note to distributors: you can disable self-update by building cargo-nextest with <code>--no-default-features</code>.</p>
</blockquote>
</li>
<li>
<p>Partial, emulated support for test binary arguments passed in after <code>cargo nextest run --</code> (<a href="https://github.com/nextest-rs/nextest/pull/265">#265</a>, thanks <a href="https://github.com/tabokie">@tabokie</a> for your contribution!).</p>
<p>For example, <code>cargo nextest run -- my_test --ignored</code> will run ignored tests containing <code>my_test</code>, similar to <code>cargo test -- my_test --ignored</code>.</p>
<p>Support is limited to test names, <code>--ignored</code> and <code>--include-ignored</code>.</p>
<blockquote>
<p>Note to integrators: to reliably disable all argument parsing, pass in <code>--</code> twice. For example, <code>cargo nextest run -- -- &lt;filters...&gt;</code>.</p>
</blockquote>
</li>
</ul>
<h3 id="fixed-22"><a class="header" href="#fixed-22">Fixed</a></h3>
<ul>
<li>Better detection for cross-compilation -- now look through the <code>CARGO_BUILD_TARGET</code> environment variable, and Cargo configuration as well. The <code>--target</code> option is still preferred.</li>
<li>Slow and flaky tests are now printed out properly in the final status output (<a href="https://github.com/nextest-rs/nextest/issues/270">#270</a>).</li>
</ul>
<p>This is a test release.</p>
<h2 id="0918---2022-06-08"><a class="header" href="#0918---2022-06-08"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.18">0.9.18</a> - 2022-06-08</a></h2>
<h3 id="added-33"><a class="header" href="#added-33">Added</a></h3>
<ul>
<li>
<p>Support for terminating tests if they take too long, via the configuration parameter <code>slow-timeout.terminate-after</code>. For example, to time out after 120 seconds:</p>
<pre><code class="language-toml">slow-timeout = { period = "60s", terminate-after = 2 }
</code></pre>
<p>Thanks <a href="https://github.com/steveeJ">steveeJ</a> for your contribution (<a href="https://github.com/nextest-rs/nextest/pull/214">#214</a>)!</p>
</li>
</ul>
<h3 id="fixed-23"><a class="header" href="#fixed-23">Fixed</a></h3>
<ul>
<li>Improved support for <a href="https://nexte.st/book/reusing-builds">reusing builds</a>: produce better error messages if the workspace's source is missing.</li>
</ul>
<h2 id="0917---2022-06-07"><a class="header" href="#0917---2022-06-07"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.17">0.9.17</a> - 2022-06-07</a></h2>
<p>This release contains a number of user experience improvements.</p>
<h3 id="added-34"><a class="header" href="#added-34">Added</a></h3>
<ul>
<li>If producing output to an interactive terminal, nextest now prints out its status as a progress bar. This makes it easy to see the status of a test run at a glance.</li>
<li>Nextest's configuration has a new <code>final-status-level</code> option which can be used to print out some statuses at the end of a run (defaults to <code>none</code>). On the command line, this can be overridden with the <code>--final-status-level</code> argument or <code>NEXTEST_FINAL_STATUS_LEVEL</code> in the environment.</li>
<li>If a <a href="https://nexte.st/book/target-runners">target runner</a> is in use, nextest now prints out its name and the environment variable or config file the definition was obtained from.</li>
</ul>
<h3 id="changed-14"><a class="header" href="#changed-14">Changed</a></h3>
<ul>
<li>If the creation of a test list fails, nextest now prints a more descriptive error message, and exits with the exit code 104 (<a href="https://docs.rs/nextest-metadata/latest/nextest_metadata/enum.NextestExitCode.html#associatedconstant.TEST_LIST_CREATION_FAILED"><code>TEST_LIST_CREATION_FAILED</code></a>).</li>
</ul>
<h2 id="0916---2022-06-02"><a class="header" href="#0916---2022-06-02"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.16">0.9.16</a> - 2022-06-02</a></h2>
<h3 id="added-35"><a class="header" href="#added-35">Added</a></h3>
<ul>
<li>Nextest now <a href="https://nexte.st/book/env-vars.html#environment-variables-nextest-sets">sets <code>NEXTEST_LD_*</code> and <code>NEXTEST_DYLD_*</code> environment
variables</a> to work around
macOS System Integrity Protection sanitization.</li>
</ul>
<h3 id="fixed-24"><a class="header" href="#fixed-24">Fixed</a></h3>
<ul>
<li>While <a href="https://nexte.st/book/reusing-builds">archiving build artifacts</a>, work around some libraries producing linked paths that don't exist (<a href="https://github.com/nextest-rs/nextest/issues/247">#247</a>). Print a warning for those paths instead of failing.</li>
</ul>
<h3 id="changed-15"><a class="header" href="#changed-15">Changed</a></h3>
<ul>
<li>Build artifact archives no longer recurse into linked path subdirectories. This is not a behavioral change because <code>LD_LIBRARY_PATH</code> and other similar variables do not recurse into subdirectories either.</li>
</ul>
<h2 id="0915---2022-05-31"><a class="header" href="#0915---2022-05-31"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.15">0.9.15</a> - 2022-05-31</a></h2>
<h3 id="added-36"><a class="header" href="#added-36">Added</a></h3>
<ul>
<li>Improved support for <a href="https://nexte.st/book/reusing-builds">reusing builds</a>:
<ul>
<li>New command <code>cargo nextest archive</code> automatically archives test binaries and other relevant
files after building tests. Currently the <code>.tar.zst</code> format is supported.</li>
<li>New option <code>cargo nextest run --archive-file</code> automatically extracts archives before running the tests within them.</li>
<li>New runtime environment variable <code>NEXTEST_BIN_EXE_&lt;name&gt;</code> is set to the absolute path to a binary target's executable, taking path remapping into account. This is equivalent to <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates"><code>CARGO_BIN_EXE_&lt;name&gt;</code></a>, except this is set at runtime.</li>
<li><code>cargo nextest list --list-type binaries-only</code> now records information about non-test binaries as well.</li>
</ul>
</li>
</ul>
<h3 id="fixed-25"><a class="header" href="#fixed-25">Fixed</a></h3>
<p>Fix for experimental feature <a href="https://nexte.st/book/filter-expressions.html">filter expressions</a>:</p>
<ul>
<li>Fix test filtering when expression filters are set but name-based filters aren't.</li>
</ul>
<h2 id="0914---2022-04-18"><a class="header" href="#0914---2022-04-18"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.14">0.9.14</a> - 2022-04-18</a></h2>
<h3 id="fixed-26"><a class="header" href="#fixed-26">Fixed</a></h3>
<p>Fixes related to path remapping:</p>
<ul>
<li>Directories passed into <code>--workspace-remap</code> and <code>--target-dir-remap</code> are now canonicalized.</li>
<li>If the workspace directory is remapped, <code>CARGO_MANIFEST_DIR</code> in tests' runtime environment is set to the new directory.</li>
</ul>
<h2 id="0913---2022-04-16"><a class="header" href="#0913---2022-04-16"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.13">0.9.13</a> - 2022-04-16</a></h2>
<h3 id="added-37"><a class="header" href="#added-37">Added</a></h3>
<ul>
<li>
<p>Support for <a href="https://nexte.st/book/reusing-builds">reusing builds</a> is now production-ready. Build on one machine and run tests on another, including cross-compiling and test partitioning.</p>
<p>To see how builds can be reused in GitHub Actions, see <a href="https://github.com/nextest-rs/reuse-build-partition-example/blob/main/.github/workflows/ci.yml">this example</a>.</p>
</li>
<li>
<p>Experimental support for <a href="https://nexte.st/book/filter-expressions.html">filter expressions</a>, allowing fine-grained specifications for which tests to run.</p>
</li>
</ul>
<p>Thanks to <a href="https://github.com/Guiguiprim">Guiguiprim</a> for their fantastic work implementing both of these.</p>
<h2 id="0912---2022-03-22"><a class="header" href="#0912---2022-03-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.12">0.9.12</a> - 2022-03-22</a></h2>
<h3 id="added-38"><a class="header" href="#added-38">Added</a></h3>
<ul>
<li>Support for reading some configuration as <a href="https://nexte.st/book/env-vars#environment-variables-nextest-reads">environment variables</a>. (Thanks <a href="https://github.com/ymgyt">ymgyt</a> and <a href="https://github.com/iskyzh">iskyzh</a> for their pull requests!)</li>
<li><a href="https://nexte.st/book/machine-readable">Machine-readable output</a> for <code>cargo nextest list</code> now contains a <code>rust-build-meta</code> key. This key currently contains the target directory, the base output directories, and paths to <a href="https://nexte.st/book/env-vars#dynamic-library-paths">search for dynamic libraries in</a> relative to the target directory.</li>
</ul>
<h3 id="fixed-27"><a class="header" href="#fixed-27">Fixed</a></h3>
<ul>
<li>Test binaries that link to dynamic libraries built by Cargo now work correctly (<a href="https://github.com/nextest-rs/nextest/issues/82">#82</a>).</li>
<li>Crates with no tests are now skipped while computing padding widths in the reporter (<a href="https://github.com/nextest-rs/nextest/issues/125">#125</a>).</li>
</ul>
<h3 id="changed-16"><a class="header" href="#changed-16">Changed</a></h3>
<ul>
<li>MSRV updated to Rust 1.56.</li>
<li>For experimental feature <a href="https://nexte.st/book/reusing-builds">reusing builds</a>:
<ul>
<li>Change <code>--binaries-dir-remap</code> to <code>--target-dir-remap</code> and expect that the entire target directory is archived.</li>
<li>Support linking to dynamic libraries (<a href="https://github.com/nextest-rs/nextest/issues/82">#82</a>).</li>
</ul>
</li>
</ul>
<h2 id="0911---2022-03-09"><a class="header" href="#0911---2022-03-09"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.11">0.9.11</a> - 2022-03-09</a></h2>
<h3 id="fixed-28"><a class="header" href="#fixed-28">Fixed</a></h3>
<ul>
<li>Update <code>regex</code> to 1.5.5 to address <a href="https://github.com/rust-lang/regex/security/advisories/GHSA-m5pq-gvj9-9vr8">GHSA-m5pq-gvj9-9vr8
(CVE-2022-24713)</a>.</li>
</ul>
<h2 id="0910---2022-03-07"><a class="header" href="#0910---2022-03-07"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.10">0.9.10</a> - 2022-03-07</a></h2>
<p>Thanks to <a href="https://github.com/Guiguiprim">Guiguiprim</a> for their contributions to this release!</p>
<h3 id="added-39"><a class="header" href="#added-39">Added</a></h3>
<ul>
<li>A new <code>--platform-filter</code> option filters tests by the platform they run on (target or host).</li>
<li><code>cargo nextest list</code> has a new <code>--list-type</code> option, with values <code>full</code> (the default, same as today) and <code>binaries-only</code> (list out binaries without querying them for the tests they contain).</li>
<li>Nextest executions done as a separate process per test (currently the only supported method, though this might change in the future) set the environment variable <code>NEXTEST_PROCESS_MODE=process-per-test</code>.</li>
</ul>
<h3 id="new-experimental-features"><a class="header" href="#new-experimental-features">New experimental features</a></h3>
<ul>
<li>Nextest can now reuse builds across invocations and machines. This is an experimental feature, and feedback is welcome in <a href="https://github.com/nextest-rs/nextest/issues/98">#98</a>!</li>
</ul>
<h3 id="changed-17"><a class="header" href="#changed-17">Changed</a></h3>
<ul>
<li>The target runner is now build-platform-specific; test binaries built for the host platform will be run by the target runner variable defined for the host, and similarly for the target platform.</li>
</ul>
<h2 id="099---2022-03-03"><a class="header" href="#099---2022-03-03"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.9">0.9.9</a> - 2022-03-03</a></h2>
<h3 id="added-40"><a class="header" href="#added-40">Added</a></h3>
<ul>
<li>Updates for Rust 1.59:
<ul>
<li>Support abbreviating <code>--release</code> as <code>-r</code> (<a href="https://github.com/rust-lang/cargo/pull/10133">Cargo #10133</a>).</li>
<li>Stabilize future-incompat-report (<a href="https://github.com/rust-lang/cargo/pull/10165">Cargo #10165</a>).</li>
<li>Update builtin list of targets (used by the target runner) to Rust 1.59.</li>
</ul>
</li>
</ul>
<h2 id="098---2022-02-23"><a class="header" href="#098---2022-02-23"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.8">0.9.8</a> - 2022-02-23</a></h2>
<h3 id="fixed-29"><a class="header" href="#fixed-29">Fixed</a></h3>
<ul>
<li>Target runners of the form <code>runner = ["bin-name", "--arg1", ...]</code> are now parsed correctly (<a href="https://github.com/nextest-rs/nextest/pull/75">#75</a>).</li>
<li>Binary IDs for <code>[[bin]]</code> and <code>[[example]]</code> tests are now unique, in the format <code>&lt;crate-name&gt;::bin/&lt;binary-name&gt;</code> and <code>&lt;crate-name&gt;::test/&lt;binary-name&gt;</code> respectively (<a href="https://github.com/nextest-rs/nextest/pull/76">#76</a>).</li>
</ul>
<h2 id="097---2022-02-23"><a class="header" href="#097---2022-02-23"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.7">0.9.7</a> - 2022-02-23</a></h2>
<h3 id="fixed-30"><a class="header" href="#fixed-30">Fixed</a></h3>
<ul>
<li>If parsing target runner configuration fails, warn and proceed without a target runner rather than erroring out.</li>
</ul>
<h3 id="known-issues"><a class="header" href="#known-issues">Known issues</a></h3>
<ul>
<li>Parsing an array of strings for the target runner currently fails: <a href="https://github.com/nextest-rs/nextest/issues/73">#73</a>. A fix is being worked on in <a href="https://github.com/nextest-rs/nextest/pull/75">#75</a>.</li>
</ul>
<h2 id="096---2022-02-22"><a class="header" href="#096---2022-02-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.6">0.9.6</a> - 2022-02-22</a></h2>
<h3 id="added-41"><a class="header" href="#added-41">Added</a></h3>
<ul>
<li>Support Cargo configuration for <a href="https://nexte.st/book/target-runners">target runners</a>.</li>
</ul>
<h2 id="095---2022-02-20"><a class="header" href="#095---2022-02-20"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.5">0.9.5</a> - 2022-02-20</a></h2>
<h3 id="fixed-31"><a class="header" href="#fixed-31">Fixed</a></h3>
<ul>
<li>Updated nextest-runner to 0.1.2, fixing cyan coloring of module paths (<a href="https://github.com/nextest-rs/nextest/issues/52">#52</a>).</li>
</ul>
<h2 id="094---2022-02-16"><a class="header" href="#094---2022-02-16"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.4">0.9.4</a> - 2022-02-16</a></h2>
<p>The big new change is that release binaries are now available! Head over to <a href="https://nexte.st/book/pre-built-binaries">Pre-built binaries</a> for more.</p>
<h3 id="added-42"><a class="header" href="#added-42">Added</a></h3>
<ul>
<li>In test output, module paths are now colored cyan (<a href="https://github.com/nextest-rs/nextest/pull/42">#42</a>).</li>
</ul>
<h3 id="fixed-32"><a class="header" href="#fixed-32">Fixed</a></h3>
<ul>
<li>While querying binaries to list tests, lines ending with ": benchmark" will now be ignored (<a href="https://github.com/nextest-rs/nextest/issues/46">#46</a>).</li>
</ul>
<h2 id="093---2022-02-14"><a class="header" href="#093---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.3">0.9.3</a> - 2022-02-14</a></h2>
<h3 id="fixed-33"><a class="header" href="#fixed-33">Fixed</a></h3>
<ul>
<li>Add a <code>BufWriter</code> around stderr for the reporter, reducing the number of syscalls and fixing
issues around output overlap on Windows (<a href="https://github.com/nextest-rs/nextest/issues/35">#35</a>). Thanks <a href="https://github.com/fdncred">@fdncred</a> for reporting this!</li>
</ul>
<h2 id="092---2022-02-14"><a class="header" href="#092---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.2">0.9.2</a> - 2022-02-14</a></h2>
<h3 id="fixed-34"><a class="header" href="#fixed-34">Fixed</a></h3>
<ul>
<li>Running cargo nextest from within a crate now runs tests for just that crate, similar to cargo
test. Thanks <a href="https://twitter.com/RealWittenstein/status/1493291441384210437">Yaron Wittenstein</a>
for reporting this!</li>
</ul>
<h2 id="091---2022-02-14"><a class="header" href="#091---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.1">0.9.1</a> - 2022-02-14</a></h2>
<h3 id="fixed-35"><a class="header" href="#fixed-35">Fixed</a></h3>
<ul>
<li>Updated nextest-runner to 0.1.1, fixing builds on Rust 1.54.</li>
</ul>
<h2 id="090---2022-02-14"><a class="header" href="#090---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.0">0.9.0</a> - 2022-02-14</a></h2>
<p><strong>Initial release.</strong> Happy Valentine's day!</p>
<h3 id="added-43"><a class="header" href="#added-43">Added</a></h3>
<p>Supported in this initial release:</p>
<ul>
<li><a href="book/listing.html">Listing tests</a></li>
<li><a href="book/running.html">Running tests in parallel</a> for faster results</li>
<li><a href="book/partitioning.html">Partitioning tests</a> across multiple CI jobs</li>
<li><a href="book/retries.html">Test retries</a> and flaky test detection</li>
<li><a href="book/junit.html">JUnit support</a> for integration with other test tooling</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
